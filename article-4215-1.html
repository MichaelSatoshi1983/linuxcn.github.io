<!doctype html><html lang="en"><head><meta name="description" content="一个LinuxCN的镜像站"><meta name="msvalidate.01" content="D404690CEFCB54C7762AC84935B99171"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6618da70c90c8744eead2e9371fb5077";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript">!function(t,e,n,c,s,a,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(a=e.createElement(c)).async=1,a.src="https://www.clarity.ms/tag/s5f3f0tojf",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(a,r)}(window,document,"clarity","script")</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="stylesheet" href="/styles/base.css"><link rel="stylesheet" href="/styles/theme.css"><link rel="shortcut icon" href="/favicon.png"><title>Ansible ：一个配置管理和IT自动化工具 - 归墟星火集 又一个 LinuxCN 站点</title><meta name="generator" content="Hexo 7.3.0"></head><body><div class="header-title"><span class="header-light"></span> <span class="header-light"></span> <span class="header-light"></span> <span>归墟星火集 又一个 LinuxCN 站点 linuxcn.undefined.today<span></span></span></div><div class="container"><ul class="nav"><li><a href="/">首页</a></li><li><a target="_blank" rel="noopener" href="https://undefined.today/">Blog</a></li></ul><div class="content"><div class="post-container"><div class="post-header"><span class="ui-tips">标题：</span><h1 class="ui-keyword post-title">Ansible ：一个配置管理和IT自动化工具</h1><span class="post-date">2014-11-13</span></div><div class="post-header"><span class="ui-tips">分类：</span> <a href="/categories/%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/">系统运维</a></div><div class="post-header"><span class="ui-tips">标签：</span> <a href="/tags/Ansible/">Ansible</a> <a href="/tags/%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/">配置管理</a> <a href="/tags/IT%E8%87%AA%E5%8A%A8%E5%8C%96/">IT自动化</a></div><div class="post-content"><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201411/13/160434wtgc5zv1ggh10qki.png"></p><p>今天我来谈谈 ansible，一个由 Python 编写的强大的配置管理解决方案。尽管市面上已经有很多可供选择的配置管理解决方案，但他们各有优劣，而 ansible 的特点就在于它的简洁。让 ansible 在主流的配置管理系统中与众不同的一点便是，它并不需要你在想要配置的每个节点上安装自己的组件。同时提供的一个优点在于，如果需要的话，你可以在不止一个地方控制你的整个基础架构。最后一点是它的正确性，或许这里有些争议，但是我认为在大多数时候这仍然可以作为它的一个优点。说得足够多了，让我们来着手在 RHEL&#x2F;CentOS 和基于 Debian&#x2F;Ubuntu 的系统中安装和配置 Ansible。</p><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ol><li>发行版：RHEL&#x2F;CentOS&#x2F;Debian&#x2F;Ubuntu Linux</li><li>Jinja2：Python 的一个对设计师友好的现代模板语言</li><li>PyYAML：Python 的一个 YAML 编码&#x2F;反编码函数库</li><li>paramiko：纯 Python 编写的 SSHv2 协议函数库 （译者注：原文对函数库名有拼写错误）</li><li>httplib2：一个功能全面的 HTTP 客户端函数库</li><li>本文中列出的绝大部分操作已经假设你将在 bash 或者其他任何现代的 shell 中以 root 用户执行。</li></ol><h3 id="Ansible-如何工作"><a href="#Ansible-如何工作" class="headerlink" title="Ansible 如何工作"></a>Ansible 如何工作</h3><p>Ansible 工具并不使用守护进程，它也不需要任何额外的自定义安全架构，因此它的部署可以说是十分容易。你需要的全部东西便是 SSH 客户端和服务器了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+-----------------+                    +---------------+</span><br><span class="line">|安装了 Ansible 的|       SSH          | 文件服务器1   |</span><br><span class="line">|Linux/Unix 工作站|&lt;------------------&gt;| 数据库服务器2 | 在本地或远程</span><br><span class="line">+-----------------+       模块         | 代理服务器3   | 数据中心的</span><br><span class="line">   192.168.1.100                       +---------------+ Unix/Linux 服务器</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其中：</p><ol><li>192.168.1.100 - 在你本地的工作站或服务器上安装 Ansible。</li><li>文件服务器1到代理服务器3 - 使用 192.168.1.100 和 Ansible 来自动管理所有的服务器。</li><li>SSH - 在 192.168.1.100 和本地&#x2F;远程的服务器之间设置 SSH 密钥。</li></ol><h3 id="Ansible-安装教程"><a href="#Ansible-安装教程" class="headerlink" title="Ansible 安装教程"></a>Ansible 安装教程</h3><p>ansible 的安装轻而易举，许多发行版的第三方软件仓库中都有现成的软件包，可以直接安装。其他简单的安装方法包括使用 pip 安装它，或者从 github 里获取最新的版本。若想使用你的软件包管理器安装，在<a target="_blank" rel="noopener" href="http://www.cyberciti.biz/faq/fedora-sl-centos-redhat6-enable-epel-repo/">基于 RHEL&#x2F;CentOS Linux 的系统里你很可能需要 EPEL 仓库</a>。</p><h4 id="在基于-RHEL-CentOS-Linux-的系统中安装-ansible"><a href="#在基于-RHEL-CentOS-Linux-的系统中安装-ansible" class="headerlink" title="在基于 RHEL&#x2F;CentOS Linux 的系统中安装 ansible"></a>在基于 RHEL&#x2F;CentOS Linux 的系统中安装 ansible</h4><p>输入如下 <a target="_blank" rel="noopener" href="http://www.cyberciti.biz/faq/rhel-centos-fedora-linux-yum-command-howto/">yum 命令</a>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install ansible</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="在基于-Debian-Ubuntu-Linux-的系统中安装-ansible"><a href="#在基于-Debian-Ubuntu-Linux-的系统中安装-ansible" class="headerlink" title="在基于 Debian&#x2F;Ubuntu Linux 的系统中安装 ansible"></a>在基于 Debian&#x2F;Ubuntu Linux 的系统中安装 ansible</h4><p>输入如下 <a target="_blank" rel="noopener" href="http://www.cyberciti.biz/tips/linux-debian-package-management-cheat-sheet.html">apt-get 命令</a>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install software-properties-common</span><br><span class="line">$ sudo apt-add-repository ppa:ansible/ansible</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install ansible</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="使用-pip-安装-ansible"><a href="#使用-pip-安装-ansible" class="headerlink" title="使用 pip 安装 ansible"></a>使用 pip 安装 ansible</h4><p><a target="_blank" rel="noopener" href="http://www.cyberciti.biz/faq/debian-ubuntu-centos-rhel-linux-install-pipclient/">pip 命令是一个安装和管理 Python 软件包的工具</a>，比如它能管理 Python Package Index 中的那些软件包。如下方式在 Linux 和类 Unix 系统中通用：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip install ansible</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="从源代码安装最新版本的-ansible"><a href="#从源代码安装最新版本的-ansible" class="headerlink" title="从源代码安装最新版本的 ansible"></a>从源代码安装最新版本的 ansible</h4><p>你可以通过如下命令从 github 中安装最新版本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~</span><br><span class="line">$ git clone git://github.com/ansible/ansible.git</span><br><span class="line">$ cd ./ansible</span><br><span class="line">$ source ./hacking/env-setup</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>当你从一个 git checkout 中运行 ansible 的时候，请记住你每次用它之前都需要设置你的环境，或者你可以把这个设置过程加入你的 bash rc 文件中：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 加入 BASH RC</span><br><span class="line">$ echo &quot;export ANSIBLE_HOSTS=~/ansible_hosts&quot; &gt;&gt; ~/.bashrc</span><br><span class="line">$ echo &quot;source ~/ansible/hacking/env-setup&quot; &gt;&gt; ~/.bashrc</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ansible 的 hosts 文件包括了一系列它能操作的主机。默认情况下 ansible 通过路径 &#x2F;etc&#x2F;ansible&#x2F;hosts 查找 hosts 文件，不过这个行为也是可以更改的，这样当你想操作不止一个 ansible 或者针对不同的数据中心的不同客户操作的时候也是很方便的。你可以通过命令行参数 -i 指定 hosts 文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -m shell -a &quot;hostname&quot; --ask-pass -i /etc/some/other/dir/ansible_hosts</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>不过我更倾向于使用一个环境变量，这可以在你想要通过 source 一个不同的文件来切换工作目标的时候起到作用。这里的环境变量是 $ANSIBLE_HOSTS，可以这样设置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ export ANSIBLE_HOSTS=~/ansible_hosts</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>一旦所有需要的组件都已经安装完毕，而且你也准备好了你的 hosts 文件，你就可以来试一试它了。为了快速测试，这里我把 127.0.0.1 写到了 ansible 的 hosts 文件里：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;127.0.0.1&quot; &gt; ~/ansible_hosts</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>现在来测试一个简单的 ping：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -m ping</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>或者提示 ssh 密码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -m ping --ask-pass</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我在刚开始的设置中遇到过几次问题，因此这里强烈推荐为 ansible 设置 SSH 公钥认证。不过在刚刚的测试中我们使用了 –ask-pass，在一些机器上你会需要<a target="_blank" rel="noopener" href="http://www.cyberciti.biz/faq/noninteractive-shell-script-ssh-password-provider/">安装 sshpass</a> 或者像这样指定 -c paramiko：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -m ping --ask-pass -c paramiko</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>当然你也可以<a target="_blank" rel="noopener" href="http://www.cyberciti.biz/faq/noninteractive-shell-script-ssh-password-provider/">安装 sshpass</a>，然而 sshpass 并不总是在标准的仓库中提供，因此 paramiko 可能更为简单。</p><h3 id="设置-SSH-公钥认证"><a href="#设置-SSH-公钥认证" class="headerlink" title="设置 SSH 公钥认证"></a>设置 SSH 公钥认证</h3><p>于是我们有了一份配置，以及一些基础的其他东西。现在让我们来做一些实用的事情。ansible 的强大很大程度上体现在 playbooks 上，后者基本上就是一些写好的 ansible 脚本（大部分来说），不过在制作一个 playbook 之前，我们将先从一些一句话脚本开始。现在让我们创建和配置 SSH 公钥认证，以便省去 -c 和 –ask-pass 选项：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>样例输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/home/mike/.ssh/id_rsa):</span><br><span class="line">Enter passphrase (empty for no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved in /home/mike/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /home/mike/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">94:a0:19:02:ba:25:23:7f:ee:6c:fb:e8:38:b4:f2:42 mike@ultrabook.linuxdork.com</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+--[ RSA 2048]----+</span><br><span class="line">|... . .          |</span><br><span class="line">|.  . + . .       |</span><br><span class="line">|= . o   o        |</span><br><span class="line">|.*     .         |</span><br><span class="line">|. . .   S        |</span><br><span class="line">| E.o             |</span><br><span class="line">|.. ..            |</span><br><span class="line">|o o+..           |</span><br><span class="line">| +o+*o.          |</span><br><span class="line">+-----------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>现在显然有很多种方式来把它放到远程主机上应该的位置。不过既然我们正在使用 ansible，就用它来完成这个操作吧：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -m copy -a &quot;src=/home/mike/.ssh/id_rsa.pub dest=/tmp/id_rsa.pub&quot; --ask-pass -c paramiko</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>样例输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SSH password:</span><br><span class="line">127.0.0.1 | success &gt;&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;dest&quot;: &quot;/tmp/id_rsa.pub&quot;,</span><br><span class="line">    &quot;gid&quot;: 100,</span><br><span class="line">    &quot;group&quot;: &quot;users&quot;,</span><br><span class="line">    &quot;md5sum&quot;: &quot;bafd3fce6b8a33cf1de415af432774b4&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;0644&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;mike&quot;,</span><br><span class="line">    &quot;size&quot;: 410,</span><br><span class="line">    &quot;src&quot;: &quot;/home/mike/.ansible/tmp/ansible-tmp-1407008170.46-208759459189201/source&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;file&quot;,</span><br><span class="line">    &quot;uid&quot;: 1000</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>下一步，把公钥文件添加到远程服务器里。输入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -m shell -a &quot;cat /tmp/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys&quot; --ask-pass -c paramiko</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>样例输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SSH password:</span><br><span class="line">127.0.0.1 | FAILED | rc=1 &gt;&gt;</span><br><span class="line">/bin/sh: /root/.ssh/authorized_keys: Permission denied</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>矮油，我们需要用 root 来执行这个命令，所以还是加上一个 -u 参数吧：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -m shell -a &quot;cat /tmp/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys&quot; --ask-pass -c paramiko -u root</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>样例输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SSH password:</span><br><span class="line">127.0.0.1 | success | rc=0 &gt;&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>请注意，我刚才这是想要演示通过 ansible 来传输文件的操作。事实上 ansible 有一个更加方便的内置 SSH 密钥管理支持：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -m authorized_key -a &quot;user=mike key=&#x27;&#123;&#123; lookup(&#x27;file&#x27;, &#x27;/home/mike/.ssh/id_rsa.pub&#x27;) &#125;&#125;&#x27; path=/home/mike/.ssh/authorized_keys manage_dir=no&quot; --ask-pass -c paramiko</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>样例输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SSH password:</span><br><span class="line">127.0.0.1 | success &gt;&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;gid&quot;: 100,</span><br><span class="line">    &quot;group&quot;: &quot;users&quot;,</span><br><span class="line">    &quot;key&quot;: &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCq+Z8/usprXk0aCAPyP0TGylm2MKbmEsHePUOd7p5DO1QQTHak+9gwdoJJavy0yoUdi+C+autKjvuuS+vGb8+I+8mFNu5CvKiZzIpMjZvrZMhHRdNud7GuEanusTEJfi1pUd3NA2iXhl4a6S9a/4G2mKyf7QQSzI4Z5ddudUXd9yHmo9Yt48/ASOJLHIcYfSsswOm8ux1UnyeHqgpdIVONVFsKKuSNSvZBVl3bXzhkhjxz8RMiBGIubJDBuKwZqNSJkOlPWYN76btxMCDVm07O7vNChpf0cmWEfM3pXKPBq/UBxyG2MgoCGkIRGOtJ8UjC/daadBUuxg92/u01VNEB mike@ultrabook.linuxdork.com&quot;,</span><br><span class="line">    &quot;key_options&quot;: null,</span><br><span class="line">    &quot;keyfile&quot;: &quot;/home/mike/.ssh/authorized_keys&quot;,</span><br><span class="line">    &quot;manage_dir&quot;: false,</span><br><span class="line">    &quot;mode&quot;: &quot;0600&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;mike&quot;,</span><br><span class="line">    &quot;path&quot;: &quot;/home/mike/.ssh/authorized_keys&quot;,</span><br><span class="line">    &quot;size&quot;: 410,</span><br><span class="line">    &quot;state&quot;: &quot;file&quot;,</span><br><span class="line">    &quot;uid&quot;: 1000,</span><br><span class="line">    &quot;unique&quot;: false,</span><br><span class="line">    &quot;user&quot;: &quot;mike&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>现在这些密钥已经设置好了。我们来试着随便跑一个命令，比如 hostname，希望我们不会被提示要输入密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -m shell -a &quot;hostname&quot; -u root</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>样例输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 | success | rc=0 &gt;&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>成功！！！现在我们可以用 root 来执行命令，并且不会被输入密码的提示干扰了。我们现在可以轻易地配置任何在 ansible hosts 文件中的主机了。让我们把 &#x2F;tmp 中的公钥文件删除：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -m file -a &quot;dest=/tmp/id_rsa.pub state=absent&quot; -u root</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>样例输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 | success &gt;&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;path&quot;: &quot;/tmp/id_rsa.pub&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;absent&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>下面我们来做一些更复杂的事情，我要确定一些软件包已经安装了，并且已经是最新的版本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -m zypper -a &quot;name=apache2 state=latest&quot; -u root</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>样例输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 | success &gt;&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;name&quot;: &quot;apache2&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;latest&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>很好，我们刚才放在 &#x2F;tmp 中的公钥文件已经消失了，而且我们已经安装好了最新版的 apache。下面我们来看看前面命令中的 -m zypper，一个让 ansible 非常灵活，并且给了 playbooks 更多能力的功能。如果你不使用 openSuse 或者 Suse enterprise 你可能还不熟悉 zypper, 它基本上就是 suse 世界中相当于 yum 的存在。在上面所有的例子中，我的 hosts 文件中都只有一台机器。除了最后一个命令外，其他所有命令都应该在任何标准的 *nix 系统和标准的 ssh 配置中使用，这造成了一个问题。如果我们想要同时管理多种不同的机器呢？这便是 playbooks 和 ansible 的可配置性闪闪发光的地方了。首先我们来少许修改一下我们的 hosts 文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat ~/ansible_hosts</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>样例输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[RHELBased]</span><br><span class="line">10.50.1.33</span><br><span class="line">10.50.1.47</span><br><span class="line"></span><br><span class="line">[SUSEBased]</span><br><span class="line">127.0.0.1</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>首先，我们创建了一些分组的服务器，并且给了他们一些有意义的标签。然后我们来创建一个为不同类型的服务器执行不同操作的 playbook。你可能已经发现这个 yaml 的数据结构和我们之前运行的命令行语句中的相似性了。简单来说，-m 是一个模块，而 -a 用来提供模块参数。在 YAML 表示中你可以先指定模块，然后插入一个冒号 :，最后指定参数。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: SUSEBased</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - zypper: name=apache2 state=latest</span><br><span class="line">- hosts: RHELBased</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - yum: name=httpd state=latest</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>现在我们有一个简单的 playbook 了，我们可以这样运行它：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-playbook testPlaybook.yaml -f 10</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>样例输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PLAY [SUSEBased] **************************************************************</span><br><span class="line"></span><br><span class="line">GATHERING FACTS ***************************************************************</span><br><span class="line">ok: [127.0.0.1]</span><br><span class="line"></span><br><span class="line">TASK: [zypper name=apache2 state=latest] **************************************</span><br><span class="line">ok: [127.0.0.1]</span><br><span class="line"></span><br><span class="line">PLAY [RHELBased] **************************************************************</span><br><span class="line"></span><br><span class="line">GATHERING FACTS ***************************************************************</span><br><span class="line">ok: [10.50.1.33]</span><br><span class="line">ok: [10.50.1.47]</span><br><span class="line"></span><br><span class="line">TASK: [yum name=httpd state=latest] *******************************************</span><br><span class="line">changed: [10.50.1.33]</span><br><span class="line">changed: [10.50.1.47]</span><br><span class="line"></span><br><span class="line">PLAY RECAP ********************************************************************</span><br><span class="line">10.50.1.33                 : ok=2    changed=1    unreachable=0    failed=0</span><br><span class="line">10.50.1.47                 : ok=2    changed=1    unreachable=0    failed=0</span><br><span class="line">127.0.0.1                  : ok=2    changed=0    unreachable=0    failed=0</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意，你会看到 ansible 联系到的每一台机器的输出。-f 参数让 ansible 在多台主机上同时运行指令。除了指定全部主机，或者一个主机分组的名字以外，你还可以把导入 ssh 公钥的操作从命令行里转移到 playbook 中，这将在设置新主机的时候提供很大的方便，甚至让新主机直接可以运行一个 playbook。为了演示，我们把我们之前的公钥例子放进一个 playbook 里：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: SUSEBased</span><br><span class="line">  remote_user: mike</span><br><span class="line">  sudo: yes</span><br><span class="line">  tasks:</span><br><span class="line">    - authorized_key: user=root key=&quot;&#123;&#123; lookup(&#x27;file&#x27;, &#x27;/home/mike/.ssh/id_rsa.pub&#x27;) &#125;&#125;&quot; path=/root/.ssh/authorized_keys manage_dir=no</span><br><span class="line">- hosts: RHELBased</span><br><span class="line">  remote_user: mdonlon</span><br><span class="line">  sudo: yes</span><br><span class="line">  tasks:</span><br><span class="line">    - authorized_key: user=root key=&quot;&#123;&#123; lookup(&#x27;file&#x27;, &#x27;/home/mike/.ssh/id_rsa.pub&#x27;) &#125;&#125;&quot; path=/root/.ssh/authorized_keys manage_dir=no</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>除此之外还有很多可以做的事情，比如在启动的时候把公钥配置好，或者引入其他的流程来让你按需配置一些机器。不过只要 SSH 被配置成接受密码登陆，这些几乎可以用在所有的流程中。在你准备开始写太多 playbook 之前，另一个值得考虑的事情是，代码管理可以有效节省你的时间。机器需要不断变化，然而你并不需要在每次机器发生变化时都重新写一个 playbook，只需要更新相关的部分并提交这些修改。与此相关的另一个好处是，如同我之前所述，你可以从不同的地方管理你的整个基础结构。你只需要将你的 playbook 仓库 git clone 到新的机器上，就完成了管理所有东西的全部设置流程。</p><h3 id="现实中的-ansible-例子"><a href="#现实中的-ansible-例子" class="headerlink" title="现实中的 ansible 例子"></a>现实中的 ansible 例子</h3><p>我知道很多用户经常使用 pastebin 这样的服务，以及很多公司基于显而易见的理由配置了他们内部使用的类似东西。最近，我遇到了一个叫做 showterm 的程序，巧合之下我被一个客户要求配置它用于内部使用。这里我不打算赘述这个应用程序的细节，不过如果你感兴趣的话，你可以使用 Google 搜索 showterm。作为一个合理的现实中的例子，我将会试图配置一个 showterm 服务器，并且配置使用它所需要的客户端应用程序。在这个过程中我们还需要一个数据库服务器。现在我们从配置客户端开始：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: showtermClients</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - yum: name=rubygems state=latest</span><br><span class="line">    - yum: name=ruby-devel state=latest</span><br><span class="line">    - yum: name=gcc state=latest</span><br><span class="line">    - gem: name=showterm state=latest user_install=no</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这部分很简单。下面是主服务器：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: showtermServers</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - name: ensure packages are installed</span><br><span class="line">      yum: name=&#123;&#123;item&#125;&#125; state=latest</span><br><span class="line">      with_items:</span><br><span class="line">        - postgresql</span><br><span class="line">        - postgresql-server</span><br><span class="line">        - postgresql-devel</span><br><span class="line">        - python-psycopg2</span><br><span class="line">        - git</span><br><span class="line">        - ruby21</span><br><span class="line">        - ruby21-passenger</span><br><span class="line">    - name: showterm server from github</span><br><span class="line">      git: repo=https://github.com/ConradIrwin/showterm.io dest=/root/showterm</span><br><span class="line">    - name: Initdb</span><br><span class="line">      command: service postgresql initdb</span><br><span class="line">               creates=/var/lib/pgsql/data/postgresql.conf</span><br><span class="line"></span><br><span class="line">    - name: Start PostgreSQL and enable at boot</span><br><span class="line">      service: name=postgresql</span><br><span class="line">               enabled=yes</span><br><span class="line">               state=started</span><br><span class="line">    - gem: name=pg state=latest user_install=no</span><br><span class="line">  handlers:</span><br><span class="line">   - name: restart postgresql</span><br><span class="line">     service: name=postgresql state=restarted</span><br><span class="line"></span><br><span class="line">- hosts: showtermServers</span><br><span class="line">  remote_user: root</span><br><span class="line">  sudo: yes</span><br><span class="line">  sudo_user: postgres</span><br><span class="line">  vars:</span><br><span class="line">    dbname: showterm</span><br><span class="line">    dbuser: showterm</span><br><span class="line">    dbpassword: showtermpassword</span><br><span class="line">  tasks:</span><br><span class="line">    - name: create db</span><br><span class="line">      postgresql_db: name=&#123;&#123;dbname&#125;&#125;</span><br><span class="line"></span><br><span class="line">    - name: create user with ALL priv</span><br><span class="line">      postgresql_user: db=&#123;&#123;dbname&#125;&#125; name=&#123;&#123;dbuser&#125;&#125; password=&#123;&#123;dbpassword&#125;&#125; priv=ALL</span><br><span class="line">- hosts: showtermServers</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - name: database.yml</span><br><span class="line">      template: src=database.yml dest=/root/showterm/config/database.yml</span><br><span class="line">- hosts: showtermServers</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - name: run bundle install</span><br><span class="line">      shell: bundle install</span><br><span class="line">      args:</span><br><span class="line">        chdir: /root/showterm</span><br><span class="line">- hosts: showtermServers</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - name: run rake db tasks</span><br><span class="line">      shell: &#x27;bundle exec rake db:create db:migrate db:seed&#x27;</span><br><span class="line">      args:</span><br><span class="line">        chdir: /root/showterm</span><br><span class="line">- hosts: showtermServers</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - name: apache config</span><br><span class="line">      template: src=showterm.conf dest=/etc/httpd/conf.d/showterm.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>还凑合。请注意，从某种意义上来说这是一个任意选择的程序，然而我们现在已经可以持续地在任意数量的机器上部署它了，这便是配置管理的好处。此外，在大多数情况下这里的定义语法几乎是不言而喻的，wiki 页面也就不需要加入太多细节了。当然在我的观点里，一个有太多细节的 wiki 页面绝不会是一件坏事。</p><h3 id="扩展配置"><a href="#扩展配置" class="headerlink" title="扩展配置"></a>扩展配置</h3><p>我们并没有涉及到这里所有的细节。Ansible 有许多选项可以用来配置你的系统。你可以在你的 hosts 文件中内嵌变量，而 ansible 将会把它们应用到远程节点。如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[RHELBased]</span><br><span class="line">10.50.1.33  http_port=443</span><br><span class="line">10.50.1.47  http_port=80  ansible_ssh_user=mdonlon</span><br><span class="line"></span><br><span class="line">[SUSEBased]</span><br><span class="line">127.0.0.1  http_port=443</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>尽管这对于快速配置来说已经非常方便，你还可以将变量分成存放在 yaml 格式的多个文件中。在你的 hosts 文件路径里，你可以创建两个子目录 group<em>vars 和 host</em>vars。在这些路径里放置的任何文件，只要能对得上一个主机分组的名字，或者你的 hosts 文件中的一个主机名，它们都会在运行时被插入进来。所以前面的一个例子将会变成这样：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ultrabook:/etc/ansible # pwd</span><br><span class="line">/etc/ansible</span><br><span class="line">ultrabook:/etc/ansible # tree</span><br><span class="line">.</span><br><span class="line">├── group_vars</span><br><span class="line">│   ├── RHELBased</span><br><span class="line">│   └── SUSEBased</span><br><span class="line">├── hosts</span><br><span class="line">└── host_vars</span><br><span class="line">├── 10.50.1.33</span><br><span class="line">└── 10.50.1.47</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2 directories, 5 files</span><br><span class="line">ultrabook:/etc/ansible # cat hosts</span><br><span class="line">[RHELBased]</span><br><span class="line">10.50.1.33</span><br><span class="line">10.50.1.47</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[SUSEBased]</span><br><span class="line">127.0.0.1</span><br><span class="line">ultrabook:/etc/ansible # cat group_vars/RHELBased</span><br><span class="line">ultrabook:/etc/ansible # cat group_vars/SUSEBased</span><br><span class="line">---</span><br><span class="line">http_port: 443</span><br><span class="line">ultrabook:/etc/ansible # cat host_vars/10.50.1.33</span><br><span class="line">---</span><br><span class="line">http_port: 443</span><br><span class="line">ultrabook:/etc/ansible # cat host_vars/10.50.1.47</span><br><span class="line">---</span><br><span class="line">http_port:80</span><br><span class="line">ansible_ssh_user: mdonlon</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="改善-Playbooks"><a href="#改善-Playbooks" class="headerlink" title="改善 Playbooks"></a>改善 Playbooks</h3><p>组织 playbooks 也已经有很多种现成的方式。在前面的例子中我们用了一个单独的文件，因此这方面被大幅地简化了。组织这些文件的一个常用方式是创建角色。简单来说，你将一个主文件加载为你的 playbook，而它将会从其它文件中导入所有的数据，这些其他的文件便是角色。举例来说，如果你有了一个 wordpress 网站，你需要一个 web 前端，和一个数据库。web 前端将包括一个 web 服务器，应用程序代码，以及任何需要的模块。数据库有时候运行在同一台主机上，有时候运行在远程的主机上，这时候角色就可以派上用场了。你创建一个目录，并对每个角色创建对应的小 playbook。在这个例子中我们需要一个 apache 角色，mysql 角色，wordpress 角色，mod_php，以及 php 角色。最大的好处是，并不是每个角色都必须被应用到同一台机器上。在这个例子中，mysql 可以被应用到一台单独的机器。这同样为代码重用提供了可能，比如你的 apache 角色还可以被用在 python 和其他相似的 php 应用程序中。展示这些已经有些超出了本文的范畴，而且做一件事总是有很多不同的方式，我建议搜索一些 ansible 的 playbook 例子。有很多人在 github 上贡献代码，当然还有其他一些网站。</p><h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><p>在 ansible 中，对于所有完成的工作，幕后的工作都是由模块主导的。Ansible 有一个非常丰富的内置模块仓库，其中包括软件包安装，文件传输，以及我们在本文中做的所有事情。但是对一部分人来说，这些并不能满足他们的配置需求，ansible 也提供了方法让你添加自己的模块。Ansible 的 API 有一个非常棒的事情是，它并没有限制模块也必须用编写它的语言 Python 来编写，也就是说，你可以用任何语言来编写模块。Ansible 模块通过传递 JSON 数据来工作，因此你只需要用想用的语言生成一段 JSON 数据。我很确定任何脚本语言都可以做到这一点，因此你现在就可以开始写点什么了。在 Ansible 的网站上有很多的文档，包括模块的接口是如何工作的，以及 Github 上也有很多模块的例子。注意一些小众的语言可能没有很好的支持，不过那只可能是因为没有多少人在用这种语言贡献代码。试着写点什么，然后把你的结果发布出来吧！</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>总的来说，虽然在配置管理方面已经有很多解决方案，我希望本文能显示出 ansible 简单的设置过程，在我看来这是它最重要的一个要点。请注意，因为我试图展示做一件事的不同方式，所以并不是前文中所有的例子都是适用于你的个别环境或者对于普遍情况的最佳实践。这里有一些链接能让你对 ansible 的了解进入下一个层次：</p><ul><li><a target="_blank" rel="noopener" href="http://www.ansible.com/">Ansible 项目</a>主页.</li><li><a target="_blank" rel="noopener" href="http://docs.ansible.com/">Ansible 项目文档</a>.</li><li><a target="_blank" rel="noopener" href="http://rosstuck.com/multistage-environments-with-ansible/">多级环境与 Ansible</a>.</li></ul><hr><p>via: <a target="_blank" rel="noopener" href="http://www.cyberciti.biz/python-tutorials/linux-tutorial-install-ansible-configuration-management-and-it-automation-tool/">http://www.cyberciti.biz/python-tutorials/linux-tutorial-install-ansible-configuration-management-and-it-automation-tool/</a></p><p>作者：<a target="_blank" rel="noopener" href="http://www.cyberciti.biz/tips/about-us">Nix Craft</a> 译者：<a target="_blank" rel="noopener" href="https://github.com/felixonmars">felixonmars</a> 校对：<a target="_blank" rel="noopener" href="https://github.com/wxy">wxy</a></p><p>本文由 <a target="_blank" rel="noopener" href="https://github.com/LCTT/TranslateProject">LCTT</a> 原创翻译，<a target="_blank" rel="noopener" href="http://linux.cn/">Linux中国</a> 荣誉推出</p></div></div></div><div class="footer"><p class="footer-copyright"><span>Powered by <a target="_blank" href="https://hexo.io">Hexo</a></span> <span>Theme <a target="_blank" href="https://github.com/tinkink-co/hexo-theme-terminal">Terminal</a></span><script type="text/javascript" src="https://cdn.staticfile.net/jquery/3.4.1/jquery.min.js"></script><script>getCDNinfo=function(){$.ajax({url:"/cdn-cgi/trace",success:function(a,n){let i="Antananarivo, Madagascar - (TNR);Cape Town, South Africa - (CPT);Casablanca, Morocco - (CMN);Dar Es Salaam, Tanzania - (DAR);Djibouti City, Djibouti - (JIB);Durban, South Africa - (DUR);Johannesburg, South Africa - (JNB);Kigali, Rwanda - (KGL);Lagos, Nigeria - (LOS);Luanda, Angola - (LAD);Maputo, MZ - (MPM);Mombasa, Kenya - (MBA);Port Louis, Mauritius - (MRU);Réunion, France - (RUN);Bangalore, India - (BLR);Bangkok, Thailand - (BKK);Bandar Seri Begawan, Brunei - (BWN);Cebu, Philippines - (CEB);Chengdu, China - (CTU);Chennai, India - (MAA);Chittagong, Bangladesh - (CGP);Chongqing, China - (CKG);Colombo, Sri Lanka - (CMB);Dhaka, Bangladesh - (DAC);Dongguan, China - (SZX);Foshan, China - (FUO);Fuzhou, China - (FOC);Guangzhou, China - (CAN);Hangzhou, China - (HGH);Hanoi, Vietnam - (HAN);Hengyang, China - (HNY);Ho Chi Minh City, Vietnam - (SGN);Hong Kong - (HKG);Hyderabad, India - (HYD);Islamabad, Pakistan - (ISB);Jakarta, Indonesia - (CGK);Jinan, China - (TNA);Karachi, Pakistan - (KHI);Kathmandu, Nepal - (KTM);Kolkata, India - (CCU);Kuala Lumpur, Malaysia - (KUL);Lahore, Pakistan - (LHE);Langfang, China - (NAY);Luoyang, China - (LYA);Macau - (MFM);Malé, Maldives - (MLE);Manila, Philippines - (MNL);Mumbai, India - (BOM);Nagpur, India - (NAG);Nanning, China - (NNG);New Delhi, India - (DEL);Osaka, Japan - (KIX);Phnom Penh, Cambodia - (PNH);Qingdao, China - (TAO);Seoul, South Korea - (ICN);Shanghai, China - (SHA);Shenyang, China - (SHE);Shijiazhuang, China - (SJW);Singapore, Singapore - (SIN);Suzhou, China - (SZV);Taipei - (TPE);Thimphu, Bhutan - (PBH);Tianjin, China - (TSN);Tokyo, Japan - (NRT);Ulaanbaatar, Mongolia - (ULN);Vientiane, Laos - (VTE);Wuhan, China - (WUH);Wuxi, China - (WUX);Xi'an, China - (XIY);Yerevan, Armenia - (EVN);Zhengzhou, China - (CGO);Zuzhou, China - (CSX);Amsterdam, Netherlands - (AMS);Athens, Greece - (ATH);Barcelona, Spain - (BCN);Belgrade, Serbia - (BEG);Berlin, Germany - (TXL);Brussels, Belgium - (BRU);Bucharest, Romania - (OTP);Budapest, Hungary - (BUD);Chișinău, Moldova - (KIV);Copenhagen, Denmark - (CPH);Cork, Ireland -  (ORK);Dublin, Ireland - (DUB);Düsseldorf, Germany - (DUS);Edinburgh, United Kingdom - (EDI);Frankfurt, Germany - (FRA);Geneva, Switzerland - (GVA);Gothenburg, Sweden - (GOT);Hamburg, Germany - (HAM);Helsinki, Finland - (HEL);Istanbul, Turkey - (IST);Kyiv, Ukraine - (KBP);Lisbon, Portugal - (LIS);London, United Kingdom - (LHR);Luxembourg City, Luxembourg - (LUX);Madrid, Spain - (MAD);Manchester, United Kingdom - (MAN);Marseille, France - (MRS);Milan, Italy - (MXP);Moscow, Russia - (DME);Munich, Germany - (MUC);Nicosia, Cyprus - (LCA);Oslo, Norway - (OSL);Paris, France - (CDG);Prague, Czech Republic - (PRG);Reykjavík, Iceland - (KEF);Riga, Latvia - (RIX);Rome, Italy - (FCO);Saint Petersburg, Russia - (LED);Sofia, Bulgaria - (SOF);Stockholm, Sweden - (ARN);Tallinn, Estonia - (TLL);Thessaloniki, Greece - (SKG);Vienna, Austria - (VIE);Vilnius, Lithuania - (VNO);Warsaw, Poland - (WAW);Zagreb, Croatia - (ZAG);Zürich, Switzerland - (ZRH);Arica, Chile - (ARI);Asunción, Paraguay - (ASU);Bogotá, Colombia - (BOG);Buenos Aires, Argentina - (EZE);Curitiba, Brazil - (CWB);Fortaleza, Brazil - (FOR);Guatemala City, Guatemala - (GUA);Lima, Peru - (LIM);Medellín, Colombia - (MDE);Panama City, Panama - (PTY);Porto Alegre, Brazil - (POA);Quito, Ecuador - (UIO);Rio de Janeiro, Brazil - (GIG);São Paulo, Brazil - (GRU);Santiago, Chile - (SCL);Willemstad, Curaçao - (CUR);St. George's, Grenada - (GND);Amman, Jordan - (AMM);Baghdad, Iraq - (BGW);Baku, Azerbaijan - (GYD);Beirut, Lebanon - (BEY);Doha, Qatar - (DOH);Dubai, United Arab Emirates - (DXB);Kuwait City, Kuwait - (KWI);Manama, Bahrain - (BAH);Muscat, Oman - (MCT);Ramallah - (ZDM);Riyadh, Saudi Arabia - (RUH);Tel Aviv, Israel - (TLV);Ashburn, VA, United States - (IAD);Atlanta, GA, United States - (ATL);Boston, MA, United States - (BOS);Buffalo, NY, United States - (BUF);Calgary, AB, Canada - (YYC);Charlotte, NC, United States - (CLT);Chicago, IL, United States - (ORD);Columbus, OH, United States - (CMH);Dallas, TX, United States - (DFW);Denver, CO, United States - (DEN);Detroit, MI, United States - (DTW);Honolulu, HI, United States - (HNL);Houston, TX, United States - (IAH);Indianapolis, IN, United States - (IND);Jacksonville, FL, United States - (JAX);Kansas City, MO, United States - (MCI);Las Vegas, NV, United States - (LAS);Los Angeles, CA, United States - (LAX);McAllen, TX, United States - (MFE);Memphis, TN, United States - (MEM);Mexico City, Mexico - (MEX);Miami, FL, United States - (MIA);Minneapolis, MN, United States - (MSP);Montgomery, AL, United States - (MGM);Montréal, QC, Canada - (YUL);Nashville, TN, United States - (BNA);Newark, NJ, United States - (EWR);Norfolk, VA, United States - (ORF);Omaha, NE, United States - (OMA);Philadelphia, United States - (PHL);Phoenix, AZ, United States - (PHX);Pittsburgh, PA, United States - (PIT);Port-Au-Prince, Haiti - (PAP);Portland, OR, United States - (PDX);Queretaro, MX, Mexico - (QRO);Richmond, Virginia - (RIC);Sacramento, CA, United States - (SMF);Salt Lake City, UT, United States - (SLC);San Diego, CA, United States - (SAN);San Jose, CA, United States - (SJC);Saskatoon, SK, Canada - (YXE);Seattle, WA, United States - (SEA);St. Louis, MO, United States - (STL);Tampa, FL, United States - (TPA);Toronto, ON, Canada - (YYZ);Vancouver, BC, Canada - (YVR);Tallahassee, FL, United States - (TLH);Winnipeg, MB, Canada - (YWG);Adelaide, SA, Australia - (ADL);Auckland, New Zealand - (AKL);Brisbane, QLD, Australia - (BNE);Melbourne, VIC, Australia - (MEL);Noumea, New caledonia - (NOU);Perth, WA, Australia - (PER);Sydney, NSW, Australia - (SYD)".split(";"),e=a.split("colo=")[1].split("\n")[0],t=(a.split("colo=")[1].split("\n")[0],a.split("tls=")[1].split("\n")[0]),o=a.split("http=")[1].split("\n")[0],s=a.split("sni=")[1].split("\n")[0],r=a.split("ip=")[1].split("\n")[0],l=a.split("uag=")[1].split("\n")[0];for(var d=0;d<i.length;d++)if(-1!=i[d].indexOf(e)){document.getElementById("cdn").innerHTML=i[d];break}document.getElementById("tls").innerHTML=t,document.getElementById("http").innerHTML=o,document.getElementById("sni").innerHTML=s,document.getElementById("ip").innerHTML=r,document.getElementById("useragent").innerHTML=l}})},$(document).ready((function(){getCDNinfo()}))</script></p><p style="text-align:center">感谢陪伴与布道，开源之火不灭。​</p><p style="text-align:center"><script>document.write("本次加载耗时: "+(performance.getEntriesByType("navigation").reduce((e,r)=>e+r.responseEnd-r.startTime,0)+performance.getEntriesByType("resource").reduce((e,r)=>e+r.responseEnd-r.startTime,0)).toFixed(0)+"ms")</script></p><p style="text-align:center">当前 SNI 状态： <span id="sni">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前 TLS 版本： <span id="tls">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前 HTTP 版本： <span id="http">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前您的客户端 IP 是： <span id="ip">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前分配的 CDN 节点是: <span id="cdn">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">您的 UserAgent 信息是: <span id="useragent">正在统计！或可能被浏览器防追踪拦截！</span></p><p></p><script defer src="https://pv.undefined.today/tracker.min.js" data-website-id="LinuxCNMirror-tracker"></script></div></div></body></html>