<!doctype html><html lang="en"><head><meta name="msvalidate.01" content="D404690CEFCB54C7762AC84935B99171"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6618da70c90c8744eead2e9371fb5077";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript">!function(t,e,n,c,s,a,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(a=e.createElement(c)).async=1,a.src="https://www.clarity.ms/tag/s5f3f0tojf",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(a,r)}(window,document,"clarity","script")</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="stylesheet" href="/styles/base.css"><link rel="stylesheet" href="/styles/theme.css"><link rel="shortcut icon" href="/favicon.png"><title>内核如何管理内存 - 归墟星火集 又一个 LinuxCN 站点</title><meta name="generator" content="Hexo 7.3.0"></head><body><div class="header-title"><span class="header-light"></span> <span class="header-light"></span> <span class="header-light"></span> <span>归墟星火集 又一个 LinuxCN 站点 linuxcn.undefined.today<span></span></span></div><div class="container"><ul class="nav"><li><a href="/">首页</a></li><li><a target="_blank" rel="noopener" href="https://undefined.today/">Blog</a></li></ul><div class="content"><div class="post-container"><div class="post-header"><span class="ui-tips">标题：</span><h1 class="ui-keyword post-title">内核如何管理内存</h1><span class="post-date">2018-03-01</span></div><div class="post-header"><span class="ui-tips">分类：</span> <a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></div><div class="post-header"><span class="ui-tips">标签：</span> <a href="/tags/%E5%86%85%E5%AD%98/">内存</a></div><div class="post-content"><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201802/28/002510zfsruzezb6b46oib.jpg"></p><p>在学习了进程的 <a href="/article-9255-1.html">虚拟地址布局</a> 之后，让我们回到内核，来学习它管理用户内存的机制。这里再次使用 Gonzo：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201802/28/002521ulnh0at3zieuc2el.png" alt="Linux kernel mm_struct"></p><p>Linux 进程在内核中是作为进程描述符 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28.1/include/linux/sched.h#L1075">task_struct</a> （LCTT 译注：它是在 Linux 中描述进程完整信息的一种数据结构）的实例来实现的。在 task_struct 中的 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28.1/include/linux/sched.h#L1129">mm</a> 域指向到<strong>内存描述符</strong>，<a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28.1/include/linux/mm_types.h#L173">mm_struct</a> 是一个程序在内存中的执行摘要。如上图所示，它保存了起始和结束内存段，进程使用的物理内存页面的 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28.1/include/linux/mm_types.h#L197">数量</a>（RSS <ruby>常驻内存大小 <rt>Resident Set Size</rt></ruby> ）、虚拟地址空间使用的 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28.1/include/linux/mm_types.h#L206">总数量</a>、以及其它片断。 在内存描述符中，我们可以获悉它有两种管理内存的方式：<strong>虚拟内存区域</strong>集和<strong>页面表</strong>。Gonzo 的内存区域如下所示：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201802/28/002523i6qh6hj00gageoeg.png" alt="Kernel memory descriptor and memory areas"></p><p>每个虚拟内存区域（VMA）是一个连续的虚拟地址范围；这些区域绝对不会重叠。一个 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28.1/include/linux/mm_types.h#L99">vm_area_struct</a> 的实例完整地描述了一个内存区域，包括它的起始和结束地址，<a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28/include/linux/mm.h#L76">flags</a> 决定了访问权限和行为，并且 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28.1/include/linux/mm_types.h#L150">vm_file</a> 域指定了映射到这个区域的文件（如果有的话）。（除了内存映射段的例外情况之外，）一个 VMA 是不能<strong>匿名</strong>映射文件的。上面的每个内存段（比如，堆、栈）都对应一个单个的 VMA。虽然它通常都使用在 x86 的机器上，但它并不是必需的。VMA 也不关心它们在哪个段中。</p><p>一个程序的 VMA 在内存描述符中是作为 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28.1/include/linux/mm_types.h#L174">mmap</a> 域的一个链接列表保存的，以起始虚拟地址为序进行排列，并且在 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28.1/include/linux/mm_types.h#L175">mm_rb</a> 域中作为一个 <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Red_black_tree">红黑树</a> 的根。红黑树允许内核通过给定的虚拟地址去快速搜索内存区域。在你读取文件 <code>/proc/pid_of_process/maps</code> 时，内核只是简单地读取每个进程的 VMA 的链接列表并<a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28.1/fs/proc/task_mmu.c#L201">显示它们</a>。</p><p>在 Windows 中，<a target="_blank" rel="noopener" href="http://www.nirsoft.net/kernel_struct/vista/EPROCESS.html">EPROCESS</a> 块大致类似于一个 task_struct 和 mm_struct 的结合。在 Windows 中模拟一个 VMA 的是虚拟地址描述符，或称为 <a target="_blank" rel="noopener" href="http://www.nirsoft.net/kernel_struct/vista/MMVAD.html">VAD</a>；它保存在一个 <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/AVL_tree">AVL 树</a> 中。你知道关于 Windows 和 Linux 之间最有趣的事情是什么吗？其实它们只有一点小差别。</p><p>4GB 虚拟地址空间被分配到<strong>页面</strong>中。在 32 位模式中的 x86 处理器中支持 4KB、2MB、以及 4MB 大小的页面。Linux 和 Windows 都使用大小为 4KB 的页面去映射用户的一部分虚拟地址空间。字节 0-4095 在页面 0 中，字节 4096-8191 在页面 1 中，依次类推。VMA 的大小 <em>必须是页面大小的倍数</em> 。下图是使用 4KB 大小页面的总数量为 3GB 的用户空间：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201802/28/002524t9zo90jm953oljs5.png" alt="4KB Pages Virtual User Space"></p><p>处理器通过查看<strong>页面表</strong>去转换一个虚拟内存地址到一个真实的物理内存地址。每个进程都有它自己的一组页面表；每当发生进程切换时，用户空间的页面表也同时切换。Linux 在内存描述符的 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28.1/include/linux/mm_types.h#L185">pgd</a> 域中保存了一个指向进程的页面表的指针。对于每个虚拟页面，页面表中都有一个相应的<strong>页面表条目</strong>（PTE），在常规的 x86 页面表中，它是一个简单的如下所示的大小为 4 字节的记录：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201802/28/002525vcqn5y5mcrl5mmwk.png" alt="x86 Page Table Entry (PTE) for 4KB page"></p><p>Linux 通过函数去 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28.1/arch/x86/include/asm/pgtable.h#L173">读取</a> 和 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28.1/arch/x86/include/asm/pgtable.h#L230">设置</a> PTE 条目中的每个标志位。标志位 P 告诉处理器这个虚拟页面是否<strong>在</strong>物理内存中。如果该位被清除（设置为 0），访问这个页面将触发一个页面故障。请记住，当这个标志位为 0 时，内核可以在剩余的域上<strong>做任何想做的事</strong>。R&#x2F;W 标志位是读&#x2F;写标志；如果被清除，这个页面将变成只读的。U&#x2F;S 标志位表示用户&#x2F;超级用户；如果被清除，这个页面将仅被内核访问。这些标志都是用于实现我们在前面看到的只读内存和内核空间保护。</p><p>标志位 D 和 A 用于标识页面是否是“<strong>脏的</strong>”或者是已<strong>被访问过</strong>。一个脏页面表示已经被写入，而一个被访问过的页面则表示有一个写入或者读取发生过。这两个标志位都是粘滞位：处理器只能设置它们，而清除则是由内核来完成的。最终，PTE 保存了这个页面相应的起始物理地址，它们按 4KB 进行整齐排列。这个看起来不起眼的域是一些痛苦的根源，因为它限制了物理内存最大为 <a target="_blank" rel="noopener" href="http://www.google.com/search?hl=en&amp;amp;amp;amp;amp;q=2%5E20+*+2%5E12+bytes+in+GB">4 GB</a>。其它的 PTE 域留到下次再讲，因为它是涉及了物理地址扩展的知识。</p><p>由于在一个虚拟页面上的所有字节都共享一个 U&#x2F;S 和 R&#x2F;W 标志位，所以内存保护的最小单元是一个虚拟页面。但是，同一个物理内存可能被映射到不同的虚拟页面，这样就有可能会出现相同的物理内存出现不同的保护标志位的情况。请注意，在 PTE 中是看不到运行权限的。这就是为什么经典的 x86 页面上允许代码在栈上被执行的原因，这样会很容易导致挖掘出栈缓冲溢出漏洞（可能会通过使用 <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Return-to-libc_attack">return-to-libc</a> 和其它技术来找出非可执行栈）。由于 PTE 缺少禁止运行标志位说明了一个更广泛的事实：在 VMA 中的权限标志位有可能或可能不完全转换为硬件保护。内核只能做它能做到的，但是，最终的架构限制了它能做的事情。</p><p>虚拟内存不保存任何东西，它只是简单地 <em>映射</em> 一个程序的地址空间到底层的物理内存上。物理内存被当作一个称之为<strong>物理地址空间</strong>的巨大块而由处理器访问。虽然内存的操作<a target="_blank" rel="noopener" href="http://duartes.org/gustavo/blog/post/getting-physical-with-memory">涉及到某些</a>总线，我们在这里先忽略它，并假设物理地址范围从 0 到可用的最大值按字节递增。物理地址空间被内核进一步分解为<strong>页面帧</strong>。处理器并不会关心帧的具体情况，这一点对内核也是至关重要的，因为，<strong>页面帧是物理内存管理的最小单元</strong>。Linux 和 Windows 在 32 位模式下都使用 4KB 大小的页面帧；下图是一个有 2 GB 内存的机器的例子：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201802/28/002526fotdzaaz3lfo71o3.png" alt="Physical Address Space"></p><p>在 Linux 上每个页面帧是被一个 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28/include/linux/mm_types.h#L32">描述符</a> 和 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28/include/linux/page-flags.h#L14">几个标志</a> 来跟踪的。通过这些描述符和标志，实现了对机器上整个物理内存的跟踪；每个页面帧的具体状态是公开的。物理内存是通过使用 <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Buddy_memory_allocation">Buddy 内存分配</a> （LCTT 译注：一种内存分配算法）技术来管理的，因此，如果一个页面帧可以通过 Buddy 系统分配，那么它是<strong>未分配的</strong>（free）。一个被分配的页面帧可以是<strong>匿名的</strong>、持有程序数据的、或者它可能处于页面缓存中、持有数据保存在一个文件或者块设备中。还有其它的异形页面帧，但是这些异形页面帧现在已经不怎么使用了。Windows 有一个类似的页面帧号（Page Frame Number (PFN)）数据库去跟踪物理内存。</p><p>我们把虚拟内存区域（VMA）、页面表条目（PTE），以及页面帧放在一起来理解它们是如何工作的。下面是一个用户堆的示例：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201802/28/002527vtlryfrybhpczb1t.png" alt="Physical Address Space"></p><p>蓝色的矩形框表示在 VMA 范围内的页面，而箭头表示页面表条目映射页面到页面帧。一些缺少箭头的虚拟页面，表示它们对应的 PTE 的当前标志位被清除（置为 0）。这可能是因为这个页面从来没有被使用过，或者是它的内容已经被交换出去了。在这两种情况下，即便这些页面在 VMA 中，访问它们也将导致产生一个页面故障。对于这种 VMA 和页面表的不一致的情况，看上去似乎很奇怪，但是这种情况却经常发生。</p><p>一个 VMA 像一个在你的程序和内核之间的合约。你请求它做一些事情（分配内存、文件映射、等等），内核会回应“收到”，然后去创建或者更新相应的 VMA。 但是，它 <em>并不立刻</em> 去“兑现”对你的承诺，而是它会等待到发生一个页面故障时才去 <em>真正</em> 做这个工作。内核是个“懒惰的家伙”、“不诚实的人渣”；这就是虚拟内存的基本原理。它适用于大多数的情况，有一些类似情况和有一些意外的情况，但是，它是规则是，VMA 记录 <em>约定的</em> 内容，而 PTE 才反映这个“懒惰的内核” <em>真正做了什么</em>。通过这两种数据结构共同来管理程序的内存；它们共同来完成解决页面故障、释放内存、从内存中交换出数据、等等。下图是内存分配的一个简单案例：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201802/28/002529buqbduf06ob36bqp.png" alt="Example of demand paging and memory allocation"></p><p>当程序通过 <a target="_blank" rel="noopener" href="http://www.kernel.org/doc/man-pages/online/pages/man2/brk.2.html">brk()</a> 系统调用来请求一些内存时，内核只是简单地 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28.1/mm/mmap.c#L2050">更新</a> 堆的 VMA 并给程序回复“已搞定”。而在这个时候并没有真正地分配页面帧，并且新的页面也没有映射到物理内存上。一旦程序尝试去访问这个页面时，处理器将发生页面故障，然后调用 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28/arch/x86/mm/fault.c#L583">do_page_fault()</a>。这个函数将使用 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28/mm/mmap.c#L1466">find_vma()</a> 去 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28/arch/x86/mm/fault.c#L692">搜索</a> 发生页面故障的 VMA。如果找到了，然后在 VMA 上进行权限检查以防范恶意访问（读取或者写入）。如果没有合适的 VMA，也没有所尝试访问的内存的“合约”，将会给进程返回段故障。</p><p>当<a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28/arch/x86/mm/fault.c#L711">找到</a>了一个合适的 VMA，内核必须通过查找 PTE 的内容和 VMA 的类型去<a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28/mm/memory.c#L2653">处理</a>故障。在我们的案例中，PTE 显示这个页面是 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28/mm/memory.c#L2674">不存在的</a>。事实上，我们的 PTE 是全部空白的（全部都是 0），在 Linux 中这表示虚拟内存还没有被映射。由于这是匿名 VMA，我们有一个完全的 RAM 事务，它必须被 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28/mm/memory.c#L2681">do_anonymous_page()</a> 来处理，它分配页面帧，并且用一个 PTE 去映射故障虚拟页面到一个新分配的帧。</p><p>有时候，事情可能会有所不同。例如，对于被交换出内存的页面的 PTE，在当前（Present）标志位上是 0，但它并不是空白的。而是在交换位置仍有页面内容，它必须从磁盘上读取并且通过 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28/mm/memory.c#L2280">do_swap_page()</a> 来加载到一个被称为 <a target="_blank" rel="noopener" href="http://lxr.linux.no/linux+v2.6.28/mm/memory.c#L2316">major fault</a> 的页面帧上。</p><p>这是我们通过探查内核的用户内存管理得出的前半部分的结论。在下一篇文章中，我们通过将文件加载到内存中，来构建一个完整的内存框架图，以及对性能的影响。</p><hr><p>via: <a target="_blank" rel="noopener" href="http://duartes.org/gustavo/blog/post/how-the-kernel-manages-your-memory/">http://duartes.org/gustavo/blog/post/how-the-kernel-manages-your-memory/</a></p><p>作者：<a target="_blank" rel="noopener" href="http://duartes.org/gustavo/blog/about/">Gustavo Duarte</a> 译者：<a target="_blank" rel="noopener" href="https://github.com/qhwdw">qhwdw</a> 校对：<a target="_blank" rel="noopener" href="https://github.com/wxy">wxy</a></p><p>本文由 <a target="_blank" rel="noopener" href="https://github.com/LCTT/TranslateProject">LCTT</a> 原创编译，<a target="_blank" rel="noopener" href="https://linux.cn/">Linux中国</a> 荣誉推出</p></div></div></div><div class="footer"><p class="footer-copyright"><span>Powered by <a target="_blank" href="https://hexo.io">Hexo</a></span> <span>Theme <a target="_blank" href="https://github.com/tinkink-co/hexo-theme-terminal">Terminal</a></span><script type="text/javascript" src="https://cdn.staticfile.net/jquery/3.4.1/jquery.min.js"></script><script>getCDNinfo=function(){$.ajax({url:"/cdn-cgi/trace",success:function(a,n){let i="Antananarivo, Madagascar - (TNR);Cape Town, South Africa - (CPT);Casablanca, Morocco - (CMN);Dar Es Salaam, Tanzania - (DAR);Djibouti City, Djibouti - (JIB);Durban, South Africa - (DUR);Johannesburg, South Africa - (JNB);Kigali, Rwanda - (KGL);Lagos, Nigeria - (LOS);Luanda, Angola - (LAD);Maputo, MZ - (MPM);Mombasa, Kenya - (MBA);Port Louis, Mauritius - (MRU);Réunion, France - (RUN);Bangalore, India - (BLR);Bangkok, Thailand - (BKK);Bandar Seri Begawan, Brunei - (BWN);Cebu, Philippines - (CEB);Chengdu, China - (CTU);Chennai, India - (MAA);Chittagong, Bangladesh - (CGP);Chongqing, China - (CKG);Colombo, Sri Lanka - (CMB);Dhaka, Bangladesh - (DAC);Dongguan, China - (SZX);Foshan, China - (FUO);Fuzhou, China - (FOC);Guangzhou, China - (CAN);Hangzhou, China - (HGH);Hanoi, Vietnam - (HAN);Hengyang, China - (HNY);Ho Chi Minh City, Vietnam - (SGN);Hong Kong - (HKG);Hyderabad, India - (HYD);Islamabad, Pakistan - (ISB);Jakarta, Indonesia - (CGK);Jinan, China - (TNA);Karachi, Pakistan - (KHI);Kathmandu, Nepal - (KTM);Kolkata, India - (CCU);Kuala Lumpur, Malaysia - (KUL);Lahore, Pakistan - (LHE);Langfang, China - (NAY);Luoyang, China - (LYA);Macau - (MFM);Malé, Maldives - (MLE);Manila, Philippines - (MNL);Mumbai, India - (BOM);Nagpur, India - (NAG);Nanning, China - (NNG);New Delhi, India - (DEL);Osaka, Japan - (KIX);Phnom Penh, Cambodia - (PNH);Qingdao, China - (TAO);Seoul, South Korea - (ICN);Shanghai, China - (SHA);Shenyang, China - (SHE);Shijiazhuang, China - (SJW);Singapore, Singapore - (SIN);Suzhou, China - (SZV);Taipei - (TPE);Thimphu, Bhutan - (PBH);Tianjin, China - (TSN);Tokyo, Japan - (NRT);Ulaanbaatar, Mongolia - (ULN);Vientiane, Laos - (VTE);Wuhan, China - (WUH);Wuxi, China - (WUX);Xi'an, China - (XIY);Yerevan, Armenia - (EVN);Zhengzhou, China - (CGO);Zuzhou, China - (CSX);Amsterdam, Netherlands - (AMS);Athens, Greece - (ATH);Barcelona, Spain - (BCN);Belgrade, Serbia - (BEG);Berlin, Germany - (TXL);Brussels, Belgium - (BRU);Bucharest, Romania - (OTP);Budapest, Hungary - (BUD);Chișinău, Moldova - (KIV);Copenhagen, Denmark - (CPH);Cork, Ireland -  (ORK);Dublin, Ireland - (DUB);Düsseldorf, Germany - (DUS);Edinburgh, United Kingdom - (EDI);Frankfurt, Germany - (FRA);Geneva, Switzerland - (GVA);Gothenburg, Sweden - (GOT);Hamburg, Germany - (HAM);Helsinki, Finland - (HEL);Istanbul, Turkey - (IST);Kyiv, Ukraine - (KBP);Lisbon, Portugal - (LIS);London, United Kingdom - (LHR);Luxembourg City, Luxembourg - (LUX);Madrid, Spain - (MAD);Manchester, United Kingdom - (MAN);Marseille, France - (MRS);Milan, Italy - (MXP);Moscow, Russia - (DME);Munich, Germany - (MUC);Nicosia, Cyprus - (LCA);Oslo, Norway - (OSL);Paris, France - (CDG);Prague, Czech Republic - (PRG);Reykjavík, Iceland - (KEF);Riga, Latvia - (RIX);Rome, Italy - (FCO);Saint Petersburg, Russia - (LED);Sofia, Bulgaria - (SOF);Stockholm, Sweden - (ARN);Tallinn, Estonia - (TLL);Thessaloniki, Greece - (SKG);Vienna, Austria - (VIE);Vilnius, Lithuania - (VNO);Warsaw, Poland - (WAW);Zagreb, Croatia - (ZAG);Zürich, Switzerland - (ZRH);Arica, Chile - (ARI);Asunción, Paraguay - (ASU);Bogotá, Colombia - (BOG);Buenos Aires, Argentina - (EZE);Curitiba, Brazil - (CWB);Fortaleza, Brazil - (FOR);Guatemala City, Guatemala - (GUA);Lima, Peru - (LIM);Medellín, Colombia - (MDE);Panama City, Panama - (PTY);Porto Alegre, Brazil - (POA);Quito, Ecuador - (UIO);Rio de Janeiro, Brazil - (GIG);São Paulo, Brazil - (GRU);Santiago, Chile - (SCL);Willemstad, Curaçao - (CUR);St. George's, Grenada - (GND);Amman, Jordan - (AMM);Baghdad, Iraq - (BGW);Baku, Azerbaijan - (GYD);Beirut, Lebanon - (BEY);Doha, Qatar - (DOH);Dubai, United Arab Emirates - (DXB);Kuwait City, Kuwait - (KWI);Manama, Bahrain - (BAH);Muscat, Oman - (MCT);Ramallah - (ZDM);Riyadh, Saudi Arabia - (RUH);Tel Aviv, Israel - (TLV);Ashburn, VA, United States - (IAD);Atlanta, GA, United States - (ATL);Boston, MA, United States - (BOS);Buffalo, NY, United States - (BUF);Calgary, AB, Canada - (YYC);Charlotte, NC, United States - (CLT);Chicago, IL, United States - (ORD);Columbus, OH, United States - (CMH);Dallas, TX, United States - (DFW);Denver, CO, United States - (DEN);Detroit, MI, United States - (DTW);Honolulu, HI, United States - (HNL);Houston, TX, United States - (IAH);Indianapolis, IN, United States - (IND);Jacksonville, FL, United States - (JAX);Kansas City, MO, United States - (MCI);Las Vegas, NV, United States - (LAS);Los Angeles, CA, United States - (LAX);McAllen, TX, United States - (MFE);Memphis, TN, United States - (MEM);Mexico City, Mexico - (MEX);Miami, FL, United States - (MIA);Minneapolis, MN, United States - (MSP);Montgomery, AL, United States - (MGM);Montréal, QC, Canada - (YUL);Nashville, TN, United States - (BNA);Newark, NJ, United States - (EWR);Norfolk, VA, United States - (ORF);Omaha, NE, United States - (OMA);Philadelphia, United States - (PHL);Phoenix, AZ, United States - (PHX);Pittsburgh, PA, United States - (PIT);Port-Au-Prince, Haiti - (PAP);Portland, OR, United States - (PDX);Queretaro, MX, Mexico - (QRO);Richmond, Virginia - (RIC);Sacramento, CA, United States - (SMF);Salt Lake City, UT, United States - (SLC);San Diego, CA, United States - (SAN);San Jose, CA, United States - (SJC);Saskatoon, SK, Canada - (YXE);Seattle, WA, United States - (SEA);St. Louis, MO, United States - (STL);Tampa, FL, United States - (TPA);Toronto, ON, Canada - (YYZ);Vancouver, BC, Canada - (YVR);Tallahassee, FL, United States - (TLH);Winnipeg, MB, Canada - (YWG);Adelaide, SA, Australia - (ADL);Auckland, New Zealand - (AKL);Brisbane, QLD, Australia - (BNE);Melbourne, VIC, Australia - (MEL);Noumea, New caledonia - (NOU);Perth, WA, Australia - (PER);Sydney, NSW, Australia - (SYD)".split(";"),e=a.split("colo=")[1].split("\n")[0],t=(a.split("colo=")[1].split("\n")[0],a.split("tls=")[1].split("\n")[0]),o=a.split("http=")[1].split("\n")[0],s=a.split("sni=")[1].split("\n")[0],r=a.split("ip=")[1].split("\n")[0],l=a.split("uag=")[1].split("\n")[0];for(var d=0;d<i.length;d++)if(-1!=i[d].indexOf(e)){document.getElementById("cdn").innerHTML=i[d];break}document.getElementById("tls").innerHTML=t,document.getElementById("http").innerHTML=o,document.getElementById("sni").innerHTML=s,document.getElementById("ip").innerHTML=r,document.getElementById("useragent").innerHTML=l}})},$(document).ready((function(){getCDNinfo()}))</script></p><p style="text-align:center">感谢陪伴与布道，开源之火不灭。​</p><p style="text-align:center"><script>document.write("本次加载耗时: "+(performance.getEntriesByType("navigation").reduce((e,r)=>e+r.responseEnd-r.startTime,0)+performance.getEntriesByType("resource").reduce((e,r)=>e+r.responseEnd-r.startTime,0)).toFixed(0)+"ms")</script></p><p style="text-align:center">当前 SNI 状态： <span id="sni">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前 TLS 版本： <span id="tls">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前 HTTP 版本： <span id="http">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前您的客户端 IP 是： <span id="ip">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前分配的 CDN 节点是: <span id="cdn">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">您的 UserAgent 信息是: <span id="useragent">正在统计！或可能被浏览器防追踪拦截！</span></p><p></p></div></div></body></html>