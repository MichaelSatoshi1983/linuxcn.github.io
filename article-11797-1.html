<!doctype html><html lang="en"><head><meta name="description" content="一个LinuxCN的镜像站"><meta name="msvalidate.01" content="D404690CEFCB54C7762AC84935B99171"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6618da70c90c8744eead2e9371fb5077";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript">!function(t,e,n,c,s,a,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(a=e.createElement(c)).async=1,a.src="https://www.clarity.ms/tag/s5f3f0tojf",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(a,r)}(window,document,"clarity","script")</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="stylesheet" href="/styles/base.css"><link rel="stylesheet" href="/styles/theme.css"><link rel="shortcut icon" href="/favicon.png"><title>6 个方便的 Git 脚本 - 归墟星火集 又一个 LinuxCN 站点</title><meta name="generator" content="Hexo 7.3.0"></head><body><div class="header-title"><span class="header-light"></span> <span class="header-light"></span> <span class="header-light"></span> <span>归墟星火集 又一个 LinuxCN 站点 linuxcn.undefined.today<span></span></span></div><div class="container"><ul class="nav"><li><a href="/">首页</a></li><li><a target="_blank" rel="noopener" href="https://undefined.today/">Blog</a></li></ul><div class="content"><div class="post-container"><div class="post-header"><span class="ui-tips">标题：</span><h1 class="ui-keyword post-title">6 个方便的 Git 脚本</h1><span class="post-date">2020-01-18</span></div><div class="post-header"><span class="ui-tips">分类：</span> <a href="/categories/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/">软件开发</a></div><div class="post-header"><span class="ui-tips">标签：</span> <a href="/tags/Git/">Git</a></div><div class="post-content"><blockquote><p>当使用 Git 存储库时，这六个 Bash 脚本将使你的生活更轻松。</p></blockquote><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/202001/18/231713jegbk8fyek798gxb.jpg"></p><p>我编写了许多 Bash 脚本，这些脚本使我在使用 Git 存储库时工作更加轻松。我的许多同事说没有必要：我所做的一切都可以用 Git 命令完成。虽然这可能是正确的，但我发现脚本远比尝试找出适当的 Git 命令来执行我想要的操作更加方便。</p><h3 id="1、gitlog"><a href="#1、gitlog" class="headerlink" title="1、gitlog"></a>1、gitlog</h3><p><code>gitlog</code> 打印针对 master 分支的当前补丁的简短列表。它从最旧到最新打印它们，并显示作者和描述，其中 <code>H</code> 代表 <code>HEAD</code>，<code>^</code> 代表 <code>HEAD^</code>，<code>2</code> 代表 <code>HEAD~2</code>，依此类推。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ gitlog</span><br><span class="line">-----------------------[ recovery25 ]-----------------------</span><br><span class="line">(snip)</span><br><span class="line">11 340d27a33895 Bob Peterson     gfs2: drain the ail2 list after io errors</span><br><span class="line">10 9b3c4e6efb10 Bob Peterson     gfs2: clean up iopen glock mess in gfs2_create_inode</span><br><span class="line"> 9 d2e8c22be39b Bob Peterson     gfs2: Do proper error checking for go_sync family of glops</span><br><span class="line"> 8 9563e31f8bfd Christoph Hellwig gfs2: use page_offset in gfs2_page_mkwrite</span><br><span class="line"> 7 ebac7a38036c Christoph Hellwig gfs2: don&#x27;t use buffer_heads in gfs2_allocate_page_backing</span><br><span class="line"> 6 f703a3c27874 Andreas Gruenbacher gfs2: Improve mmap write vs. punch_hole consistency</span><br><span class="line"> 5 a3e86d2ef30e Andreas Gruenbacher gfs2: Multi-block allocations in gfs2_page_mkwrite</span><br><span class="line"> 4 da3c604755b0 Andreas Gruenbacher gfs2: Fix end-of-file handling in gfs2_page_mkwrite</span><br><span class="line"> 3 4525c2f5b46f Bob Peterson     Rafael Aquini&#x27;s slab instrumentation</span><br><span class="line"> 2 a06a5b7dea02 Bob Peterson     GFS2: Add go_get_holdtime to gl_ops</span><br><span class="line"> ^ 8ba93c796d5c Bob Peterson     gfs2: introduce new function remaining_hold_time and use it in dq</span><br><span class="line"> H e8b5ff851bb9 Bob Peterson     gfs2: Allow rgrps to have a minimum hold time</span><br></pre></td></tr></table></figure><p>如果我想查看其他分支上有哪些补丁，可以指定一个替代分支：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitlog recovery24</span><br></pre></td></tr></table></figure><h3 id="2、gitlog-id"><a href="#2、gitlog-id" class="headerlink" title="2、gitlog.id"></a>2、gitlog.id</h3><p><code>gitlog.id</code> 只是打印出补丁的 SHA1 ID：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ gitlog.id</span><br><span class="line">-----------------------[ recovery25 ]-----------------------</span><br><span class="line">56908eeb6940 2ca4a6b628a1 fc64ad5d99fe 02031a00a251 f6f38da7dd18 d8546e8f0023 fc3cc1f98f6b 12c3e0cb3523 76cce178b134 6fc1dce3ab9c 1b681ab074ca 26fed8de719b 802ff51a5670 49f67a512d8c f04f20193bbb 5f6afe809d23 2030521dc70e dada79b3be94 9b19a1e08161 78a035041d3e f03da011cae2 0d2b2e068fcd 2449976aa133 57dfb5e12ccd 53abedfdcf72 6fbdda3474b3 49544a547188 187032f7a63c 6f75dae23d93 95fc2a261b00 ebfb14ded191 f653ee9e414a 0e2911cb8111 73968b76e2e3 8a3e4cb5e92c a5f2da803b5b 7c9ef68388ed 71ca19d0cba8 340d27a33895 9b3c4e6efb10 d2e8c22be39b 9563e31f8bfd ebac7a38036c f703a3c27874 a3e86d2ef30e da3c604755b0 4525c2f5b46f a06a5b7dea02 8ba93c796d5c e8b5ff851bb9</span><br></pre></td></tr></table></figure><p>同样，它假定是当前分支，但是如果需要，我可以指定其他分支。</p><h3 id="3、gitlog-id2"><a href="#3、gitlog-id2" class="headerlink" title="3、gitlog.id2"></a>3、gitlog.id2</h3><p><code>gitlog.id2</code> 与 <code>gitlog.id</code> 相同，但顶部没有显示分支的行。这对于从一个分支挑选所有补丁到当前分支很方便：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ # 创建一个新分支</span><br><span class="line">$ git branch --track origin/master</span><br><span class="line">$ # 检出刚刚创建的新分支</span><br><span class="line">$ git checkout recovery26</span><br><span class="line">$ # 从旧的分支挑选所有补丁到新分支</span><br><span class="line">$ for i in `gitlog.id2 recovery25` ; do git cherry-pick $i ;done</span><br></pre></td></tr></table></figure><h3 id="4、gitlog-grep"><a href="#4、gitlog-grep" class="headerlink" title="4、gitlog.grep"></a>4、gitlog.grep</h3><p><code>gitlog.grep</code> 会在该补丁集合中寻找一个字符串。例如，如果我发现一个错误并想修复引用了函数 <code>inode_go_sync</code> 的补丁，我可以简单地执行以下操作：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ gitlog.grep inode_go_sync</span><br><span class="line">-----------------------[ recovery25 - 50 patches ]-----------------------</span><br><span class="line">(snip)</span><br><span class="line">11 340d27a33895 Bob Peterson     gfs2: drain the ail2 list after io errors</span><br><span class="line">10 9b3c4e6efb10 Bob Peterson     gfs2: clean up iopen glock mess in gfs2_create_inode</span><br><span class="line"> 9 d2e8c22be39b Bob Peterson     gfs2: Do proper error checking for go_sync family of glops</span><br><span class="line">152:-static void inode_go_sync(struct gfs2_glock *gl)</span><br><span class="line">153:+static int inode_go_sync(struct gfs2_glock *gl)</span><br><span class="line">163:@@ -296,6 +302,7 @@ static void inode_go_sync(struct gfs2_glock *gl)</span><br><span class="line"> 8 9563e31f8bfd Christoph Hellwig gfs2: use page_offset in gfs2_page_mkwrite</span><br><span class="line"> 7 ebac7a38036c Christoph Hellwig gfs2: don&#x27;t use buffer_heads in gfs2_allocate_page_backing</span><br><span class="line"> 6 f703a3c27874 Andreas Gruenbacher gfs2: Improve mmap write vs. punch_hole consistency</span><br><span class="line"> 5 a3e86d2ef30e Andreas Gruenbacher gfs2: Multi-block allocations in gfs2_page_mkwrite</span><br><span class="line"> 4 da3c604755b0 Andreas Gruenbacher gfs2: Fix end-of-file handling in gfs2_page_mkwrite</span><br><span class="line"> 3 4525c2f5b46f Bob Peterson     Rafael Aquini&#x27;s slab instrumentation</span><br><span class="line"> 2 a06a5b7dea02 Bob Peterson     GFS2: Add go_get_holdtime to gl_ops</span><br><span class="line"> ^ 8ba93c796d5c Bob Peterson     gfs2: introduce new function remaining_hold_time and use it in dq</span><br><span class="line"> H e8b5ff851bb9 Bob Peterson     gfs2: Allow rgrps to have a minimum hold time</span><br></pre></td></tr></table></figure><p>因此，现在我知道补丁 <code>HEAD~9</code> 是需要修复的补丁。我使用 <code>git rebase -i HEAD~10</code> 编辑补丁 9，<code>git commit -a --amend</code>，然后 <code>git rebase --continue</code> 以进行必要的调整。</p><h3 id="5、gitbranchcmp3"><a href="#5、gitbranchcmp3" class="headerlink" title="5、gitbranchcmp3"></a>5、gitbranchcmp3</h3><p><code>gitbranchcmp3</code> 使我可以将当前分支与另一个分支进行比较，因此我可以将较旧版本的补丁与我的较新版本进行比较，并快速查看已更改和未更改的内容。它生成一个比较脚本（使用了 KDE 工具 <a target="_blank" rel="noopener" href="https://kde.org/applications/development/org.kde.kompare">Kompare</a>，该工具也可在 GNOME3 上使用）以比较不太相同的补丁。如果除行号外没有其他差异，则打印 <code>[SAME]</code>。如果仅存在注释差异，则打印 <code>[same]</code>（小写）。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ gitbranchcmp3 recovery24</span><br><span class="line">Branch recovery24 has 47 patches</span><br><span class="line">Branch recovery25 has 50 patches</span><br><span class="line"></span><br><span class="line">(snip)</span><br><span class="line">38 87eb6901607a 340d27a33895 [same] gfs2: drain the ail2 list after io errors</span><br><span class="line">39 90fefb577a26 9b3c4e6efb10 [same] gfs2: clean up iopen glock mess in gfs2_create_inode</span><br><span class="line">40 ba3ae06b8b0e d2e8c22be39b [same] gfs2: Do proper error checking for go_sync family of glops</span><br><span class="line">41 2ab662294329 9563e31f8bfd [SAME] gfs2: use page_offset in gfs2_page_mkwrite</span><br><span class="line">42 0adc6d817b7a ebac7a38036c [SAME] gfs2: don&#x27;t use buffer_heads in gfs2_allocate_page_backing</span><br><span class="line">43 55ef1f8d0be8 f703a3c27874 [SAME] gfs2: Improve mmap write vs. punch_hole consistency</span><br><span class="line">44 de57c2f72570 a3e86d2ef30e [SAME] gfs2: Multi-block allocations in gfs2_page_mkwrite</span><br><span class="line">45 7c5305fbd68a da3c604755b0 [SAME] gfs2: Fix end-of-file handling in gfs2_page_mkwrite</span><br><span class="line">46 162524005151 4525c2f5b46f [SAME] Rafael Aquini&#x27;s slab instrumentation</span><br><span class="line">47              a06a5b7dea02 [    ] GFS2: Add go_get_holdtime to gl_ops</span><br><span class="line">48              8ba93c796d5c [    ] gfs2: introduce new function remaining_hold_time and use it in dq</span><br><span class="line">49              e8b5ff851bb9 [    ] gfs2: Allow rgrps to have a minimum hold time</span><br><span class="line"></span><br><span class="line">Missing from recovery25:</span><br><span class="line">The missing:</span><br><span class="line">Compare script generated at: /tmp/compare_mismatches.sh</span><br></pre></td></tr></table></figure><h3 id="6、gitlog-find"><a href="#6、gitlog-find" class="headerlink" title="6、gitlog.find"></a>6、gitlog.find</h3><p>最后，我有一个 <code>gitlog.find</code> 脚本，可以帮助我识别补丁程序的上游版本在哪里以及每个补丁的当前状态。它通过匹配补丁说明来实现。它还会生成一个比较脚本（再次使用了 Kompare），以将当前补丁与上游对应补丁进行比较：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ gitlog.find</span><br><span class="line">-----------------------[ recovery25 - 50 patches ]-----------------------</span><br><span class="line">(snip)</span><br><span class="line">11 340d27a33895 Bob Peterson     gfs2: drain the ail2 list after io errors</span><br><span class="line">lo 5bcb9be74b2a Bob Peterson     gfs2: drain the ail2 list after io errors</span><br><span class="line">10 9b3c4e6efb10 Bob Peterson     gfs2: clean up iopen glock mess in gfs2_create_inode</span><br><span class="line">fn 2c47c1be51fb Bob Peterson     gfs2: clean up iopen glock mess in gfs2_create_inode</span><br><span class="line"> 9 d2e8c22be39b Bob Peterson     gfs2: Do proper error checking for go_sync family of glops</span><br><span class="line">lo feb7ea639472 Bob Peterson     gfs2: Do proper error checking for go_sync family of glops</span><br><span class="line"> 8 9563e31f8bfd Christoph Hellwig gfs2: use page_offset in gfs2_page_mkwrite</span><br><span class="line">ms f3915f83e84c Christoph Hellwig gfs2: use page_offset in gfs2_page_mkwrite</span><br><span class="line"> 7 ebac7a38036c Christoph Hellwig gfs2: don&#x27;t use buffer_heads in gfs2_allocate_page_backing</span><br><span class="line">ms 35af80aef99b Christoph Hellwig gfs2: don&#x27;t use buffer_heads in gfs2_allocate_page_backing</span><br><span class="line"> 6 f703a3c27874 Andreas Gruenbacher gfs2: Improve mmap write vs. punch_hole consistency</span><br><span class="line">fn 39c3a948ecf6 Andreas Gruenbacher gfs2: Improve mmap write vs. punch_hole consistency</span><br><span class="line"> 5 a3e86d2ef30e Andreas Gruenbacher gfs2: Multi-block allocations in gfs2_page_mkwrite</span><br><span class="line">fn f53056c43063 Andreas Gruenbacher gfs2: Multi-block allocations in gfs2_page_mkwrite</span><br><span class="line"> 4 da3c604755b0 Andreas Gruenbacher gfs2: Fix end-of-file handling in gfs2_page_mkwrite</span><br><span class="line">fn 184b4e60853d Andreas Gruenbacher gfs2: Fix end-of-file handling in gfs2_page_mkwrite</span><br><span class="line"> 3 4525c2f5b46f Bob Peterson     Rafael Aquini&#x27;s slab instrumentation</span><br><span class="line">   Not found upstream</span><br><span class="line"> 2 a06a5b7dea02 Bob Peterson     GFS2: Add go_get_holdtime to gl_ops</span><br><span class="line">   Not found upstream</span><br><span class="line"> ^ 8ba93c796d5c Bob Peterson     gfs2: introduce new function remaining_hold_time and use it in dq</span><br><span class="line">   Not found upstream</span><br><span class="line"> H e8b5ff851bb9 Bob Peterson     gfs2: Allow rgrps to have a minimum hold time</span><br><span class="line">   Not found upstream</span><br><span class="line">Compare script generated: /tmp/compare_upstream.sh</span><br></pre></td></tr></table></figure><p>补丁显示为两行，第一行是你当前的修补程序，然后是相应的上游补丁，以及 2 个字符的缩写，以指示其上游状态：</p><ul><li><code>lo</code> 表示补丁仅在本地（<code>local</code>）上游 Git 存储库中（即尚未推送到上游）。</li><li><code>ms</code> 表示补丁位于 Linus Torvald 的主（<code>master</code>）分支中。</li><li><code>fn</code> 意味着补丁被推送到我的 “for-next” 开发分支，用于下一个上游合并窗口。 我的一些脚本根据我通常使用 Git 的方式做出假设。例如，当搜索上游补丁时，它使用我众所周知的 Git 树的位置。因此，你需要调整或改进它们以适合你的条件。<code>gitlog.find</code> 脚本旨在仅定位 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/GFS2">GFS2</a> 和 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Distributed_lock_manager">DLM</a> 补丁，因此，除非你是 GFS2 开发人员，否则你需要针对你感兴趣的组件对其进行自定义。</li></ul><h3 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h3><p>以下是这些脚本的源代码。</p><h4 id="1、gitlog-1"><a href="#1、gitlog-1" class="headerlink" title="1、gitlog"></a>1、gitlog</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">branch=$1</span><br><span class="line"></span><br><span class="line">if test &quot;x$branch&quot; = x; then</span><br><span class="line">    branch=`git branch -a | grep &quot;*&quot; | cut -d &#x27; &#x27; -f2`</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">patches=0</span><br><span class="line">tracking=`git rev-parse --abbrev-ref --symbolic-full-name @&#123;u&#125;`</span><br><span class="line"></span><br><span class="line">LIST=`git log --reverse --abbrev-commit --pretty=oneline $tracking..$branch | cut -d &#x27; &#x27; -f1 |paste -s -d &#x27; &#x27;`</span><br><span class="line">for i in $LIST; do patches=$(echo $patches + 1 | bc);done</span><br><span class="line"></span><br><span class="line">if [[ $branch =~ .*for-next.* ]]</span><br><span class="line">then</span><br><span class="line">    start=HEAD</span><br><span class="line">#    start=origin/for-next</span><br><span class="line">else</span><br><span class="line">    start=origin/master</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">tracking=`git rev-parse --abbrev-ref --symbolic-full-name @&#123;u&#125;`</span><br><span class="line"></span><br><span class="line">/usr/bin/echo &quot;-----------------------[&quot; $branch &quot;]-----------------------&quot;</span><br><span class="line">patches=$(echo $patches - 1 | bc);</span><br><span class="line">for i in $LIST; do</span><br><span class="line">    if [ $patches -eq 1 ]; then</span><br><span class="line">        cnt=&quot; ^&quot;</span><br><span class="line">    elif [ $patches -eq 0 ]; then</span><br><span class="line">        cnt=&quot; H&quot;</span><br><span class="line">    else</span><br><span class="line">        if [ $patches -lt 10 ]; then</span><br><span class="line">            cnt=&quot; $patches&quot;</span><br><span class="line">        else</span><br><span class="line">            cnt=&quot;$patches&quot;</span><br><span class="line">        fi</span><br><span class="line">    fi</span><br><span class="line">    /usr/bin/git show --abbrev-commit -s --pretty=format:&quot;$cnt %h %&lt;|(32)%an %s %n&quot; $i</span><br><span class="line">    patches=$(echo $patches - 1 | bc)</span><br><span class="line">done</span><br><span class="line">#git log --reverse --abbrev-commit --pretty=format:&quot;%h %&lt;|(32)%an %s&quot; $tracking..$branch</span><br><span class="line">#git log --reverse --abbrev-commit --pretty=format:&quot;%h %&lt;|(32)%an %s&quot; ^origin/master ^linux-gfs2/for-next $branch</span><br></pre></td></tr></table></figure><h4 id="2、gitlog-id-1"><a href="#2、gitlog-id-1" class="headerlink" title="2、gitlog.id"></a>2、gitlog.id</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">branch=$1</span><br><span class="line"></span><br><span class="line">if test &quot;x$branch&quot; = x; then</span><br><span class="line">    branch=`git branch -a | grep &quot;*&quot; | cut -d &#x27; &#x27; -f2`</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">tracking=`git rev-parse --abbrev-ref --symbolic-full-name @&#123;u&#125;`</span><br><span class="line"></span><br><span class="line">/usr/bin/echo &quot;-----------------------[&quot; $branch &quot;]-----------------------&quot;</span><br><span class="line">git log --reverse --abbrev-commit --pretty=oneline $tracking..$branch | cut -d &#x27; &#x27; -f1 |paste -s -d &#x27; &#x27;</span><br></pre></td></tr></table></figure><h4 id="3、gitlog-id2-1"><a href="#3、gitlog-id2-1" class="headerlink" title="3、gitlog.id2"></a>3、gitlog.id2</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">branch=$1</span><br><span class="line"></span><br><span class="line">if test &quot;x$branch&quot; = x; then</span><br><span class="line">    branch=`git branch -a | grep &quot;*&quot; | cut -d &#x27; &#x27; -f2`</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">tracking=`git rev-parse --abbrev-ref --symbolic-full-name @&#123;u&#125;`</span><br><span class="line">git log --reverse --abbrev-commit --pretty=oneline $tracking..$branch | cut -d &#x27; &#x27; -f1 |paste -s -d &#x27; &#x27;</span><br></pre></td></tr></table></figure><h4 id="4、gitlog-grep-1"><a href="#4、gitlog-grep-1" class="headerlink" title="4、gitlog.grep"></a>4、gitlog.grep</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">param1=$1</span><br><span class="line">param2=$2</span><br><span class="line"></span><br><span class="line">if test &quot;x$param2&quot; = x; then</span><br><span class="line">    branch=`git branch -a | grep &quot;*&quot; | cut -d &#x27; &#x27; -f2`</span><br><span class="line">    string=$param1</span><br><span class="line">else</span><br><span class="line">    branch=$param1</span><br><span class="line">    string=$param2</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">patches=0</span><br><span class="line">tracking=`git rev-parse --abbrev-ref --symbolic-full-name @&#123;u&#125;`</span><br><span class="line"></span><br><span class="line">LIST=`git log --reverse --abbrev-commit --pretty=oneline $tracking..$branch | cut -d &#x27; &#x27; -f1 |paste -s -d &#x27; &#x27;`</span><br><span class="line">for i in $LIST; do patches=$(echo $patches + 1 | bc);done</span><br><span class="line">/usr/bin/echo &quot;-----------------------[&quot; $branch &quot;-&quot; $patches &quot;patches ]-----------------------&quot;</span><br><span class="line">patches=$(echo $patches - 1 | bc);</span><br><span class="line">for i in $LIST; do</span><br><span class="line">    if [ $patches -eq 1 ]; then</span><br><span class="line">        cnt=&quot; ^&quot;</span><br><span class="line">    elif [ $patches -eq 0 ]; then</span><br><span class="line">        cnt=&quot; H&quot;</span><br><span class="line">    else</span><br><span class="line">        if [ $patches -lt 10 ]; then</span><br><span class="line">            cnt=&quot; $patches&quot;</span><br><span class="line">        else</span><br><span class="line">            cnt=&quot;$patches&quot;</span><br><span class="line">        fi</span><br><span class="line">    fi</span><br><span class="line">    /usr/bin/git show --abbrev-commit -s --pretty=format:&quot;$cnt %h %&lt;|(32)%an %s&quot; $i</span><br><span class="line">    /usr/bin/git show --pretty=email --patch-with-stat $i | grep -n &quot;$string&quot;</span><br><span class="line">    patches=$(echo $patches - 1 | bc)</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h4 id="5、gitbranchcmp3-1"><a href="#5、gitbranchcmp3-1" class="headerlink" title="5、gitbranchcmp3"></a>5、gitbranchcmp3</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">#</span><br><span class="line"># gitbranchcmp3 &lt;old branch&gt; [&lt;new_branch&gt;]</span><br><span class="line">#</span><br><span class="line">oldbranch=$1</span><br><span class="line">newbranch=$2</span><br><span class="line">script=/tmp/compare_mismatches.sh</span><br><span class="line"></span><br><span class="line">/usr/bin/rm -f $script</span><br><span class="line">echo &quot;#!/bin/bash&quot; &gt; $script</span><br><span class="line">/usr/bin/chmod 755 $script</span><br><span class="line">echo &quot;# Generated by gitbranchcmp3.sh&quot; &gt;&gt; $script</span><br><span class="line">echo &quot;# Run this script to compare the mismatched patches&quot; &gt;&gt; $script</span><br><span class="line">echo &quot; &quot; &gt;&gt; $script</span><br><span class="line">echo &quot;function compare_them()&quot; &gt;&gt; $script</span><br><span class="line">echo &quot;&#123;&quot;  &gt;&gt; $script</span><br><span class="line">echo &quot;    git show --pretty=email --patch-with-stat \$1 &gt; /tmp/gronk1&quot; &gt;&gt; $script</span><br><span class="line">echo &quot;    git show --pretty=email --patch-with-stat \$2 &gt; /tmp/gronk2&quot; &gt;&gt; $script</span><br><span class="line">echo &quot;    kompare /tmp/gronk1 /tmp/gronk2&quot; &gt;&gt; $script</span><br><span class="line">echo &quot;&#125;&quot; &gt;&gt; $script</span><br><span class="line">echo &quot; &quot; &gt;&gt; $script</span><br><span class="line"></span><br><span class="line">if test &quot;x$newbranch&quot; = x; then</span><br><span class="line">    newbranch=`git branch -a | grep &quot;*&quot; | cut -d &#x27; &#x27; -f2`</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">tracking=`git rev-parse --abbrev-ref --symbolic-full-name @&#123;u&#125;`</span><br><span class="line"></span><br><span class="line">declare -a oldsha1s=(`git log --reverse --abbrev-commit --pretty=oneline $tracking..$oldbranch | cut -d &#x27; &#x27; -f1 |paste -s -d &#x27; &#x27;`)</span><br><span class="line">declare -a newsha1s=(`git log --reverse --abbrev-commit --pretty=oneline $tracking..$newbranch | cut -d &#x27; &#x27; -f1 |paste -s -d &#x27; &#x27;`)</span><br><span class="line"></span><br><span class="line">#echo &quot;old: &quot; $oldsha1s</span><br><span class="line">oldcount=$&#123;#oldsha1s[@]&#125;</span><br><span class="line">echo &quot;Branch $oldbranch has $oldcount patches&quot;</span><br><span class="line">oldcount=$(echo $oldcount - 1 | bc)</span><br><span class="line">#for o in `seq 0 $&#123;#oldsha1s[@]&#125;`; do</span><br><span class="line">#    echo -n $&#123;oldsha1s[$o]&#125; &quot; &quot;</span><br><span class="line">#    desc=`git show $i | head -5 | tail -1|cut -b5-`</span><br><span class="line">#done</span><br><span class="line"></span><br><span class="line">#echo &quot;new: &quot; $newsha1s</span><br><span class="line">newcount=$&#123;#newsha1s[@]&#125;</span><br><span class="line">echo &quot;Branch $newbranch has $newcount patches&quot;</span><br><span class="line">newcount=$(echo $newcount - 1 | bc)</span><br><span class="line">#for o in `seq 0 $&#123;#newsha1s[@]&#125;`; do</span><br><span class="line">#    echo -n $&#123;newsha1s[$o]&#125; &quot; &quot;</span><br><span class="line">#    desc=`git show $i | head -5 | tail -1|cut -b5-`</span><br><span class="line">#done</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">for new in `seq 0 $newcount`; do</span><br><span class="line">    newsha=$&#123;newsha1s[$new]&#125;</span><br><span class="line">    newdesc=`git show $newsha | head -5 | tail -1|cut -b5-`</span><br><span class="line">    oldsha=&quot;            &quot;</span><br><span class="line">    same=&quot;[    ]&quot;</span><br><span class="line">    for old in `seq 0 $oldcount`; do</span><br><span class="line">        if test &quot;$&#123;oldsha1s[$old]&#125;&quot; = &quot;match&quot;; then</span><br><span class="line">            continue;</span><br><span class="line">        fi</span><br><span class="line">        olddesc=`git show $&#123;oldsha1s[$old]&#125; | head -5 | tail -1|cut -b5-`</span><br><span class="line">        if test &quot;$olddesc&quot; = &quot;$newdesc&quot; ; then</span><br><span class="line">            oldsha=$&#123;oldsha1s[$old]&#125;</span><br><span class="line">            #echo $oldsha</span><br><span class="line">            git show $oldsha |tail -n +2 |grep -v &quot;index.*\.\.&quot; |grep -v &quot;@@&quot; &gt; /tmp/gronk1</span><br><span class="line">            git show $newsha |tail -n +2 |grep -v &quot;index.*\.\.&quot; |grep -v &quot;@@&quot;  &gt; /tmp/gronk2</span><br><span class="line">            diff /tmp/gronk1 /tmp/gronk2 &amp;&gt; /dev/null</span><br><span class="line">            if [ $? -eq 0 ] ;then</span><br><span class="line"># No differences</span><br><span class="line">                same=&quot;[SAME]&quot;</span><br><span class="line">                oldsha1s[$old]=&quot;match&quot;</span><br><span class="line">                break</span><br><span class="line">            fi</span><br><span class="line">            git show $oldsha |sed -n &#x27;/diff/,$p&#x27; |grep -v &quot;index.*\.\.&quot; |grep -v &quot;@@&quot; &gt; /tmp/gronk1</span><br><span class="line">            git show $newsha |sed -n &#x27;/diff/,$p&#x27; |grep -v &quot;index.*\.\.&quot; |grep -v &quot;@@&quot; &gt; /tmp/gronk2</span><br><span class="line">            diff /tmp/gronk1 /tmp/gronk2 &amp;&gt; /dev/null</span><br><span class="line">            if [ $? -eq 0 ] ;then</span><br><span class="line"># Differences in comments only</span><br><span class="line">                same=&quot;[same]&quot;</span><br><span class="line">                oldsha1s[$old]=&quot;match&quot;</span><br><span class="line">                break</span><br><span class="line">            fi</span><br><span class="line">            oldsha1s[$old]=&quot;match&quot;</span><br><span class="line">            echo &quot;compare_them $oldsha $newsha&quot; &gt;&gt; $script</span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">    echo &quot;$new $oldsha $newsha $same $newdesc&quot;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo</span><br><span class="line">echo &quot;Missing from $newbranch:&quot;</span><br><span class="line">the_missing=&quot;&quot;</span><br><span class="line"># Now run through the olds we haven&#x27;t matched up</span><br><span class="line">for old in `seq 0 $oldcount`; do</span><br><span class="line">    if test $&#123;oldsha1s[$old]&#125; != &quot;match&quot;; then</span><br><span class="line">        olddesc=`git show $&#123;oldsha1s[$old]&#125; | head -5 | tail -1|cut -b5-`</span><br><span class="line">        echo &quot;$&#123;oldsha1s[$old]&#125; $olddesc&quot;</span><br><span class="line">        the_missing=`echo &quot;$the_missing $&#123;oldsha1s[$old]&#125;&quot;`</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo &quot;The missing: &quot; $the_missing</span><br><span class="line">echo &quot;Compare script generated at: $script&quot;</span><br><span class="line">#git log --reverse --abbrev-commit --pretty=oneline $tracking..$branch | cut -d &#x27; &#x27; -f1 |paste -s -d &#x27; &#x27;</span><br></pre></td></tr></table></figure><h4 id="6、gitlog-find-1"><a href="#6、gitlog-find-1" class="headerlink" title="6、gitlog.find"></a>6、gitlog.find</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">#</span><br><span class="line"># Find the upstream equivalent patch</span><br><span class="line">#</span><br><span class="line"># gitlog.find</span><br><span class="line">#</span><br><span class="line">cwd=$PWD</span><br><span class="line">param1=$1</span><br><span class="line">ubranch=$2</span><br><span class="line">patches=0</span><br><span class="line">script=/tmp/compare_upstream.sh</span><br><span class="line">echo &quot;#!/bin/bash&quot; &gt; $script</span><br><span class="line">/usr/bin/chmod 755 $script</span><br><span class="line">echo &quot;# Generated by gitbranchcmp3.sh&quot; &gt;&gt; $script</span><br><span class="line">echo &quot;# Run this script to compare the mismatched patches&quot; &gt;&gt; $script</span><br><span class="line">echo &quot; &quot; &gt;&gt; $script</span><br><span class="line">echo &quot;function compare_them()&quot; &gt;&gt; $script</span><br><span class="line">echo &quot;&#123;&quot;  &gt;&gt; $script</span><br><span class="line">echo &quot;    cwd=$PWD&quot; &gt;&gt; $script</span><br><span class="line">echo &quot;    git show --pretty=email --patch-with-stat \$2 &gt; /tmp/gronk2&quot; &gt;&gt; $script</span><br><span class="line">echo &quot;    cd ~/linux.git/fs/gfs2&quot; &gt;&gt; $script</span><br><span class="line">echo &quot;    git show --pretty=email --patch-with-stat \$1 &gt; /tmp/gronk1&quot; &gt;&gt; $script</span><br><span class="line">echo &quot;    cd $cwd&quot; &gt;&gt; $script</span><br><span class="line">echo &quot;    kompare /tmp/gronk1 /tmp/gronk2&quot; &gt;&gt; $script</span><br><span class="line">echo &quot;&#125;&quot; &gt;&gt; $script</span><br><span class="line">echo &quot; &quot; &gt;&gt; $script</span><br><span class="line"></span><br><span class="line">#echo &quot;Gathering upstream patch info. Please wait.&quot;</span><br><span class="line">branch=`git branch -a | grep &quot;*&quot; | cut -d &#x27; &#x27; -f2`</span><br><span class="line">tracking=`git rev-parse --abbrev-ref --symbolic-full-name @&#123;u&#125;`</span><br><span class="line"></span><br><span class="line">cd ~/linux.git</span><br><span class="line">if test &quot;X$&#123;ubranch&#125;&quot; = &quot;X&quot;; then</span><br><span class="line">    ubranch=`git branch -a | grep &quot;*&quot; | cut -d &#x27; &#x27; -f2`</span><br><span class="line">fi</span><br><span class="line">utracking=`git rev-parse --abbrev-ref --symbolic-full-name @&#123;u&#125;`</span><br><span class="line">#</span><br><span class="line"># gather a list of gfs2 patches from master just in case we can&#x27;t find it</span><br><span class="line">#</span><br><span class="line">#git log --abbrev-commit --pretty=format:&quot;   %h %&lt;|(32)%an %s&quot; master |grep -i -e &quot;gfs2&quot; -e &quot;dlm&quot; &gt; /tmp/gronk</span><br><span class="line">git log --reverse --abbrev-commit --pretty=format:&quot;ms %h %&lt;|(32)%an %s&quot; master fs/gfs2/ &gt; /tmp/gronk.gfs2</span><br><span class="line"># ms = in Linus&#x27;s master</span><br><span class="line">git log --reverse --abbrev-commit --pretty=format:&quot;ms %h %&lt;|(32)%an %s&quot; master fs/dlm/ &gt; /tmp/gronk.dlm</span><br><span class="line"></span><br><span class="line">cd $cwd</span><br><span class="line">LIST=`git log --reverse --abbrev-commit --pretty=oneline $tracking..$branch | cut -d &#x27; &#x27; -f1 |paste -s -d &#x27; &#x27;`</span><br><span class="line">for i in $LIST; do patches=$(echo $patches + 1 | bc);done</span><br><span class="line">/usr/bin/echo &quot;-----------------------[&quot; $branch &quot;-&quot; $patches &quot;patches ]-----------------------&quot;</span><br><span class="line">patches=$(echo $patches - 1 | bc);</span><br><span class="line">for i in $LIST; do</span><br><span class="line">    if [ $patches -eq 1 ]; then</span><br><span class="line">        cnt=&quot; ^&quot;</span><br><span class="line">    elif [ $patches -eq 0 ]; then</span><br><span class="line">        cnt=&quot; H&quot;</span><br><span class="line">    else</span><br><span class="line">        if [ $patches -lt 10 ]; then</span><br><span class="line">            cnt=&quot; $patches&quot;</span><br><span class="line">        else</span><br><span class="line">            cnt=&quot;$patches&quot;</span><br><span class="line">        fi</span><br><span class="line">    fi</span><br><span class="line">    /usr/bin/git show --abbrev-commit -s --pretty=format:&quot;$cnt %h %&lt;|(32)%an %s&quot; $i</span><br><span class="line">    desc=`/usr/bin/git show --abbrev-commit -s --pretty=format:&quot;%s&quot; $i`</span><br><span class="line">    cd ~/linux.git</span><br><span class="line">    cmp=1</span><br><span class="line">    up_eq=`git log --reverse --abbrev-commit --pretty=format:&quot;lo %h %&lt;|(32)%an %s&quot; $utracking..$ubranch | grep &quot;$desc&quot;`</span><br><span class="line"># lo = in local for-next</span><br><span class="line">    if test &quot;X$up_eq&quot; = &quot;X&quot;; then</span><br><span class="line">        up_eq=`git log --reverse --abbrev-commit --pretty=format:&quot;fn %h %&lt;|(32)%an %s&quot; master..$utracking | grep &quot;$desc&quot;`</span><br><span class="line"># fn = in for-next for next merge window</span><br><span class="line">        if test &quot;X$up_eq&quot; = &quot;X&quot;; then</span><br><span class="line">            up_eq=`grep &quot;$desc&quot; /tmp/gronk.gfs2`</span><br><span class="line">            if test &quot;X$up_eq&quot; = &quot;X&quot;; then</span><br><span class="line">                up_eq=`grep &quot;$desc&quot; /tmp/gronk.dlm`</span><br><span class="line">                if test &quot;X$up_eq&quot; = &quot;X&quot;; then</span><br><span class="line">                    up_eq=&quot;   Not found upstream&quot;</span><br><span class="line">                    cmp=0</span><br><span class="line">                fi</span><br><span class="line">            fi</span><br><span class="line">        fi</span><br><span class="line">    fi</span><br><span class="line">    echo &quot;$up_eq&quot;</span><br><span class="line">    if [ $cmp -eq 1 ] ; then</span><br><span class="line">        UP_SHA1=`echo $up_eq|cut -d&#x27; &#x27; -f2`</span><br><span class="line">        echo &quot;compare_them $UP_SHA1 $i&quot; &gt;&gt; $script</span><br><span class="line">    fi</span><br><span class="line">    cd $cwd</span><br><span class="line">    patches=$(echo $patches - 1 | bc)</span><br><span class="line">done</span><br><span class="line">echo &quot;Compare script generated: $script&quot;</span><br></pre></td></tr></table></figure><hr><p>via: <a target="_blank" rel="noopener" href="https://opensource.com/article/20/1/bash-scripts-git">https://opensource.com/article/20/1/bash-scripts-git</a></p><p>作者：<a target="_blank" rel="noopener" href="https://opensource.com/users/bobpeterson">Bob Peterson</a> 选题：<a target="_blank" rel="noopener" href="https://github.com/lujun9972">lujun9972</a> 译者：<a target="_blank" rel="noopener" href="https://github.com/wxy">wxy</a> 校对：<a target="_blank" rel="noopener" href="https://github.com/wxy">wxy</a></p><p>本文由 <a target="_blank" rel="noopener" href="https://github.com/LCTT/TranslateProject">LCTT</a> 原创编译，<a target="_blank" rel="noopener" href="https://linux.cn/">Linux中国</a> 荣誉推出</p></div></div></div><div class="footer"><p class="footer-copyright"><span>Powered by <a target="_blank" href="https://hexo.io">Hexo</a></span> <span>Theme <a target="_blank" href="https://github.com/tinkink-co/hexo-theme-terminal">Terminal</a></span><script type="text/javascript" src="https://cdn.staticfile.net/jquery/3.4.1/jquery.min.js"></script><script>getCDNinfo=function(){$.ajax({url:"/cdn-cgi/trace",success:function(a,n){let i="Antananarivo, Madagascar - (TNR);Cape Town, South Africa - (CPT);Casablanca, Morocco - (CMN);Dar Es Salaam, Tanzania - (DAR);Djibouti City, Djibouti - (JIB);Durban, South Africa - (DUR);Johannesburg, South Africa - (JNB);Kigali, Rwanda - (KGL);Lagos, Nigeria - (LOS);Luanda, Angola - (LAD);Maputo, MZ - (MPM);Mombasa, Kenya - (MBA);Port Louis, Mauritius - (MRU);Réunion, France - (RUN);Bangalore, India - (BLR);Bangkok, Thailand - (BKK);Bandar Seri Begawan, Brunei - (BWN);Cebu, Philippines - (CEB);Chengdu, China - (CTU);Chennai, India - (MAA);Chittagong, Bangladesh - (CGP);Chongqing, China - (CKG);Colombo, Sri Lanka - (CMB);Dhaka, Bangladesh - (DAC);Dongguan, China - (SZX);Foshan, China - (FUO);Fuzhou, China - (FOC);Guangzhou, China - (CAN);Hangzhou, China - (HGH);Hanoi, Vietnam - (HAN);Hengyang, China - (HNY);Ho Chi Minh City, Vietnam - (SGN);Hong Kong - (HKG);Hyderabad, India - (HYD);Islamabad, Pakistan - (ISB);Jakarta, Indonesia - (CGK);Jinan, China - (TNA);Karachi, Pakistan - (KHI);Kathmandu, Nepal - (KTM);Kolkata, India - (CCU);Kuala Lumpur, Malaysia - (KUL);Lahore, Pakistan - (LHE);Langfang, China - (NAY);Luoyang, China - (LYA);Macau - (MFM);Malé, Maldives - (MLE);Manila, Philippines - (MNL);Mumbai, India - (BOM);Nagpur, India - (NAG);Nanning, China - (NNG);New Delhi, India - (DEL);Osaka, Japan - (KIX);Phnom Penh, Cambodia - (PNH);Qingdao, China - (TAO);Seoul, South Korea - (ICN);Shanghai, China - (SHA);Shenyang, China - (SHE);Shijiazhuang, China - (SJW);Singapore, Singapore - (SIN);Suzhou, China - (SZV);Taipei - (TPE);Thimphu, Bhutan - (PBH);Tianjin, China - (TSN);Tokyo, Japan - (NRT);Ulaanbaatar, Mongolia - (ULN);Vientiane, Laos - (VTE);Wuhan, China - (WUH);Wuxi, China - (WUX);Xi'an, China - (XIY);Yerevan, Armenia - (EVN);Zhengzhou, China - (CGO);Zuzhou, China - (CSX);Amsterdam, Netherlands - (AMS);Athens, Greece - (ATH);Barcelona, Spain - (BCN);Belgrade, Serbia - (BEG);Berlin, Germany - (TXL);Brussels, Belgium - (BRU);Bucharest, Romania - (OTP);Budapest, Hungary - (BUD);Chișinău, Moldova - (KIV);Copenhagen, Denmark - (CPH);Cork, Ireland -  (ORK);Dublin, Ireland - (DUB);Düsseldorf, Germany - (DUS);Edinburgh, United Kingdom - (EDI);Frankfurt, Germany - (FRA);Geneva, Switzerland - (GVA);Gothenburg, Sweden - (GOT);Hamburg, Germany - (HAM);Helsinki, Finland - (HEL);Istanbul, Turkey - (IST);Kyiv, Ukraine - (KBP);Lisbon, Portugal - (LIS);London, United Kingdom - (LHR);Luxembourg City, Luxembourg - (LUX);Madrid, Spain - (MAD);Manchester, United Kingdom - (MAN);Marseille, France - (MRS);Milan, Italy - (MXP);Moscow, Russia - (DME);Munich, Germany - (MUC);Nicosia, Cyprus - (LCA);Oslo, Norway - (OSL);Paris, France - (CDG);Prague, Czech Republic - (PRG);Reykjavík, Iceland - (KEF);Riga, Latvia - (RIX);Rome, Italy - (FCO);Saint Petersburg, Russia - (LED);Sofia, Bulgaria - (SOF);Stockholm, Sweden - (ARN);Tallinn, Estonia - (TLL);Thessaloniki, Greece - (SKG);Vienna, Austria - (VIE);Vilnius, Lithuania - (VNO);Warsaw, Poland - (WAW);Zagreb, Croatia - (ZAG);Zürich, Switzerland - (ZRH);Arica, Chile - (ARI);Asunción, Paraguay - (ASU);Bogotá, Colombia - (BOG);Buenos Aires, Argentina - (EZE);Curitiba, Brazil - (CWB);Fortaleza, Brazil - (FOR);Guatemala City, Guatemala - (GUA);Lima, Peru - (LIM);Medellín, Colombia - (MDE);Panama City, Panama - (PTY);Porto Alegre, Brazil - (POA);Quito, Ecuador - (UIO);Rio de Janeiro, Brazil - (GIG);São Paulo, Brazil - (GRU);Santiago, Chile - (SCL);Willemstad, Curaçao - (CUR);St. George's, Grenada - (GND);Amman, Jordan - (AMM);Baghdad, Iraq - (BGW);Baku, Azerbaijan - (GYD);Beirut, Lebanon - (BEY);Doha, Qatar - (DOH);Dubai, United Arab Emirates - (DXB);Kuwait City, Kuwait - (KWI);Manama, Bahrain - (BAH);Muscat, Oman - (MCT);Ramallah - (ZDM);Riyadh, Saudi Arabia - (RUH);Tel Aviv, Israel - (TLV);Ashburn, VA, United States - (IAD);Atlanta, GA, United States - (ATL);Boston, MA, United States - (BOS);Buffalo, NY, United States - (BUF);Calgary, AB, Canada - (YYC);Charlotte, NC, United States - (CLT);Chicago, IL, United States - (ORD);Columbus, OH, United States - (CMH);Dallas, TX, United States - (DFW);Denver, CO, United States - (DEN);Detroit, MI, United States - (DTW);Honolulu, HI, United States - (HNL);Houston, TX, United States - (IAH);Indianapolis, IN, United States - (IND);Jacksonville, FL, United States - (JAX);Kansas City, MO, United States - (MCI);Las Vegas, NV, United States - (LAS);Los Angeles, CA, United States - (LAX);McAllen, TX, United States - (MFE);Memphis, TN, United States - (MEM);Mexico City, Mexico - (MEX);Miami, FL, United States - (MIA);Minneapolis, MN, United States - (MSP);Montgomery, AL, United States - (MGM);Montréal, QC, Canada - (YUL);Nashville, TN, United States - (BNA);Newark, NJ, United States - (EWR);Norfolk, VA, United States - (ORF);Omaha, NE, United States - (OMA);Philadelphia, United States - (PHL);Phoenix, AZ, United States - (PHX);Pittsburgh, PA, United States - (PIT);Port-Au-Prince, Haiti - (PAP);Portland, OR, United States - (PDX);Queretaro, MX, Mexico - (QRO);Richmond, Virginia - (RIC);Sacramento, CA, United States - (SMF);Salt Lake City, UT, United States - (SLC);San Diego, CA, United States - (SAN);San Jose, CA, United States - (SJC);Saskatoon, SK, Canada - (YXE);Seattle, WA, United States - (SEA);St. Louis, MO, United States - (STL);Tampa, FL, United States - (TPA);Toronto, ON, Canada - (YYZ);Vancouver, BC, Canada - (YVR);Tallahassee, FL, United States - (TLH);Winnipeg, MB, Canada - (YWG);Adelaide, SA, Australia - (ADL);Auckland, New Zealand - (AKL);Brisbane, QLD, Australia - (BNE);Melbourne, VIC, Australia - (MEL);Noumea, New caledonia - (NOU);Perth, WA, Australia - (PER);Sydney, NSW, Australia - (SYD)".split(";"),e=a.split("colo=")[1].split("\n")[0],t=(a.split("colo=")[1].split("\n")[0],a.split("tls=")[1].split("\n")[0]),o=a.split("http=")[1].split("\n")[0],s=a.split("sni=")[1].split("\n")[0],r=a.split("ip=")[1].split("\n")[0],l=a.split("uag=")[1].split("\n")[0];for(var d=0;d<i.length;d++)if(-1!=i[d].indexOf(e)){document.getElementById("cdn").innerHTML=i[d];break}document.getElementById("tls").innerHTML=t,document.getElementById("http").innerHTML=o,document.getElementById("sni").innerHTML=s,document.getElementById("ip").innerHTML=r,document.getElementById("useragent").innerHTML=l}})},$(document).ready((function(){getCDNinfo()}))</script></p><p style="text-align:center">感谢陪伴与布道，开源之火不灭。​</p><p style="text-align:center"><script>document.write("本次加载耗时: "+(performance.getEntriesByType("navigation").reduce((e,r)=>e+r.responseEnd-r.startTime,0)+performance.getEntriesByType("resource").reduce((e,r)=>e+r.responseEnd-r.startTime,0)).toFixed(0)+"ms")</script></p><p style="text-align:center">当前 SNI 状态： <span id="sni">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前 TLS 版本： <span id="tls">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前 HTTP 版本： <span id="http">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前您的客户端 IP 是： <span id="ip">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前分配的 CDN 节点是: <span id="cdn">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">您的 UserAgent 信息是: <span id="useragent">正在统计！或可能被浏览器防追踪拦截！</span></p><p></p><script defer src="https://pv.undefined.today/tracker.min.js" data-website-id="LinuxCNMirror-tracker"></script></div></div></body></html>