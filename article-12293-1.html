<!doctype html><html lang="en"><head><meta name="msvalidate.01" content="D404690CEFCB54C7762AC84935B99171"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6618da70c90c8744eead2e9371fb5077";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript">!function(t,e,n,c,s,a,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(a=e.createElement(c)).async=1,a.src="https://www.clarity.ms/tag/s5f3f0tojf",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(a,r)}(window,document,"clarity","script")</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="stylesheet" href="/styles/base.css"><link rel="stylesheet" href="/styles/theme.css"><link rel="shortcut icon" href="/favicon.png"><title>OpenSSL 精粹：SSL 证书、私钥和 CSR - 归墟星火集 又一个 LinuxCN 站点</title><meta name="generator" content="Hexo 7.3.0"></head><body><div class="header-title"><span class="header-light"></span> <span class="header-light"></span> <span class="header-light"></span> <span>归墟星火集 又一个 LinuxCN 站点 linuxcn.undefined.today<span></span></span></div><div class="container"><ul class="nav"><li><a href="/">首页</a></li><li><a target="_blank" rel="noopener" href="https://undefined.today/">Blog</a></li></ul><div class="content"><div class="post-container"><div class="post-header"><span class="ui-tips">标题：</span><h1 class="ui-keyword post-title">OpenSSL 精粹：SSL 证书、私钥和 CSR</h1><span class="post-date">2020-06-07</span></div><div class="post-header"><span class="ui-tips">分类：</span> <a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></div><div class="post-header"><span class="ui-tips">标签：</span> <a href="/tags/OpenSSL/">OpenSSL</a> <a href="/tags/%E8%AF%81%E4%B9%A6/">证书</a></div><div class="post-content"><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/202006/07/225825y6frhbm2ozvfamoa.jpg"></p><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>OpenSSL 是一个多功能的命令行工具，可以用于与<ruby>公钥基础设施 <rp>（ </rp><rt>Public Key Infrastructure</rt> <rp>）</rp></ruby>（PKI）和 HTTPS（HTTP over TLS）相关的大量任务。这本小抄风格的指南提供了 OpenSSL 命令的快速参考，这些命令在常见的日常场景中非常有用。这包括生成私钥、<ruby>证书签署请求 <rp>（ </rp><rt>certificate signing request</rt> <rp>）</rp></ruby>（CSR）和证书格式转换的 OpenSSL 示例，但它并没有涵盖 OpenSSL 的所有用途。</p><h3 id="如何使用本指南"><a href="#如何使用本指南" class="headerlink" title="如何使用本指南"></a>如何使用本指南</h3><ul><li>如果你不熟悉证书签署请求（CSR），请阅读第一部分。</li><li>除了第一部分，本指南采用了简单的小抄格式：自带了命令行代码片段。</li><li>跳到与你准备完成的任务相关的任何部分。</li><li>大多数命令都是单行的，为了清晰起见，已经扩展到多行（使用 <code>\</code> 符号）。</li></ul><h3 id="关于证书签署请求（CSR）"><a href="#关于证书签署请求（CSR）" class="headerlink" title="关于证书签署请求（CSR）"></a>关于证书签署请求（CSR）</h3><p>如果你想从<ruby>证书颁发机构 <rp>（ </rp><rt>certificate authority</rt> <rp>）</rp></ruby>（CA）那里获得 SSL 证书，你必须生成一个<ruby>证书签署请求 <rp>（ </rp><rt>certificate signing request</rt> <rp>）</rp></ruby>（CSR）。一个 CSR 主要是由一个密钥对的公钥和一些附加信息组成。当证书被签署时，这两部分都会被插入到证书中。</p><p>每当你生成一个 CSR 时，你会被提示提供有关证书的信息。这些信息被称为<ruby>区分名称 <rp>（ </rp><rt>Distinguised Name</rt> <rp>）</rp></ruby>（DN）。DN 中的一个重要字段是<ruby>通用名称 <rp>（ </rp><rt>Common Name</rt> <rp>）</rp></ruby>（CN），它应该是你打算使用证书的主机的<ruby>完全合格域名 <rp>（ </rp><rt>Fully Qualified Domain Name</rt> <rp>）</rp></ruby>（FQDN）。当创建 CSR 时，也可以通过命令行或文件传递信息来跳过交互式提示。</p><p>DN 中的其他项目提供了有关你的业务或组织的附加信息。如果你是从证书机构购买 SSL 证书，通常要求这些附加字段（如“<ruby>组织 <rp>（ </rp><rt>Organization</rt> <rp>）</rp></ruby>”）准确地反映你的组织的详细信息。</p><p>下面是一个 CSR 信息提示的例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">Country Name (2 letter code) [AU]:US</span><br><span class="line">State or Province Name (full name) [Some-State]:New York</span><br><span class="line">Locality Name (eg, city) []:Brooklyn</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:Example Brooklyn Company</span><br><span class="line">Organizational Unit Name (eg, section) []:Technology Division</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:examplebrooklyn.com</span><br><span class="line">Email Address []:</span><br></pre></td></tr></table></figure><p>如果你想非交互式地回答 CSR 信息提示，你可以通过在任何请求 CSR 信息的 OpenSSL 命令中添加 <code>-subj</code> 选项来实现。这里是该选项的一个例子，使用上面代码块中显示的相同信息：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-subj &quot;/C=US/ST=New York/L=Brooklyn/O=Example Brooklyn Company/CN=examplebrooklyn.com&quot;</span><br></pre></td></tr></table></figure><p>现在你已经了解了 CSR，可以自由跳转到本指南中涵盖你的 OpenSSL 需求的任何一节。</p><h3 id="生成-CSR"><a href="#生成-CSR" class="headerlink" title="生成 CSR"></a>生成 CSR</h3><p>本节介绍了与生成 CSR（以及私钥，如果它们还不存在的话）有关的 OpenSSL 命令。CSR 可以用来向证书颁发机构请求 SSL 证书。</p><p>请记住，你可以通过上一节中提到的 <code>-subj</code> 选项非交互式地添加 CSR 信息。</p><h4 id="生成一个私钥和一个-CSR"><a href="#生成一个私钥和一个-CSR" class="headerlink" title="生成一个私钥和一个 CSR"></a>生成一个私钥和一个 CSR</h4><p>如果你想使用 HTTPS（HTTP over TLS）来保护你的 Apache HTTP 或 Nginx Web 服务器的安全，并且你想使用一个证书颁发机构（CA）来颁发 SSL 证书，那么就使用这个方法。生成的 CSR 可以发送给 CA，请求签发由 CA 签名的 SSL 证书。如果你的 CA 支持 SHA-2，请添加 <code>-sha256</code> 选项，用 SHA-2 签署 CSR。</p><p>这条命令从头开始创建一个 2048 位的私钥（<code>domain.key</code>）和一个 CSR（<code>domain.csr</code>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl req \</span><br><span class="line">       -newkey rsa:2048 -nodes -keyout domain.key \</span><br><span class="line">       -out domain.csr</span><br></pre></td></tr></table></figure><p>回答 CSR 信息提问，完成该过程。</p><p>选项 <code>-newkey rsa:2048</code> 指定密钥应该是 <code>2048</code> 位，使用 <code>RSA</code> 算法生成。选项 <code>-nodes</code> 指定私钥<em>没有</em>用密码加密。这里没有包含 <code>-new</code> 选项，而是隐含在其中，表示正在生成一个 CSR。</p><h4 id="从现有的私钥中生成一个-CSR"><a href="#从现有的私钥中生成一个-CSR" class="headerlink" title="从现有的私钥中生成一个 CSR"></a>从现有的私钥中生成一个 CSR</h4><p>如果你已经有了私钥，并想用它向 CA 申请证书，请使用这个方法。</p><p>该命令基于现有的私钥（<code>domain.key</code>）创建一个新的 CSR（<code>domain.csr</code>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl req \</span><br><span class="line">       -key domain.key \</span><br><span class="line">       -new -out domain.csr</span><br></pre></td></tr></table></figure><p>回答 CSR 信息提问，完成该过程。</p><p>选项 <code>-key</code> 指定一个现有的私钥（<code>domain.key</code>)，它将被用来生成一个新的 CSR。选项 <code>-new</code> 表示正在生成一个 CSR。</p><h4 id="从现有的证书和私钥生成-CSR"><a href="#从现有的证书和私钥生成-CSR" class="headerlink" title="从现有的证书和私钥生成 CSR"></a>从现有的证书和私钥生成 CSR</h4><p>如果你想更新现有的证书，但由于某些原因，你或你的 CA 没有原始的 CSR，请使用这个方法。基本上可以省去重新输入 CSR 信息的麻烦，因为它是从现有证书中提取信息的。</p><p>该命令基于现有的证书（<code>domain.crt</code>）和私钥（<code>domain.key</code>）创建一个新的 CSR（<code>domain.csr</code>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 \</span><br><span class="line">       -in domain.crt \</span><br><span class="line">       -signkey domain.key \</span><br><span class="line">       -x509toreq -out domain.csr</span><br></pre></td></tr></table></figure><p>选项 <code>-x509toreq</code> 指定你使用一个 X509 证书来制作 CSR。</p><h3 id="生成-SSL-证书"><a href="#生成-SSL-证书" class="headerlink" title="生成 SSL 证书"></a>生成 SSL 证书</h3><p>如果你想使用 SSL 证书来确保服务的安全，但你不需要 CA 签名的证书，一个有效的（和免费的）解决方案是签署你自己的证书。</p><p>你可以自己签发的一种常见证书是<ruby>自签证书 <rp>（ </rp><rt>self-signed certificate</rt> <rp>）</rp></ruby>。自签证书是用自己的私钥签署的证书。自签证书和 CA 签名证书一样可以用来加密数据，但是你的用户会显示一个警告，说这个证书不被他们的计算机或浏览器信任。因此，只有当你不需要向用户证明你的服务身份时，才可以使用自签名证书（例如非生产或非公开服务器）。</p><p>本节介绍与生成自签名证书相关的 OpenSSL 命令。</p><h4 id="生成自签证书"><a href="#生成自签证书" class="headerlink" title="生成自签证书"></a>生成自签证书</h4><p>如果你想使用 HTTPS（HTTP over TLS）来保护你的 Apache HTTP 或 Nginx Web 服务器，并且你不需要你的证书由 CA 签名，那么就使用这个方法。</p><p>这个命令可以从头开始创建一个 2048 位的私钥（<code>domain.key</code>）和一个自签证书（<code>domain.crt</code>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl req \</span><br><span class="line">       -newkey rsa:2048 -nodes -keyout domain.key \</span><br><span class="line">       -x509 -days 365 -out domain.crt</span><br></pre></td></tr></table></figure><p>回答 CSR 信息提问，完成该过程。</p><p>选项 <code>-x509</code> 告诉 <code>req</code> 子命令创建一个自签名的证书。<code>-days 365</code> 选项指定证书的有效期为 <code>365</code> 天。它会生成一个临时的 CSR，以收集与证书相关的信息。</p><h4 id="从现有私钥生成自签名证书"><a href="#从现有私钥生成自签名证书" class="headerlink" title="从现有私钥生成自签名证书"></a>从现有私钥生成自签名证书</h4><p>如果你已经有了一个私钥，并且你想用它来生成一个自签证书，请使用这个方法。</p><p>这条命令可以从现有的私钥（<code>domain.key</code>）中创建一个自签证书（<code>domain.crt</code>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl req \</span><br><span class="line">       -key domain.key \</span><br><span class="line">       -new \</span><br><span class="line">       -x509 -days 365 -out domain.crt</span><br></pre></td></tr></table></figure><p>回答 CSR 信息提问，完成该过程。</p><p>选项 <code>-x509</code> 告诉 <code>req</code> 子命令创建一个自签证书。<code>-days 365</code> 选项指定证书的有效期为 <code>365</code> 天。选项 <code>-new</code> 启用 CSR 信息提问。</p><h4 id="从现有的私钥和-CSR-生成自签证书"><a href="#从现有的私钥和-CSR-生成自签证书" class="headerlink" title="从现有的私钥和 CSR 生成自签证书"></a>从现有的私钥和 CSR 生成自签证书</h4><p>如果你已经有了私钥和 CSR，并且你想用它们生成一个自签证书，请使用这个方法。</p><p>这条命令将从现有的私钥（<code>domain.key</code>）和（<code>domain.csr</code>）中创建一个自签证书（<code>domain.crt</code>）。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 \</span><br><span class="line">       -signkey domain.key \</span><br><span class="line">       -in domain.csr \</span><br><span class="line">       -req -days 365 -out domain.crt</span><br></pre></td></tr></table></figure><p>选项 <code>-days 365</code> 指定证书的有效期为 <code>365</code> 天。</p><h3 id="查看证书"><a href="#查看证书" class="headerlink" title="查看证书"></a>查看证书</h3><p>证书和 CSR 文件是以 PEM 格式编码的，不适合被人读取。</p><p>本节介绍的 OpenSSL 命令将输出 PEM 编码文件的实际条目。</p><h4 id="查看-CSR-条目"><a href="#查看-CSR-条目" class="headerlink" title="查看 CSR 条目"></a>查看 CSR 条目</h4><p>该命令允许你查看和验证纯文本的 CSR（<code>domain.csr</code>）的内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl req \  </span><br><span class="line">       -text -noout -verify \  </span><br><span class="line">       -in domain.csr</span><br></pre></td></tr></table></figure><h4 id="查看证书条目"><a href="#查看证书条目" class="headerlink" title="查看证书条目"></a>查看证书条目</h4><p>该命令允许你查看纯文本证书（<code>domain.crt</code>）的内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 \  </span><br><span class="line">       -text -noout \  </span><br><span class="line">       -in domain.crt</span><br></pre></td></tr></table></figure><h4 id="验证证书由-CA-签署"><a href="#验证证书由-CA-签署" class="headerlink" title="验证证书由 CA 签署"></a>验证证书由 CA 签署</h4><p>使用此命令验证证书（<code>domain.crt</code>）是否由特定的 CA 证书（<code>ca.crt</code>）签署：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl verify \  </span><br><span class="line">       -verbose -CAFile ca.crt \  </span><br><span class="line">       domain.crt</span><br></pre></td></tr></table></figure><h3 id="私钥"><a href="#私钥" class="headerlink" title="私钥"></a>私钥</h3><p>本节介绍了用于创建和验证私钥的 OpenSSL 命令。</p><h4 id="创建私钥"><a href="#创建私钥" class="headerlink" title="创建私钥"></a>创建私钥</h4><p>使用该命令创建一个受密码保护的 <code>2048</code> 位私钥（<code>domain.key</code>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa \  </span><br><span class="line">       -des3 -out domain.key 2048</span><br></pre></td></tr></table></figure><p>在提示时输入密码以完成该过程。</p><h4 id="验证私钥"><a href="#验证私钥" class="headerlink" title="验证私钥"></a>验证私钥</h4><p>使用此命令检查私钥（<code>domain.key</code>）是否为有效密钥：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa \  </span><br><span class="line">       -check -in domain.key</span><br></pre></td></tr></table></figure><p>如果你的私钥已经加密，系统会提示你输入它的密码，成功后，未加密的密钥会在终端上输出。</p><h4 id="验证私钥是否与证书和-CSR-匹配"><a href="#验证私钥是否与证书和-CSR-匹配" class="headerlink" title="验证私钥是否与证书和 CSR 匹配"></a>验证私钥是否与证书和 CSR 匹配</h4><p>使用这些命令来验证私钥（<code>domain.key</code>）是否匹配证书（<code>domain.crt</code>）和 CSR（<code>domain.csr</code>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa  -noout -modulus -in domain.key | openssl md5</span><br><span class="line">openssl x509 -noout -modulus -in domain.crt | openssl md5</span><br><span class="line">openssl req  -noout -modulus -in domain.csr | openssl md5</span><br></pre></td></tr></table></figure><p>如果每条命令的输出都是相同的，那么私钥、证书和 CSR 就极有可能是相关的。</p><h4 id="加密私钥"><a href="#加密私钥" class="headerlink" title="加密私钥"></a>加密私钥</h4><p>这需要一个未加密的私钥（<code>unencrypted.key</code>），并输出它的加密版本（<code>encrypted.key</code>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -des3 \</span><br><span class="line">       -in unencrypted.key \</span><br><span class="line">       -out encrypted.key</span><br></pre></td></tr></table></figure><p>输入你所需的密码，以加密私钥。</p><h4 id="解密私钥"><a href="#解密私钥" class="headerlink" title="解密私钥"></a>解密私钥</h4><p>这需要一个加密的私钥（<code>encrypted.key</code>），并输出一个解密的版本（<code>decrypted.key</code>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa \</span><br><span class="line">       -in encrypted.key \</span><br><span class="line">       -out decrypted.key</span><br></pre></td></tr></table></figure><p>在提示时，输入加密密钥的密码。</p><h3 id="转换证书格式"><a href="#转换证书格式" class="headerlink" title="转换证书格式"></a>转换证书格式</h3><p>我们一直在使用的所有证书都是 ASCII 码 PEM 编码的 X.509 证书。还有很多其他的证书编码和容器类型；一些应用程序喜欢某些格式而不是其他格式。此外，这些格式中的许多格式可以在一个文件中包含多个项目，如私钥、证书和 CA 证书。</p><p>OpenSSL 可以用来将证书在则西格式间转换。本节将介绍一些可能的转换。</p><h4 id="将-PEM-转换为-DER"><a href="#将-PEM-转换为-DER" class="headerlink" title="将 PEM 转换为 DER"></a>将 PEM 转换为 DER</h4><p>如果要将 PEM 编码的证书（<code>domain.crt</code>）转换为 DER 编码的证书（<code>domain.der</code>），即二进制格式，请使用此命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 \</span><br><span class="line">       -in domain.crt \</span><br><span class="line">       -outform der -out domain.der</span><br></pre></td></tr></table></figure><p>DER 格式通常与 Java 一起使用。</p><h4 id="将-DER-转换为-PEM"><a href="#将-DER-转换为-PEM" class="headerlink" title="将 DER 转换为 PEM"></a>将 DER 转换为 PEM</h4><p>如果要将 DER 编码的证书（<code>domain.der</code>）转换为 PEM 编码的证书（<code>domain.crt</code>），请使用此命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 \</span><br><span class="line">       -inform der -in domain.der \</span><br><span class="line">       -out domain.crt</span><br></pre></td></tr></table></figure><h4 id="将-PEM-转换为-PKCS7"><a href="#将-PEM-转换为-PKCS7" class="headerlink" title="将 PEM 转换为 PKCS7"></a>将 PEM 转换为 PKCS7</h4><p>如果你想把 PEM 证书（<code>domain.crt</code> 和 <code>ca-chain.crt</code>）添加到 PKCS7 文件（<code>domain.p7b</code>）中，请使用该命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl crl2pkcs7 -nocrl \</span><br><span class="line">       -certfile domain.crt \</span><br><span class="line">       -certfile ca-chain.crt \</span><br><span class="line">       -out domain.p7b</span><br></pre></td></tr></table></figure><p>请注意，你可以使用一个或多个 <code>-certfile</code> 选项来指定要添加到 PKCS7 文件中的证书。</p><p>PKCS7 文件，也被称为 P7B，通常用于 Java Keystores 和 Microsoft IIS（Windows）。它们是 ASCII 文件，可以包含证书和 CA 证书。</p><h4 id="将-PKCS7-转换为-PEM"><a href="#将-PKCS7-转换为-PEM" class="headerlink" title="将 PKCS7 转换为 PEM"></a>将 PKCS7 转换为 PEM</h4><p>如果你想将 PKCS7 文件（<code>domain.p7b</code>）转换为 PEM 文件，请使用该命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs7 \</span><br><span class="line">       -in domain.p7b \</span><br><span class="line">       -print_certs -out domain.crt</span><br></pre></td></tr></table></figure><p>请注意，如果你的 PKCS7 文件中有多个项目（如证书和 CA 中间证书)，创建的 PEM 文件将包含其中的所有项目。</p><h4 id="将-PEM-转换为-PKCS12"><a href="#将-PEM-转换为-PKCS12" class="headerlink" title="将 PEM 转换为 PKCS12"></a>将 PEM 转换为 PKCS12</h4><p>如果你想使用私钥（<code>domain.key</code>）和证书（<code>domain.crt</code>），并将它们组合成一个 PKCS12 文件（<code>domain.pfx</code>），请使用这个命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 \</span><br><span class="line">       -inkey domain.key \</span><br><span class="line">       -in domain.crt \</span><br><span class="line">       -export -out domain.pfx</span><br></pre></td></tr></table></figure><p>系统会提示你输入导出密码，你可以留空。请注意，在这种情况下，你可以通过将多个证书连接到一个 PEM 文件（<code>domain.crt</code>）中来添加一个证书链到 PKCS12 文件中。</p><p>PKCS12 文件，也被称为 PFX 文件，通常用于在 Micrsoft IIS（Windows）中导入和导出证书链。</p><h4 id="将-PKCS12-转换为-PEM"><a href="#将-PKCS12-转换为-PEM" class="headerlink" title="将 PKCS12 转换为 PEM"></a>将 PKCS12 转换为 PEM</h4><p>如果你想转换 PKCS12 文件（<code>domain.pfx</code>）并将其转换为 PEM 格式（<code>domain.combined.crt</code>），请使用此命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 \</span><br><span class="line">       -in domain.pfx \</span><br><span class="line">       -nodes -out domain.combined.crt</span><br></pre></td></tr></table></figure><p>请注意，如果你的 PKCS12 文件中有多个项目（如证书和私钥），创建的 PEM 文件将包含其中的所有项目。</p><h3 id="OpenSSL-版本"><a href="#OpenSSL-版本" class="headerlink" title="OpenSSL 版本"></a>OpenSSL 版本</h3><p><code>openssl version</code> 命令可以用来检查你正在运行的版本。你正在运行的 OpenSSL 版本，以及编译时使用的选项会影响到你可以使用的功能（有时也会影响到命令行选项）。</p><p>下面的命令显示了你正在运行的 OpenSSL 版本，以及它被编译时的所有选项：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl version -a</span><br></pre></td></tr></table></figure><p>本指南是使用具有如下细节的 OpenSSL 二进制文件编写的（参见前面命令的输出）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">OpenSSL 1.0.1f 6 Jan 2014</span><br><span class="line">built on: Mon Apr  7 21:22:23 UTC 2014</span><br><span class="line">platform: debian-amd64</span><br><span class="line">options:  bn(64,64) rc4(16x,int) des(idx,cisc,16,int) blowfish(idx)</span><br><span class="line">compiler: cc -fPIC -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -m64 -DL_ENDIAN -DTERMIO -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -Wl,-Bsymbolic-functions -Wl,-z,relro -Wa,--noexecstack -Wall -DMD32_REG_T=int -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM</span><br><span class="line">OPENSSLDIR: &quot;/usr/lib/ssl&quot;</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这应该涵盖了大多数人如何使用 OpenSSL 来处理 SSL 证书的情况！它还有很多其他的用途，在这里没有介绍，所以请在评论中随时询问或建议其他用途。</p><p>如果你在使用这些命令时遇到了问题，请一定要评论（并附上你的 OpenSSL 版本输出）。</p><hr><p>via: <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/openssl-essentials-working-with-ssl-certificates-private-keys-and-csrs">https://www.digitalocean.com/community/tutorials/openssl-essentials-working-with-ssl-certificates-private-keys-and-csrs</a></p><p>作者：<a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/users/manicas">Mitchell Anicas</a> 选题：<a target="_blank" rel="noopener" href="https://github.com/wxy">wxy</a> 译者：<a target="_blank" rel="noopener" href="https://github.com/wxy">wxy</a> 校对：<a target="_blank" rel="noopener" href="https://github.com/wxy">wxy</a></p><p>本文由 <a target="_blank" rel="noopener" href="https://github.com/LCTT/TranslateProject">LCTT</a> 原创编译，<a href="/article-12290-1.html">Linux中国</a> 荣誉推出</p></div></div></div><div class="footer"><p class="footer-copyright"><span>Powered by <a target="_blank" href="https://hexo.io">Hexo</a></span> <span>Theme <a target="_blank" href="https://github.com/tinkink-co/hexo-theme-terminal">Terminal</a></span><script type="text/javascript" src="https://cdn.staticfile.net/jquery/3.4.1/jquery.min.js"></script><script>getCDNinfo=function(){$.ajax({url:"/cdn-cgi/trace",success:function(a,n){let i="Antananarivo, Madagascar - (TNR);Cape Town, South Africa - (CPT);Casablanca, Morocco - (CMN);Dar Es Salaam, Tanzania - (DAR);Djibouti City, Djibouti - (JIB);Durban, South Africa - (DUR);Johannesburg, South Africa - (JNB);Kigali, Rwanda - (KGL);Lagos, Nigeria - (LOS);Luanda, Angola - (LAD);Maputo, MZ - (MPM);Mombasa, Kenya - (MBA);Port Louis, Mauritius - (MRU);Réunion, France - (RUN);Bangalore, India - (BLR);Bangkok, Thailand - (BKK);Bandar Seri Begawan, Brunei - (BWN);Cebu, Philippines - (CEB);Chengdu, China - (CTU);Chennai, India - (MAA);Chittagong, Bangladesh - (CGP);Chongqing, China - (CKG);Colombo, Sri Lanka - (CMB);Dhaka, Bangladesh - (DAC);Dongguan, China - (SZX);Foshan, China - (FUO);Fuzhou, China - (FOC);Guangzhou, China - (CAN);Hangzhou, China - (HGH);Hanoi, Vietnam - (HAN);Hengyang, China - (HNY);Ho Chi Minh City, Vietnam - (SGN);Hong Kong - (HKG);Hyderabad, India - (HYD);Islamabad, Pakistan - (ISB);Jakarta, Indonesia - (CGK);Jinan, China - (TNA);Karachi, Pakistan - (KHI);Kathmandu, Nepal - (KTM);Kolkata, India - (CCU);Kuala Lumpur, Malaysia - (KUL);Lahore, Pakistan - (LHE);Langfang, China - (NAY);Luoyang, China - (LYA);Macau - (MFM);Malé, Maldives - (MLE);Manila, Philippines - (MNL);Mumbai, India - (BOM);Nagpur, India - (NAG);Nanning, China - (NNG);New Delhi, India - (DEL);Osaka, Japan - (KIX);Phnom Penh, Cambodia - (PNH);Qingdao, China - (TAO);Seoul, South Korea - (ICN);Shanghai, China - (SHA);Shenyang, China - (SHE);Shijiazhuang, China - (SJW);Singapore, Singapore - (SIN);Suzhou, China - (SZV);Taipei - (TPE);Thimphu, Bhutan - (PBH);Tianjin, China - (TSN);Tokyo, Japan - (NRT);Ulaanbaatar, Mongolia - (ULN);Vientiane, Laos - (VTE);Wuhan, China - (WUH);Wuxi, China - (WUX);Xi'an, China - (XIY);Yerevan, Armenia - (EVN);Zhengzhou, China - (CGO);Zuzhou, China - (CSX);Amsterdam, Netherlands - (AMS);Athens, Greece - (ATH);Barcelona, Spain - (BCN);Belgrade, Serbia - (BEG);Berlin, Germany - (TXL);Brussels, Belgium - (BRU);Bucharest, Romania - (OTP);Budapest, Hungary - (BUD);Chișinău, Moldova - (KIV);Copenhagen, Denmark - (CPH);Cork, Ireland -  (ORK);Dublin, Ireland - (DUB);Düsseldorf, Germany - (DUS);Edinburgh, United Kingdom - (EDI);Frankfurt, Germany - (FRA);Geneva, Switzerland - (GVA);Gothenburg, Sweden - (GOT);Hamburg, Germany - (HAM);Helsinki, Finland - (HEL);Istanbul, Turkey - (IST);Kyiv, Ukraine - (KBP);Lisbon, Portugal - (LIS);London, United Kingdom - (LHR);Luxembourg City, Luxembourg - (LUX);Madrid, Spain - (MAD);Manchester, United Kingdom - (MAN);Marseille, France - (MRS);Milan, Italy - (MXP);Moscow, Russia - (DME);Munich, Germany - (MUC);Nicosia, Cyprus - (LCA);Oslo, Norway - (OSL);Paris, France - (CDG);Prague, Czech Republic - (PRG);Reykjavík, Iceland - (KEF);Riga, Latvia - (RIX);Rome, Italy - (FCO);Saint Petersburg, Russia - (LED);Sofia, Bulgaria - (SOF);Stockholm, Sweden - (ARN);Tallinn, Estonia - (TLL);Thessaloniki, Greece - (SKG);Vienna, Austria - (VIE);Vilnius, Lithuania - (VNO);Warsaw, Poland - (WAW);Zagreb, Croatia - (ZAG);Zürich, Switzerland - (ZRH);Arica, Chile - (ARI);Asunción, Paraguay - (ASU);Bogotá, Colombia - (BOG);Buenos Aires, Argentina - (EZE);Curitiba, Brazil - (CWB);Fortaleza, Brazil - (FOR);Guatemala City, Guatemala - (GUA);Lima, Peru - (LIM);Medellín, Colombia - (MDE);Panama City, Panama - (PTY);Porto Alegre, Brazil - (POA);Quito, Ecuador - (UIO);Rio de Janeiro, Brazil - (GIG);São Paulo, Brazil - (GRU);Santiago, Chile - (SCL);Willemstad, Curaçao - (CUR);St. George's, Grenada - (GND);Amman, Jordan - (AMM);Baghdad, Iraq - (BGW);Baku, Azerbaijan - (GYD);Beirut, Lebanon - (BEY);Doha, Qatar - (DOH);Dubai, United Arab Emirates - (DXB);Kuwait City, Kuwait - (KWI);Manama, Bahrain - (BAH);Muscat, Oman - (MCT);Ramallah - (ZDM);Riyadh, Saudi Arabia - (RUH);Tel Aviv, Israel - (TLV);Ashburn, VA, United States - (IAD);Atlanta, GA, United States - (ATL);Boston, MA, United States - (BOS);Buffalo, NY, United States - (BUF);Calgary, AB, Canada - (YYC);Charlotte, NC, United States - (CLT);Chicago, IL, United States - (ORD);Columbus, OH, United States - (CMH);Dallas, TX, United States - (DFW);Denver, CO, United States - (DEN);Detroit, MI, United States - (DTW);Honolulu, HI, United States - (HNL);Houston, TX, United States - (IAH);Indianapolis, IN, United States - (IND);Jacksonville, FL, United States - (JAX);Kansas City, MO, United States - (MCI);Las Vegas, NV, United States - (LAS);Los Angeles, CA, United States - (LAX);McAllen, TX, United States - (MFE);Memphis, TN, United States - (MEM);Mexico City, Mexico - (MEX);Miami, FL, United States - (MIA);Minneapolis, MN, United States - (MSP);Montgomery, AL, United States - (MGM);Montréal, QC, Canada - (YUL);Nashville, TN, United States - (BNA);Newark, NJ, United States - (EWR);Norfolk, VA, United States - (ORF);Omaha, NE, United States - (OMA);Philadelphia, United States - (PHL);Phoenix, AZ, United States - (PHX);Pittsburgh, PA, United States - (PIT);Port-Au-Prince, Haiti - (PAP);Portland, OR, United States - (PDX);Queretaro, MX, Mexico - (QRO);Richmond, Virginia - (RIC);Sacramento, CA, United States - (SMF);Salt Lake City, UT, United States - (SLC);San Diego, CA, United States - (SAN);San Jose, CA, United States - (SJC);Saskatoon, SK, Canada - (YXE);Seattle, WA, United States - (SEA);St. Louis, MO, United States - (STL);Tampa, FL, United States - (TPA);Toronto, ON, Canada - (YYZ);Vancouver, BC, Canada - (YVR);Tallahassee, FL, United States - (TLH);Winnipeg, MB, Canada - (YWG);Adelaide, SA, Australia - (ADL);Auckland, New Zealand - (AKL);Brisbane, QLD, Australia - (BNE);Melbourne, VIC, Australia - (MEL);Noumea, New caledonia - (NOU);Perth, WA, Australia - (PER);Sydney, NSW, Australia - (SYD)".split(";"),e=a.split("colo=")[1].split("\n")[0],t=(a.split("colo=")[1].split("\n")[0],a.split("tls=")[1].split("\n")[0]),o=a.split("http=")[1].split("\n")[0],s=a.split("sni=")[1].split("\n")[0],r=a.split("ip=")[1].split("\n")[0],l=a.split("uag=")[1].split("\n")[0];for(var d=0;d<i.length;d++)if(-1!=i[d].indexOf(e)){document.getElementById("cdn").innerHTML=i[d];break}document.getElementById("tls").innerHTML=t,document.getElementById("http").innerHTML=o,document.getElementById("sni").innerHTML=s,document.getElementById("ip").innerHTML=r,document.getElementById("useragent").innerHTML=l}})},$(document).ready((function(){getCDNinfo()}))</script></p><p style="text-align:center">感谢陪伴与布道，开源之火不灭。​</p><p style="text-align:center"><script>document.write("本次加载耗时: "+(performance.getEntriesByType("navigation").reduce((e,r)=>e+r.responseEnd-r.startTime,0)+performance.getEntriesByType("resource").reduce((e,r)=>e+r.responseEnd-r.startTime,0)).toFixed(0)+"ms")</script></p><p style="text-align:center">当前 SNI 状态： <span id="sni">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前 TLS 版本： <span id="tls">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前 HTTP 版本： <span id="http">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前您的客户端 IP 是： <span id="ip">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前分配的 CDN 节点是: <span id="cdn">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">您的 UserAgent 信息是: <span id="useragent">正在统计！或可能被浏览器防追踪拦截！</span></p><p></p></div></div></body></html>