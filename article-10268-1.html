<!doctype html><html lang="en"><head><meta name="msvalidate.01" content="D404690CEFCB54C7762AC84935B99171"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6618da70c90c8744eead2e9371fb5077";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript">!function(t,e,n,c,s,a,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(a=e.createElement(c)).async=1,a.src="https://www.clarity.ms/tag/s5f3f0tojf",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(a,r)}(window,document,"clarity","script")</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="stylesheet" href="/styles/base.css"><link rel="stylesheet" href="/styles/theme.css"><link rel="shortcut icon" href="/favicon.png"><title>在 Grails 中使用 jQuery 和 DataTables - 归墟星火集</title><meta name="generator" content="Hexo 7.3.0"></head><body><div class="header-title"><span class="header-light"></span> <span class="header-light"></span> <span class="header-light"></span> <span>归墟星火集 linuxcn.undefined.today<span></span></span></div><div class="container"><ul class="nav"><li><a href="/">首页</a></li><li><a href="/about/">关于</a></li><li><a target="_blank" rel="noopener" href="https://undefined.today/">Blog</a></li></ul><div class="content"><div class="post-container"><div class="post-header"><span class="ui-tips">标题：</span><h1 class="ui-keyword post-title">在 Grails 中使用 jQuery 和 DataTables</h1><span class="post-date">2018-11-24</span></div><div class="post-header"><span class="ui-tips">分类：</span> <a href="/categories/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/">软件开发</a></div><div class="post-header"><span class="ui-tips">标签：</span> <a href="/tags/Grails/">Grails</a> <a href="/tags/Groovy/">Groovy</a></div><div class="post-content"><blockquote><p>本文介绍如何构建一个基于 Grails 的数据浏览器来可视化复杂的表格数据。</p></blockquote><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201811/24/102451gfdc52bnvg7fr7nv.png"></p><p>我是 <a target="_blank" rel="noopener" href="https://grails.org/">Grails</a> 的忠实粉丝。当然，我主要是热衷于利用命令行工具来探索和分析数据的数据从业人员。数据从业人员经常需要<em>查看</em>数据，这也意味着他们通常拥有优秀的数据浏览器。利用 Grails、<a target="_blank" rel="noopener" href="https://jquery.com/">jQuery</a>，以及 <a target="_blank" rel="noopener" href="https://datatables.net/">DataTables jQuery 插件</a>，我们可以制作出非常友好的表格数据浏览器。</p><p><a target="_blank" rel="noopener" href="https://datatables.net/">DataTables 网站</a>提供了许多“食谱式”的教程文档，展示了如何组合一些优秀的示例应用程序，这些程序包含了完成一些非常漂亮的东西所必要的 JavaScript、HTML，以及偶尔出现的 <a target="_blank" rel="noopener" href="http://php.net/">PHP</a>。但对于那些宁愿使用 Grails 作为后端的人来说，有必要进行一些说明示教。此外，样本程序中使用的数据是一个虚构公司的员工的单个平面表格数据，因此处理这些复杂的表关系可以作为读者的一个练习项目。</p><p>本文中，我们将创建具有略微复杂的数据结构和 DataTables 浏览器的 Grails 应用程序。我们将介绍 Grails 标准，它是 <a target="_blank" rel="noopener" href="http://groovy-lang.org/">Groovy</a> 式的 Java Hibernate 标准。我已将代码托管在 <a target="_blank" rel="noopener" href="https://github.com/monetschemist/grails-datatables">GitHub</a> 上方便大家访问，因此本文主要是对代码细节的解读。</p><p>首先，你需要配置 Java、Groovy、Grails 的使用环境。对于 Grails，我倾向于使用终端窗口和 <a target="_blank" rel="noopener" href="https://www.vim.org/">Vim</a>，本文也使用它们。为获得现代的 Java 环境，建议下载并安装 Linux 发行版提供的 <a target="_blank" rel="noopener" href="http://openjdk.java.net/">Open Java Development Kit</a> （OpenJDK）（应该是 Java 8、9、10 或 11 之一，撰写本文时，我正在使用 Java 8）。从我的角度来看，获取最新的 Groovy 和 Grails 的最佳方法是使用 <a target="_blank" rel="noopener" href="http://sdkman.io/">SDKMAN!</a>。</p><p>从未尝试过 Grails 的读者可能需要做一些背景资料阅读。作为初学者，推荐文章 <a target="_blank" rel="noopener" href="http://guides.grails.org/creating-your-first-grails-app/guide/index.html">创建你的第一个 Grails 应用程序</a>。</p><h3 id="获取员工信息浏览器应用程序"><a href="#获取员工信息浏览器应用程序" class="headerlink" title="获取员工信息浏览器应用程序"></a>获取员工信息浏览器应用程序</h3><p>正如上文所提，我将本文中员工信息浏览器的源代码托管在 <a target="_blank" rel="noopener" href="https://github.com/monetschemist/grails-datatables">GitHub</a>上。进一步讲，应用程序 <strong>embrow</strong> 是在 Linux 终端中用如下命令构建的：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd Projects</span><br><span class="line">grails create-app com.nuevaconsulting.embrow</span><br></pre></td></tr></table></figure><p>域类和单元测试创建如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grails create-domain-class com.nuevaconsulting.embrow.Position</span><br><span class="line">grails create-domain-class com.nuevaconsulting.embrow.Office</span><br><span class="line">grails create-domain-class com.nuevaconsulting.embrow.Employeecd embrowgrails createdomaincom.grails createdomaincom.grails createdomaincom.</span><br></pre></td></tr></table></figure><p>这种方式构建的域类没有属性，因此必须按如下方式编辑它们：</p><p><code>Position</code> 域类：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package com.nuevaconsulting.embrow</span><br><span class="line"> </span><br><span class="line">class Position &#123;</span><br><span class="line"></span><br><span class="line">    String name</span><br><span class="line">    int starting</span><br><span class="line"></span><br><span class="line">    static constraints = &#123;</span><br><span class="line">        name nullable: false, blank: false</span><br><span class="line">        starting nullable: false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;com.Stringint startingstatic constraintsnullableblankstarting nullable</span><br></pre></td></tr></table></figure><p><code>Office</code> 域类：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package com.nuevaconsulting.embrow</span><br><span class="line"> </span><br><span class="line">class Office &#123;</span><br><span class="line"></span><br><span class="line">    String name</span><br><span class="line">    String address</span><br><span class="line">    String city</span><br><span class="line">    String country</span><br><span class="line"></span><br><span class="line">    static constraints = &#123;</span><br><span class="line">        name nullable: false, blank: false</span><br><span class="line">        address nullable: false, blank: false</span><br><span class="line">        city nullable: false, blank: false</span><br><span class="line">        country nullable: false, blank: false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Enployee</code> 域类：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.nuevaconsulting.embrow</span><br><span class="line"> </span><br><span class="line">class Employee &#123;</span><br><span class="line"></span><br><span class="line">    String surname</span><br><span class="line">    String givenNames</span><br><span class="line">    Position position</span><br><span class="line">    Office office</span><br><span class="line">    int extension</span><br><span class="line">    Date hired</span><br><span class="line">    int salary</span><br><span class="line">    static constraints = &#123;</span><br><span class="line">        surname nullable: false, blank: false</span><br><span class="line">        givenNames nullable: false, blank: false</span><br><span class="line">        : false</span><br><span class="line">        office nullable: false</span><br><span class="line">        extension nullable: false</span><br><span class="line">        hired nullable: false</span><br><span class="line">        salary nullable: false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>请注意，虽然 <code>Position</code> 和 <code>Office</code> 域类使用了预定义的 Groovy 类型 <code>String</code> 以及 <code>int</code>，但 <code>Employee</code> 域类定义了 <code>Position</code> 和 <code>Office</code> 字段（以及预定义的 <code>Date</code>）。这会导致创建数据库表，其中存储的 <code>Employee</code> 实例中包含了指向存储 <code>Position</code> 和 <code>Office</code> 实例表的引用或者外键。</p><p>现在你可以生成控制器，视图，以及其他各种测试组件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-all com.nuevaconsulting.embrow.Position</span><br><span class="line">grails generate-all com.nuevaconsulting.embrow.Office</span><br><span class="line">grails generate-all com.nuevaconsulting.embrow.Employeegrails generateall com.grails generateall com.grails generateall com.</span><br></pre></td></tr></table></figure><p>此时，你已经准备好了一个基本的增删改查（CRUD）应用程序。我在 <code>grails-app/init/com/nuevaconsulting/BootStrap.groovy</code> 中包含了一些基础数据来填充表格。</p><p>如果你用如下命令来启动应用程序：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grails run-app</span><br></pre></td></tr></table></figure><p>在浏览器输入 <code>http://localhost:8080/</code>，你将会看到如下界面：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201811/24/102453x1n1tygy5g35r15z.png" alt="Embrow home screen"></p><p><em>Embrow 应用程序主界面。</em></p><p>单击 “OfficeController” 链接，会跳转到如下界面：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201811/24/102455e23cwdo3yydhl3y3.png" alt="Office list"></p><p><em>Office 列表</em></p><p>注意，此表由 <code>OfficeController</code> 的 <code>index</code> 方式生成，并由视图 <code>office/index.gsp</code> 显示。</p><p>同样，单击 “EmployeeController” 链接 跳转到如下界面：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201811/24/102457xfhihxh3h2mjf2j6.png" alt="Employee controller"></p><p><em>employee 控制器</em></p><p>好吧，这很丑陋： Position 和 Office 链接是什么？</p><p>上面的命令 <code>generate-all</code> 生成的视图创建了一个叫 <code>index.gsp</code> 的文件，它使用 Grails <code>&lt;f:table/&gt;</code> 标签，该标签默认会显示类名（<code>com.nuevaconsulting.embrow.Position</code>）和持久化示例标识符（<code>30</code>）。这个操作可以自定义用来产生更好看的东西，并且自动生成链接，自动生成分页以及自动生成可排序列的一些非常简洁直观的东西。</p><p>但该员工信息浏览器功能也是有限的。例如，如果想查找 “position” 信息中包含 “dev” 的员工该怎么办？如果要组合排序，以姓氏为主排序关键字，“office” 为辅助排序关键字，该怎么办？或者，你需要将已排序的数据导出到电子表格或 PDF 文档以便通过电子邮件发送给无法访问浏览器的人，该怎么办？</p><p>jQuery DataTables 插件提供了这些所需的功能。允许你创建一个完成的表格数据浏览器。</p><h3 id="创建员工信息浏览器视图和控制器的方法"><a href="#创建员工信息浏览器视图和控制器的方法" class="headerlink" title="创建员工信息浏览器视图和控制器的方法"></a>创建员工信息浏览器视图和控制器的方法</h3><p>要基于 jQuery DataTables 创建员工信息浏览器，你必须先完成以下两个任务：</p><ol><li>创建 Grails 视图，其中包含启用 DataTable 所需的 HTML 和 JavaScript</li><li>给 Grails 控制器增加一个方法来控制新视图。</li></ol><h4 id="员工信息浏览器视图"><a href="#员工信息浏览器视图" class="headerlink" title="员工信息浏览器视图"></a>员工信息浏览器视图</h4><p>在目录 <code>embrow/grails-app/views/employee</code> 中，首先复制 <code>index.gsp</code> 文件，重命名为 <code>browser.gsp</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd Projects</span><br><span class="line">cd embrow/grails-app/views/employee</span><br><span class="line">cp gsp browser.gsp</span><br></pre></td></tr></table></figure><p>此刻，你自定义新的 <code>browser.gsp</code> 文件来添加相关的 jQuery DataTables 代码。</p><p>通常，在可能的时候，我喜欢从内容提供商处获得 JavaScript 和 CSS；在下面这行后面：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;title&gt;&lt;g:message code=&quot;default.list.label&quot; args=&quot;[entityName]&quot; /&gt;&lt;/title&gt;</span><br></pre></td></tr></table></figure><p>插入如下代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;https://code.jquery.com/jquery-2.2.4.min.js&quot; integrity=&quot;sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;https://cdn.datatables.net/1.10.16/css/jquery.dataTables.css&quot;&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; charset=&quot;utf8&quot; src=&quot;https://cdn.datatables.net/1.10.16/js/jquery.dataTables.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;https://cdn.datatables.net/scroller/1.4.4/css/scroller.dataTables.min.css&quot;&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; charset=&quot;utf8&quot; src=&quot;https://cdn.datatables.net/scroller/1.4.4/js/dataTables.scroller.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; charset=&quot;utf8&quot; src=&quot;https://cdn.datatables.net/buttons/1.5.1/js/dataTables.buttons.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; charset=&quot;utf8&quot; src=&quot;https://cdn.datatables.net/buttons/1.5.1/js/buttons.flash.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; charset=&quot;utf8&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; charset=&quot;utf8&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; charset=&quot;utf8&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; charset=&quot;utf8&quot; src=&quot;https://cdn.datatables.net/buttons/1.5.1/js/buttons.html5.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; charset=&quot;utf8&quot; src=&quot;https://cdn.datatables.net/buttons/1.5.1/js/buttons.print.min.js &quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>然后删除 <code>index.gsp</code> 中提供数据分页的代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;list-employee&quot; class=&quot;content scaffold-list&quot; role=&quot;main&quot;&gt;</span><br><span class="line">&lt;h1&gt;&lt;g:message code=&quot;default.list.label&quot; args=&quot;[entityName]&quot; /&gt;&lt;/h1&gt;</span><br><span class="line">&lt;g:if test=&quot;$&#123;flash.message&#125;&quot;&gt;</span><br><span class="line">&lt;div class=&quot;message&quot; role=&quot;status&quot;&gt;$&#123;flash.message&#125;&lt;/div&gt;</span><br><span class="line">&lt;/g:if&gt;</span><br><span class="line">&lt;f:table collection=&quot;$&#123;employeeList&#125;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;pagination&quot;&gt;</span><br><span class="line">&lt;g:paginate total=&quot;$&#123;employeeCount ?: 0&#125;&quot; /&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>并插入实现 jQuery DataTables 的代码。</p><p>要插入的第一部分是 HTML，它将创建浏览器的基本表格结构。DataTables 与后端通信的应用程序来说，它们只提供表格页眉和页脚；DataTables JavaScript 则负责表中内容。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;employee-browser&quot; class=&quot;content&quot; role=&quot;main&quot;&gt;</span><br><span class="line">&lt;h1&gt;Employee Browser&lt;/h1&gt;</span><br><span class="line">&lt;table id=&quot;employee_dt&quot; class=&quot;display compact&quot; style=&quot;width:99%;&quot;&gt;</span><br><span class="line">&lt;thead&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;th&gt;Surname&lt;/th&gt;</span><br><span class="line">&lt;th&gt;Given name(s)&lt;/th&gt;</span><br><span class="line">&lt;th&gt;Position&lt;/th&gt;</span><br><span class="line">&lt;th&gt;Office&lt;/th&gt;</span><br><span class="line">&lt;th&gt;Extension&lt;/th&gt;</span><br><span class="line">&lt;th&gt;Hired&lt;/th&gt;</span><br><span class="line">&lt;th&gt;Salary&lt;/th&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;/thead&gt;</span><br><span class="line">&lt;tfoot&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;th&gt;Surname&lt;/th&gt;</span><br><span class="line">&lt;th&gt;Given name(s)&lt;/th&gt;</span><br><span class="line">&lt;th&gt;Position&lt;/th&gt;</span><br><span class="line">&lt;th&gt;Office&lt;/th&gt;</span><br><span class="line">&lt;th&gt;Extension&lt;/th&gt;</span><br><span class="line">&lt;th&gt;Hired&lt;/th&gt;</span><br><span class="line">&lt;th&gt;Salary&lt;/th&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;/tfoot&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>接下来，插入一个 JavaScript 块，它主要提供三个功能：它设置页脚中显示的文本框的大小，以进行列过滤，建立 DataTables 表模型，并创建一个处理程序来进行列过滤。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;g:javascript&gt;</span><br><span class="line">$(&#x27;#employee_dt tfoot th&#x27;).each( function() &#123;javascript</span><br></pre></td></tr></table></figure><p>下面的代码处理表格列底部的过滤器框的大小：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var title = $(this).text();</span><br><span class="line">if (title == &#x27;Extension&#x27; || title == &#x27;Hired&#x27;)</span><br><span class="line">$(this).html(&#x27;&lt;input type=&quot;text&quot; size=&quot;5&quot; placeholder=&quot;&#x27; + title + &#x27;?&quot; /&gt;&#x27;);</span><br><span class="line">else</span><br><span class="line">$(this).html(&#x27;&lt;input type=&quot;text&quot; size=&quot;15&quot; placeholder=&quot;&#x27; + title + &#x27;?&quot; /&gt;&#x27;);</span><br><span class="line">&#125;);titletitletitletitletitle</span><br></pre></td></tr></table></figure><p>接下来，定义表模型。这是提供所有表选项的地方，包括界面的滚动，而不是分页，根据 DOM 字符串提供的装饰，将数据导出为 CSV 和其他格式的能力，以及建立与服务器的 AJAX 连接。 请注意，使用 Groovy GString 调用 Grails <code>createLink()</code> 的方法创建 URL，在 <code>EmployeeController</code> 中指向 <code>browserLister</code> 操作。同样有趣的是表格列的定义。此信息将发送到后端，后端查询数据库并返回相应的记录。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">var table = $(&#x27;#employee_dt&#x27;).DataTable( &#123;</span><br><span class="line">&quot;scrollY&quot;: 500,</span><br><span class="line">&quot;deferRender&quot;: true,</span><br><span class="line">&quot;scroller&quot;: true,</span><br><span class="line">&quot;dom&quot;: &quot;Brtip&quot;,</span><br><span class="line">&quot;buttons&quot;: [ &#x27;copy&#x27;, &#x27;csv&#x27;, &#x27;excel&#x27;, &#x27;pdf&#x27;, &#x27;print&#x27; ],</span><br><span class="line">&quot;processing&quot;: true,</span><br><span class="line">&quot;serverSide&quot;: true,</span><br><span class="line">&quot;ajax&quot;: &#123;</span><br><span class="line">&quot;url&quot;: &quot;$&#123;createLink(controller: &#x27;employee&#x27;, action: &#x27;browserLister&#x27;)&#125;&quot;,</span><br><span class="line">&quot;type&quot;: &quot;POST&quot;,</span><br><span class="line">&#125;,</span><br><span class="line">&quot;columns&quot;: [</span><br><span class="line">&#123; &quot;data&quot;: &quot;surname&quot; &#125;,</span><br><span class="line">&#123; &quot;data&quot;: &quot;givenNames&quot; &#125;,</span><br><span class="line">&#123; &quot;data&quot;: &quot;position&quot; &#125;,</span><br><span class="line">&#123; &quot;data&quot;: &quot;office&quot; &#125;,</span><br><span class="line">&#123; &quot;data&quot;: &quot;extension&quot; &#125;,</span><br><span class="line">&#123; &quot;data&quot;: &quot;hired&quot; &#125;,</span><br><span class="line">&#123; &quot;data&quot;: &quot;salary&quot; &#125;</span><br><span class="line">]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>最后，监视过滤器列以进行更改，并使用它们来应用过滤器。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">table.columns().every(function() &#123;</span><br><span class="line">var that = this;</span><br><span class="line">$(&#x27;input&#x27;, this.footer()).on(&#x27;keyup change&#x27;, function(e) &#123;</span><br><span class="line">if (that.search() != this.value &amp;&amp; 8 &lt; e.keyCode &amp;&amp; e.keyCode &lt; 32)</span><br><span class="line">that.search(this.value).draw();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这就是 JavaScript，这样就完成了对视图代码的更改。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#125;);</span><br><span class="line">&lt;/g:javascript&gt;</span><br></pre></td></tr></table></figure><p>以下是此视图创建的UI的屏幕截图：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201811/24/102458wiezvqvvwdguwfqv.png"></p><p>这是另一个屏幕截图，显示了过滤和多列排序（寻找 “position” 包括字符 “dev” 的员工，先按 “office” 排序，然后按姓氏排序）：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201811/24/102500fee5wc2z3x6w3xxp.png"></p><p>这是另一个屏幕截图，显示单击 CSV 按钮时会发生什么：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201811/24/102504u2bkkzg2g3gz9b38.png"></p><p>最后，这是一个截图，显示在 LibreOffice 中打开的 CSV 数据：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201811/24/102508udp96d9ewdb0emt2.png"></p><p>好的，视图部分看起来非常简单；因此，控制器必须做所有繁重的工作，对吧？ 让我们来看看……</p><h4 id="控制器-browserLister-操作"><a href="#控制器-browserLister-操作" class="headerlink" title="控制器 browserLister 操作"></a>控制器 browserLister 操作</h4><p>回想一下，我们看到过这个字符串：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;$&#123;createLink(controller: &#x27;employee&#x27;, action: &#x27;browserLister&#x27;)&#125;&quot;</span><br></pre></td></tr></table></figure><p>对于从 DataTables 模型中调用 AJAX 的 URL，是在 Grails 服务器上动态创建 HTML 链接，其 Grails 标记背后通过调用 <a target="_blank" rel="noopener" href="https://gsp.grails.org/latest/ref/Tags/createLink.html">createLink()</a> 的方法实现的。这会最终产生一个指向 <code>EmployeeController</code> 的链接，位于：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">embrow/grails-app/controllers/com/nuevaconsulting/embrow/EmployeeController.groovy</span><br></pre></td></tr></table></figure><p>特别是控制器方法 <code>browserLister()</code>。我在代码中留了一些 <code>print</code> 语句，以便在运行时能够在终端看到中间结果。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def browserLister() &#123;</span><br><span class="line">    // Applies filters and sorting to return a list of desired employees</span><br></pre></td></tr></table></figure><p>首先，打印出传递给 <code>browserLister()</code> 的参数。我通常使用此代码开始构建控制器方法，以便我完全清楚我的控制器正在接收什么。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">println &quot;employee browserLister params $params&quot;</span><br><span class="line">  println()</span><br></pre></td></tr></table></figure><p>接下来，处理这些参数以使它们更加有用。首先，jQuery DataTables 参数，一个名为 <code>jqdtParams</code> 的 Groovy 映射：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def jqdtParams = [:]</span><br><span class="line">params.each &#123; key, value -&gt;</span><br><span class="line">    def keyFields = key.replace(&#x27;]&#x27;,&#x27;&#x27;).split(/\[/)</span><br><span class="line">    def table = jqdtParams</span><br><span class="line">    for (int f = 0; f &lt; keyFields.size() - 1; f++) &#123;</span><br><span class="line">        def keyField = keyFields[f]</span><br><span class="line">        if (!table.containsKey(keyField))</span><br><span class="line">            table[keyField] = [:]</span><br><span class="line">        table = table[keyField]</span><br><span class="line">    &#125;</span><br><span class="line">    table[keyFields[-1]] = value</span><br><span class="line">&#125;</span><br><span class="line">println &quot;employee dataTableParams $jqdtParams&quot;</span><br><span class="line">println()</span><br></pre></td></tr></table></figure><p>接下来，列数据，一个名为 <code>columnMap</code> 的 Groovy 映射：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">def columnMap = jqdtParams.columns.collectEntries &#123; k, v -&gt;</span><br><span class="line">    def whereTerm = null</span><br><span class="line">    switch (v.data) &#123;</span><br><span class="line">    case &#x27;extension&#x27;:</span><br><span class="line">    case &#x27;hired&#x27;:</span><br><span class="line">    case &#x27;salary&#x27;:</span><br><span class="line">        if (v.search.value ==~ /\d+(,\d+)*/)</span><br><span class="line">            whereTerm = v.search.value.split(&#x27;,&#x27;).collect &#123; it as Integer &#125;</span><br><span class="line">        break</span><br><span class="line">    default:</span><br><span class="line">        if (v.search.value ==~ /[A-Za-z0-9 ]+/)</span><br><span class="line">            whereTerm = &quot;%$&#123;v.search.value&#125;%&quot; as String</span><br><span class="line">        break</span><br><span class="line">    &#125;</span><br><span class="line">    [(v.data): [where: whereTerm]]</span><br><span class="line">&#125;</span><br><span class="line">println &quot;employee columnMap $columnMap&quot;</span><br><span class="line">println()</span><br></pre></td></tr></table></figure><p>接下来，从 <code>columnMap</code> 中检索的所有列表，以及在视图中应如何排序这些列表，Groovy 列表分别称为 <code>allColumnList</code> 和 <code>orderList</code> ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def allColumnList = columnMap.keySet() as List</span><br><span class="line">println &quot;employee allColumnList $allColumnList&quot;</span><br><span class="line">def orderList = jqdtParams.order.collect &#123; k, v -&gt; [allColumnList[v.column as Integer], v.dir] &#125;</span><br><span class="line">println &quot;employee orderList $orderList&quot;</span><br></pre></td></tr></table></figure><p>我们将使用 Grails 的 Hibernate 标准实现来实际选择要显示的元素以及它们的排序和分页。标准要求过滤器关闭；在大多数示例中，这是作为标准实例本身的创建的一部分给出的，但是在这里我们预先定义过滤器闭包。请注意，在这种情况下，“date hired” 过滤器的相对复杂的解释被视为一年并应用于建立日期范围，并使用 <code>createAlias</code> 以允许我们进入相关类别 <code>Position</code> 和 <code>Office</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">def filterer = &#123;</span><br><span class="line">    createAlias &#x27;position&#x27;,        &#x27;p&#x27;</span><br><span class="line">    createAlias &#x27;office&#x27;,          &#x27;o&#x27;</span><br><span class="line"></span><br><span class="line">    if (columnMap.surname.where)    ilike  &#x27;surname&#x27;,     columnMap.surname.where</span><br><span class="line">    if (columnMap.givenNames.where) ilike  &#x27;givenNames&#x27;,  columnMap.givenNames.where</span><br><span class="line">    if (columnMap.position.where)   ilike  &#x27;p.name&#x27;,      columnMap.position.where</span><br><span class="line">    if (columnMap.office.where)     ilike  &#x27;o.name&#x27;,      columnMap.office.where</span><br><span class="line">    if (columnMap.extension.where)  inList &#x27;extension&#x27;,   columnMap.extension.where</span><br><span class="line">    if (columnMap.salary.where)     inList &#x27;salary&#x27;,      columnMap.salary.where</span><br><span class="line">    if (columnMap.hired.where) &#123;</span><br><span class="line">        if (columnMap.hired.where.size() &gt; 1) &#123;</span><br><span class="line">            or &#123;</span><br><span class="line">                columnMap.hired.where.each &#123;</span><br><span class="line">                    between &#x27;hired&#x27;, Date.parse(&#x27;yyyy/MM/dd&#x27;,&quot;$&#123;it&#125;/01/01&quot; as String),</span><br><span class="line">                        Date.parse(&#x27;yyyy/MM/dd&#x27;,&quot;$&#123;it&#125;/12/31&quot; as String)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            between &#x27;hired&#x27;, Date.parse(&#x27;yyyy/MM/dd&#x27;,&quot;$&#123;columnMap.hired.where[0]&#125;/01/01&quot; as String),</span><br><span class="line">                Date.parse(&#x27;yyyy/MM/dd&#x27;,&quot;$&#123;columnMap.hired.where[0]&#125;/12/31&quot; as String)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>是时候应用上述内容了。第一步是获取分页代码所需的所有 <code>Employee</code> 实例的总数：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def recordsTotal = Employee.count()</span><br><span class="line">println &quot;employee recordsTotal $recordsTotal&quot;</span><br></pre></td></tr></table></figure><p>接下来，将过滤器应用于 <code>Employee</code> 实例以获取过滤结果的计数，该结果将始终小于或等于总数（同样，这是针对分页代码）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def c = Employee.createCriteria()</span><br><span class="line">def recordsFiltered = c.count &#123;</span><br><span class="line">    filterer.delegate = delegate</span><br><span class="line">    filterer()</span><br><span class="line">&#125;</span><br><span class="line">println &quot;employee recordsFiltered $recordsFiltered&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>获得这两个计数后，你还可以使用分页和排序信息获取实际过滤的实例。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def orderer = Employee.withCriteria &#123;</span><br><span class="line">      filterer.delegate = delegate</span><br><span class="line">      filterer()</span><br><span class="line">      orderList.each &#123; oi -&gt;</span><br><span class="line">          switch (oi[0]) &#123;</span><br><span class="line">          case &#x27;surname&#x27;:    order &#x27;surname&#x27;,    oi[1]; break</span><br><span class="line">          case &#x27;givenNames&#x27;: order &#x27;givenNames&#x27;, oi[1]; break</span><br><span class="line">          case &#x27;position&#x27;:   order &#x27;p.name&#x27;,     oi[1]; break</span><br><span class="line">          case &#x27;office&#x27;:     order &#x27;o.name&#x27;,     oi[1]; break</span><br><span class="line">          case &#x27;extension&#x27;:  order &#x27;extension&#x27;,  oi[1]; break</span><br><span class="line">          case &#x27;hired&#x27;:      order &#x27;hired&#x27;,      oi[1]; break</span><br><span class="line">          case &#x27;salary&#x27;:     order &#x27;salary&#x27;,     oi[1]; break</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      maxResults (jqdtParams.length as Integer)</span><br><span class="line">      firstResult (jqdtParams.start as Integer)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>要完全清楚，JTable 中的分页代码管理三个计数：数据集中的记录总数，应用过滤器后得到的数字，以及要在页面上显示的数字（显示是滚动还是分页）。 排序应用于所有过滤的记录，并且分页应用于那些过滤的记录的块以用于显示目的。</p><p>接下来，处理命令返回的结果，在每行中创建指向 <code>Employee</code>、<code>Position</code> 和 <code>Office</code> 实例的链接，以便用户可以单击这些链接以获取相关实例的所有详细信息：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def dollarFormatter = new DecimalFormat(&#x27;$##,###.##&#x27;)</span><br><span class="line">def employees = orderer.collect &#123; employee -&gt;</span><br><span class="line">    [&#x27;surname&#x27;: &quot;&lt;a href=&#x27;$&#123;createLink(controller: &#x27;employee&#x27;, action: &#x27;show&#x27;, id: employee.id)&#125;&#x27;&gt;$&#123;employee.surname&#125;&lt;/a&gt;&quot;,</span><br><span class="line">        &#x27;givenNames&#x27;: employee.givenNames,</span><br><span class="line">        &#x27;position&#x27;: &quot;&lt;a href=&#x27;$&#123;createLink(controller: &#x27;position&#x27;, action: &#x27;show&#x27;, id: employee.position?.id)&#125;&#x27;&gt;$&#123;employee.position?.name&#125;&lt;/a&gt;&quot;,</span><br><span class="line">        &#x27;office&#x27;: &quot;&lt;a href=&#x27;$&#123;createLink(controller: &#x27;office&#x27;, action: &#x27;show&#x27;, id: employee.office?.id)&#125;&#x27;&gt;$&#123;employee.office?.name&#125;&lt;/a&gt;&quot;,</span><br><span class="line">        &#x27;extension&#x27;: employee.extension,</span><br><span class="line">        &#x27;hired&#x27;: employee.hired.format(&#x27;yyyy/MM/dd&#x27;),</span><br><span class="line">        &#x27;salary&#x27;: dollarFormatter.format(employee.salary)]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后，创建要返回的结果并将其作为 JSON 返回，这是 jQuery DataTables 所需要的。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    def result = [draw: jqdtParams.draw, recordsTotal: recordsTotal, recordsFiltered: recordsFiltered, data: employees]</span><br><span class="line">    render(result as JSON)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>大功告成。</p><p>如果你熟悉 Grails，这可能看起来比你原先想象的要多，但这里没有火箭式的一步到位方法，只是很多分散的操作步骤。但是，如果你没有太多接触 Grails（或 Groovy），那么需要了解很多新东西 - 闭包，代理和构建器等等。</p><p>在那种情况下，从哪里开始？ 最好的地方是了解 Groovy 本身，尤其是 <a target="_blank" rel="noopener" href="http://groovy-lang.org/closures.html">Groovy closures</a> 和 <a target="_blank" rel="noopener" href="http://groovy-lang.org/dsls.html">Groovy delegates and builders</a>。然后再去阅读上面关于 Grails 和 Hibernate 条件查询的建议阅读文章。</p><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>jQuery DataTables 为 Grails 制作了很棒的表格数据浏览器。对视图进行编码并不是太棘手，但 DataTables 文档中提供的 PHP 示例提供的功能仅到此位置。特别是，它们不是用 Grails 程序员编写的，也不包含探索使用引用其他类（实质上是查找表）的元素的更精细的细节。</p><p>我使用这种方法制作了几个数据浏览器，允许用户选择要查看和累积记录计数的列，或者只是浏览数据。即使在相对适度的 VPS 上的百万行表中，性能也很好。</p><p>一个警告：我偶然发现了 Grails 中暴露的各种 Hibernate 标准机制的一些问题（请参阅我的其他 GitHub 代码库），因此需要谨慎和实验。如果所有其他方法都失败了，另一种方法是动态构建 SQL 字符串并执行它们。在撰写本文时，我更喜欢使用 Grails 标准，除非我遇到杂乱的子查询，但这可能只反映了我在 Hibernate 中对子查询的相对缺乏经验。</p><p>我希望 Grails 程序员发现本文的有趣性。请随时在下面留下评论或建议。</p><hr><p>via: <a target="_blank" rel="noopener" href="https://opensource.com/article/18/9/using-grails-jquery-and-datatables">https://opensource.com/article/18/9/using-grails-jquery-and-datatables</a></p><p>作者：<a target="_blank" rel="noopener" href="https://opensource.com/users/clhermansen">Chris Hermansen</a> 选题：<a target="_blank" rel="noopener" href="https://github.com/lujun9972">lujun9972</a> 译者：<a target="_blank" rel="noopener" href="https://github.com/jrglinux">jrg</a> 校对：<a target="_blank" rel="noopener" href="https://github.com/wxy">wxy</a></p><p>本文由 <a target="_blank" rel="noopener" href="https://github.com/LCTT/TranslateProject">LCTT</a> 原创编译，<a target="_blank" rel="noopener" href="https://linux.cn/">Linux中国</a> 荣誉推出</p></div></div></div><div class="footer"><p class="footer-copyright"><span>Powered by <a target="_blank" href="https://hexo.io">Hexo</a></span> <span>Theme <a target="_blank" href="https://github.com/tinkink-co/hexo-theme-terminal">Terminal</a></span><script type="text/javascript" src="https://cdn.staticfile.net/jquery/3.4.1/jquery.min.js"></script><script>getCDNinfo=function(){$.ajax({url:"/cdn-cgi/trace",success:function(a,n){let i="Antananarivo, Madagascar - (TNR);Cape Town, South Africa - (CPT);Casablanca, Morocco - (CMN);Dar Es Salaam, Tanzania - (DAR);Djibouti City, Djibouti - (JIB);Durban, South Africa - (DUR);Johannesburg, South Africa - (JNB);Kigali, Rwanda - (KGL);Lagos, Nigeria - (LOS);Luanda, Angola - (LAD);Maputo, MZ - (MPM);Mombasa, Kenya - (MBA);Port Louis, Mauritius - (MRU);Réunion, France - (RUN);Bangalore, India - (BLR);Bangkok, Thailand - (BKK);Bandar Seri Begawan, Brunei - (BWN);Cebu, Philippines - (CEB);Chengdu, China - (CTU);Chennai, India - (MAA);Chittagong, Bangladesh - (CGP);Chongqing, China - (CKG);Colombo, Sri Lanka - (CMB);Dhaka, Bangladesh - (DAC);Dongguan, China - (SZX);Foshan, China - (FUO);Fuzhou, China - (FOC);Guangzhou, China - (CAN);Hangzhou, China - (HGH);Hanoi, Vietnam - (HAN);Hengyang, China - (HNY);Ho Chi Minh City, Vietnam - (SGN);Hong Kong - (HKG);Hyderabad, India - (HYD);Islamabad, Pakistan - (ISB);Jakarta, Indonesia - (CGK);Jinan, China - (TNA);Karachi, Pakistan - (KHI);Kathmandu, Nepal - (KTM);Kolkata, India - (CCU);Kuala Lumpur, Malaysia - (KUL);Lahore, Pakistan - (LHE);Langfang, China - (NAY);Luoyang, China - (LYA);Macau - (MFM);Malé, Maldives - (MLE);Manila, Philippines - (MNL);Mumbai, India - (BOM);Nagpur, India - (NAG);Nanning, China - (NNG);New Delhi, India - (DEL);Osaka, Japan - (KIX);Phnom Penh, Cambodia - (PNH);Qingdao, China - (TAO);Seoul, South Korea - (ICN);Shanghai, China - (SHA);Shenyang, China - (SHE);Shijiazhuang, China - (SJW);Singapore, Singapore - (SIN);Suzhou, China - (SZV);Taipei - (TPE);Thimphu, Bhutan - (PBH);Tianjin, China - (TSN);Tokyo, Japan - (NRT);Ulaanbaatar, Mongolia - (ULN);Vientiane, Laos - (VTE);Wuhan, China - (WUH);Wuxi, China - (WUX);Xi'an, China - (XIY);Yerevan, Armenia - (EVN);Zhengzhou, China - (CGO);Zuzhou, China - (CSX);Amsterdam, Netherlands - (AMS);Athens, Greece - (ATH);Barcelona, Spain - (BCN);Belgrade, Serbia - (BEG);Berlin, Germany - (TXL);Brussels, Belgium - (BRU);Bucharest, Romania - (OTP);Budapest, Hungary - (BUD);Chișinău, Moldova - (KIV);Copenhagen, Denmark - (CPH);Cork, Ireland -  (ORK);Dublin, Ireland - (DUB);Düsseldorf, Germany - (DUS);Edinburgh, United Kingdom - (EDI);Frankfurt, Germany - (FRA);Geneva, Switzerland - (GVA);Gothenburg, Sweden - (GOT);Hamburg, Germany - (HAM);Helsinki, Finland - (HEL);Istanbul, Turkey - (IST);Kyiv, Ukraine - (KBP);Lisbon, Portugal - (LIS);London, United Kingdom - (LHR);Luxembourg City, Luxembourg - (LUX);Madrid, Spain - (MAD);Manchester, United Kingdom - (MAN);Marseille, France - (MRS);Milan, Italy - (MXP);Moscow, Russia - (DME);Munich, Germany - (MUC);Nicosia, Cyprus - (LCA);Oslo, Norway - (OSL);Paris, France - (CDG);Prague, Czech Republic - (PRG);Reykjavík, Iceland - (KEF);Riga, Latvia - (RIX);Rome, Italy - (FCO);Saint Petersburg, Russia - (LED);Sofia, Bulgaria - (SOF);Stockholm, Sweden - (ARN);Tallinn, Estonia - (TLL);Thessaloniki, Greece - (SKG);Vienna, Austria - (VIE);Vilnius, Lithuania - (VNO);Warsaw, Poland - (WAW);Zagreb, Croatia - (ZAG);Zürich, Switzerland - (ZRH);Arica, Chile - (ARI);Asunción, Paraguay - (ASU);Bogotá, Colombia - (BOG);Buenos Aires, Argentina - (EZE);Curitiba, Brazil - (CWB);Fortaleza, Brazil - (FOR);Guatemala City, Guatemala - (GUA);Lima, Peru - (LIM);Medellín, Colombia - (MDE);Panama City, Panama - (PTY);Porto Alegre, Brazil - (POA);Quito, Ecuador - (UIO);Rio de Janeiro, Brazil - (GIG);São Paulo, Brazil - (GRU);Santiago, Chile - (SCL);Willemstad, Curaçao - (CUR);St. George's, Grenada - (GND);Amman, Jordan - (AMM);Baghdad, Iraq - (BGW);Baku, Azerbaijan - (GYD);Beirut, Lebanon - (BEY);Doha, Qatar - (DOH);Dubai, United Arab Emirates - (DXB);Kuwait City, Kuwait - (KWI);Manama, Bahrain - (BAH);Muscat, Oman - (MCT);Ramallah - (ZDM);Riyadh, Saudi Arabia - (RUH);Tel Aviv, Israel - (TLV);Ashburn, VA, United States - (IAD);Atlanta, GA, United States - (ATL);Boston, MA, United States - (BOS);Buffalo, NY, United States - (BUF);Calgary, AB, Canada - (YYC);Charlotte, NC, United States - (CLT);Chicago, IL, United States - (ORD);Columbus, OH, United States - (CMH);Dallas, TX, United States - (DFW);Denver, CO, United States - (DEN);Detroit, MI, United States - (DTW);Honolulu, HI, United States - (HNL);Houston, TX, United States - (IAH);Indianapolis, IN, United States - (IND);Jacksonville, FL, United States - (JAX);Kansas City, MO, United States - (MCI);Las Vegas, NV, United States - (LAS);Los Angeles, CA, United States - (LAX);McAllen, TX, United States - (MFE);Memphis, TN, United States - (MEM);Mexico City, Mexico - (MEX);Miami, FL, United States - (MIA);Minneapolis, MN, United States - (MSP);Montgomery, AL, United States - (MGM);Montréal, QC, Canada - (YUL);Nashville, TN, United States - (BNA);Newark, NJ, United States - (EWR);Norfolk, VA, United States - (ORF);Omaha, NE, United States - (OMA);Philadelphia, United States - (PHL);Phoenix, AZ, United States - (PHX);Pittsburgh, PA, United States - (PIT);Port-Au-Prince, Haiti - (PAP);Portland, OR, United States - (PDX);Queretaro, MX, Mexico - (QRO);Richmond, Virginia - (RIC);Sacramento, CA, United States - (SMF);Salt Lake City, UT, United States - (SLC);San Diego, CA, United States - (SAN);San Jose, CA, United States - (SJC);Saskatoon, SK, Canada - (YXE);Seattle, WA, United States - (SEA);St. Louis, MO, United States - (STL);Tampa, FL, United States - (TPA);Toronto, ON, Canada - (YYZ);Vancouver, BC, Canada - (YVR);Tallahassee, FL, United States - (TLH);Winnipeg, MB, Canada - (YWG);Adelaide, SA, Australia - (ADL);Auckland, New Zealand - (AKL);Brisbane, QLD, Australia - (BNE);Melbourne, VIC, Australia - (MEL);Noumea, New caledonia - (NOU);Perth, WA, Australia - (PER);Sydney, NSW, Australia - (SYD)".split(";"),e=a.split("colo=")[1].split("\n")[0],t=(a.split("colo=")[1].split("\n")[0],a.split("tls=")[1].split("\n")[0]),o=a.split("http=")[1].split("\n")[0],s=a.split("sni=")[1].split("\n")[0],r=a.split("ip=")[1].split("\n")[0],l=a.split("uag=")[1].split("\n")[0];for(var d=0;d<i.length;d++)if(-1!=i[d].indexOf(e)){document.getElementById("cdn").innerHTML=i[d];break}document.getElementById("tls").innerHTML=t,document.getElementById("http").innerHTML=o,document.getElementById("sni").innerHTML=s,document.getElementById("ip").innerHTML=r,document.getElementById("useragent").innerHTML=l}})},$(document).ready((function(){getCDNinfo()}))</script></p><p style="text-align:center">感谢陪伴与布道，开源之火不灭。​</p><p style="text-align:center"><script>document.write("本次加载耗时: "+(performance.getEntriesByType("navigation").reduce((e,r)=>e+r.responseEnd-r.startTime,0)+performance.getEntriesByType("resource").reduce((e,r)=>e+r.responseEnd-r.startTime,0)).toFixed(0)+"ms")</script></p><p style="text-align:center">当前 SNI 状态： <span id="sni">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前 TLS 版本： <span id="tls">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前 HTTP 版本： <span id="http">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前您的客户端 IP 是： <span id="ip">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前分配的 CDN 节点是: <span id="cdn">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">您的 UserAgent 信息是: <span id="useragent">正在统计！或可能被浏览器防追踪拦截！</span></p><p></p></div></div></body></html>