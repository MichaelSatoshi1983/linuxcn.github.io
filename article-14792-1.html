<!doctype html><html lang="en"><head><meta name="msvalidate.01" content="D404690CEFCB54C7762AC84935B99171"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6618da70c90c8744eead2e9371fb5077";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript">!function(t,e,n,c,s,a,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(a=e.createElement(c)).async=1,a.src="https://www.clarity.ms/tag/s5f3f0tojf",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(a,r)}(window,document,"clarity","script")</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="stylesheet" href="/styles/base.css"><link rel="stylesheet" href="/styles/theme.css"><link rel="shortcut icon" href="/favicon.png"><title>Djinn：一个受 Jinja2 启发的代码生成器和模板语言 - 归墟星火集</title><meta name="generator" content="Hexo 7.3.0"></head><body><div class="header-title"><span class="header-light"></span> <span class="header-light"></span> <span class="header-light"></span> <span>归墟星火集 linuxcn.undefined.today<span></span></span></div><div class="container"><ul class="nav"><li><a href="/">首页</a></li><li><a href="/about/">关于</a></li><li><a target="_blank" rel="noopener" href="https://undefined.today/">Blog</a></li></ul><div class="content"><div class="post-container"><div class="post-header"><span class="ui-tips">标题：</span><h1 class="ui-keyword post-title">Djinn：一个受 Jinja2 启发的代码生成器和模板语言</h1><span class="post-date">2022-07-04</span></div><div class="post-header"><span class="ui-tips">分类：</span> <a href="/categories/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/">软件开发</a></div><div class="post-header"><span class="ui-tips">标签：</span> <a href="/tags/%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8/">代码生成器</a> <a href="/tags/Jinja2/">Jinja2</a></div><div class="post-content"><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/202207/04/101711nq2we7z7x7wz2z7e.jpg"></p><p>代码生成器是非常有用的工具。我有时使用 <a target="_blank" rel="noopener" href="https://jinja2docs.readthedocs.io/en/stable/">jinja2</a> 的命令行版本来生成高度冗余的配置文件和其他文本文件，但它在转换数据方面功能有限。显然，Jinja2 的作者有不同的想法，而我想要类似于 <ruby>列表推导 <rt>list comprehensions</rt></ruby> 或 D 语言的 <ruby>可组合范围 <rt>composable range</rt></ruby> 算法之类的东西。</p><p>我决定制作一个类似于 Jinja2 的工具，但让我可以通过使用范围算法转换数据来生成复杂的文件。这个想法非常简单：一个直接用 D 语言代码重写的模板语言。因为它 <em>就是</em> D 语言，它可以支持 D 语言所能做的一切。我想要一个独立的代码生成器，但是由于 <a target="_blank" rel="noopener" href="https://dlang.org/articles/mixin.html">D 语言的 <code>mixin</code> 特性</a>，同样的模板语言可以作为嵌入式模板语言工作（例如，Web 应用程序中的 HTML）。有关该技巧的更多信息，请参阅 <a target="_blank" rel="noopener" href="https://theartofmachinery.com/2017/12/31/compile_time_brainfuck.html">这篇</a> 关于在编译时使用 mixins 将 Brainfuck 转换为 D 和机器代码的文章。</p><p>像往常一样，<a target="_blank" rel="noopener" href="https://gitlab.com/sarneaud/djinn">源码在 GitLab 上</a>。<a target="_blank" rel="noopener" href="https://gitlab.com/sarneaud/djinn/-/tree/v0.1.0/examples">这篇文章中的例子也可以在这里找到</a>。</p><h3 id="Hello-world-示例"><a href="#Hello-world-示例" class="headerlink" title="Hello world 示例"></a>Hello world 示例</h3><p>这是一个演示这个想法的例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Hello [= retro(&quot;dlrow&quot;) ]!</span><br><span class="line">[: enum one = 1; :]</span><br><span class="line">1 + 1 = [= one + one ]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>[= some_expression ]</code> 类似于 Jinja2 中的 <code>&#123;&#123; some_expression &#125;&#125;</code>，它在输出中呈现一个值。<code>[: some_statement; :]</code> 类似于 <code>&#123;% some_statement %&#125;</code> ，用于执行完整的代码语句。我更改了语法，因为 D 也大量使用花括号，并且将两者混合使模板难以阅读（还有一些特殊的非 D 指令，比如 <code>include</code>，它们被包裹在 <code>[&lt;</code> 和 <code>&gt;]</code> 中）。</p><p>如果你将上面的内容保存到一个名为 <code>hello.txt.dj</code> 的文件中并运行 <code>djinn</code> 命令行工具，你会得到一个名为 <code>hello.txt</code> 的文件，其中包含你可能猜到的内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hello world!</span><br><span class="line">1 + 1 = 2</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果你使用过 Jinja2，你可能想知道第二行发生了什么。Djinn 有一个简化格式化和空格处理的特殊规则：如果源代码行包含 <code>[:</code> 语句或 <code>[&lt;</code> 指令但不包含任何非空格输出，则整行都会被忽略输出。空行则仍会原样呈现。</p><h3 id="生成数据"><a href="#生成数据" class="headerlink" title="生成数据"></a>生成数据</h3><p>好的，现在来讲一些更实用的东西：生成 CSV 数据。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x,f(x)</span><br><span class="line">[: import std.mathspecial;</span><br><span class="line">foreach (x; iota(-1.0, 1.0, 0.1)) :]</span><br><span class="line">[= &quot;%0.1f,%g&quot;, x, normalDistribution(x) ]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>一个 <code>[=</code> 和 <code>]</code> 对可以包含多个用逗号分隔的表达式。如果第一个表达式是一个由双引号包裹的字符串，则会被解释为 <a target="_blank" rel="noopener" href="https://dlang.org/phobos/std_format.html#format-string">格式化字符串</a>。下面是输出结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">x,f(x)</span><br><span class="line">-1.0,0.158655</span><br><span class="line">-0.9,0.18406</span><br><span class="line">-0.8,0.211855</span><br><span class="line">-0.7,0.241964</span><br><span class="line">-0.6,0.274253</span><br><span class="line">-0.5,0.308538</span><br><span class="line">-0.4,0.344578</span><br><span class="line">-0.3,0.382089</span><br><span class="line">-0.2,0.42074</span><br><span class="line">-0.1,0.460172</span><br><span class="line">0.0,0.5</span><br><span class="line">0.1,0.539828</span><br><span class="line">0.2,0.57926</span><br><span class="line">0.3,0.617911</span><br><span class="line">0.4,0.655422</span><br><span class="line">0.5,0.691462</span><br><span class="line">0.6,0.725747</span><br><span class="line">0.7,0.758036</span><br><span class="line">0.8,0.788145</span><br><span class="line">0.9,0.81594</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="制作图片"><a href="#制作图片" class="headerlink" title="制作图片"></a>制作图片</h3><p>这个例子展示了一个图片的生成过程。<a target="_blank" rel="noopener" href="http://netpbm.sourceforge.net/doc/#formats">经典的 Netpbm 图像库定义了一堆图像格式</a>，其中一些是基于文本的。例如，这是一个 3 x 3 向量的图像：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">P2 # PGM 格式标识</span><br><span class="line">3 3 # 宽和高</span><br><span class="line">7 # 代表纯白色的值（0 代表黑色）</span><br><span class="line">7 0 7</span><br><span class="line">0 0 0</span><br><span class="line">7 0 7</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>你可以将上述文本保存到名为 <code>cross.pgm</code> 之类的文件中，很多图像工具都知道如何解析它。下面是一些 Djinn 代码，它以相同的格式生成 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Mandelbrot_set">Mandelbrot 集</a> 分形：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[:</span><br><span class="line">import std.complex;</span><br><span class="line">enum W = 640;</span><br><span class="line">enum H = 480;</span><br><span class="line">enum kMaxIter = 20;</span><br><span class="line">ubyte mb(uint x, uint y)</span><br><span class="line">&#123;</span><br><span class="line">    const c = complex(3.0 * (x - W / 1.5) / W, 2.0 * (y - H / 2.0) / H);</span><br><span class="line">    auto z = complex(0.0);</span><br><span class="line">    ubyte ret = kMaxIter;</span><br><span class="line">    while (abs(z) &lt;= 2 &amp;&amp; --ret) z = z * z + c;</span><br><span class="line">    return ret;</span><br><span class="line">&#125;</span><br><span class="line">:]</span><br><span class="line">P2</span><br><span class="line">[= W ] [= H ]</span><br><span class="line">[= kMaxIter ]</span><br><span class="line">[: foreach (y; 0..H) :]</span><br><span class="line">[= &quot;%(%s %)&quot;, iota(W).map!(x =&gt; mb(x, y)) ]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>生成的文件大约为 800 kB，但它可以很好地被压缩为 PNG：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ # 使用 GraphicsMagick 进行转换</span><br><span class="line">$ gm convert mandelbrot.pgm mandelbrot.png</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>结果如下：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/202207/04/101716nh6t32cop2ozu6th.png"></p><h3 id="解决谜题"><a href="#解决谜题" class="headerlink" title="解决谜题"></a>解决谜题</h3><p>这里有一个谜题：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/202207/04/101716exxxx333kkkcx6g3.svg"></p><p>一个 5 行 5 列的网格需要用 1 到 5 的数字填充，每个数字在每一行中限使用一次，在每列中限使用一次（即，制作一个 5 行 5 列的<ruby>拉丁方格 <rt>Latin square</rt></ruby>）。相邻单元格中的数字还必须满足所有 <code>&gt;</code> 大于号表示的不等式。</p><p><a target="_blank" rel="noopener" href="https://theartofmachinery.com/2020/05/21/glico_weighted_rock_paper_scissors.html">几个月前我使用了 <ruby>线性规划 <rt>linear programming</rt></ruby>（LP）</a>。线性规划问题是具有线性约束的连续变量系统。这次我将使用<ruby>混合整数线性规划 <rt>mixed integer linear programming</rt></ruby>（MILP），它通过允许整数约束变量来归纳 LP。事实证明，这足以成为 NP 完备的，而 MILP 恰好可以很好地模拟这个谜题。</p><p>在上一篇文章中，我使用 Julia 库 JuMP 来帮助解决这个问题。这次我将使用 <a target="_blank" rel="noopener" href="http://lpsolve.sourceforge.net/5.0/CPLEX-format.htm">CPLEX：基于文本的格式</a>，它受到多个 LP 和 MILP 求解器的支持（如果需要，可以通过现成的工具轻松转换为其他格式）。这是上一篇文章中 CPLEX 格式的 LP：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Minimize</span><br><span class="line">  obj: v</span><br><span class="line">Subject To</span><br><span class="line">  ptotal: pr + pp + ps = 1</span><br><span class="line">  rock: 4 ps - 5 pp - v &lt;= 0</span><br><span class="line">  paper: 5 pr - 8 ps - v &lt;= 0</span><br><span class="line">  scissors: 8 pp - 4 pr - v &lt;= 0</span><br><span class="line">Bounds</span><br><span class="line">  0 &lt;= pr &lt;= 1</span><br><span class="line">  0 &lt;= pp &lt;= 1</span><br><span class="line">  0 &lt;= ps &lt;= 1</span><br><span class="line">End</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>CPLEX 格式易于阅读，但复杂度高的问题需要大量变量和约束来建模，这使得手工编码既痛苦又容易出错。有一些特定领域的语言，例如 <a target="_blank" rel="noopener" href="https://zimpl.zib.de/">ZIMPL</a>，用于以高级方式描述 MILP 和 LP。对于许多问题来说，它们非常酷，但最终它们不如具有良好库（如 JuMP）支持的通用语言或使用 D 语言的代码生成器那样富有表现力。</p><p>我将使用两组变量来模拟这个谜题：<code>v_&#123;r,c&#125;</code> 和 <code>i_&#123;r,c,v&#125;</code>。<code>v_&#123;r,c&#125;</code> 将保存 r 行 c 列单元格的值（从 1 到 5）。<code>i_&#123;r,c,v&#125;</code> 是一个二进制指示器，如果 r 行 c 列的单元格的值是 v，则该指示器值为 1，否则为 0。这两组变量是网格的冗余表示，但第一种表示更容易对不等式约束进行建模，而第二种表示更容易对唯一性约束进行建模。我只需要添加一些额外的约束来强制这两个表示是一致的。但首先，让我们从每个单元格必须只有一个值的基本约束开始。从数学上讲，这意味着给定行和列的所有指示器都必须为 0，但只有一个值为 1 的例外。这可以通过以下等式强制约束：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[i_&#123;r,c,1&#125; + i_&#123;r,c,2&#125; + i_&#123;r,c,3&#125; + i_&#123;r,c,4&#125; + i_&#123;r,c,5&#125; = 1]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以使用以下 Djinn 代码生成对所有行和列的 CPLEX 约束：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">\ 单元格只有一个值</span><br><span class="line">[:</span><br><span class="line">foreach (r; iota(N))</span><br><span class="line">foreach (c; iota(N))</span><br><span class="line">:]</span><br><span class="line">    [= &quot;%-(%s + %)&quot;, vs.map!(v =&gt; ivar(r, c, v)) ] = 1</span><br><span class="line">[::]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>ivar()</code> 是一个辅助函数，它为我们提供变量名为 <code>i</code> 的字符串标识符，而 <code>vs</code> 存储从 1 到 5 的数字以方便使用。行和列内唯一性的约束完全相同，但在 <code>i</code> 的其他两个维度上迭代。</p><p>为了使变量组 <code>i</code> 与变量组 <code>v</code> 保持一致，我们需要如下约束（请记住，变量组 <code>i</code> 中只有一个元素的值是非零的）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[i_&#123;r,c,1&#125; + 2i_&#123;r,c,2&#125; + 3i_&#123;r,c,3&#125; + 4i_&#123;r,c,4&#125; + 5i_&#123;r,c,5&#125; = v_&#123;r,c&#125;]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>CPLEX 要求所有变量都位于左侧，因此 Djinn 代码如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">\ 连接变量组 i 和变量组 v</span><br><span class="line">[:</span><br><span class="line">foreach (r; iota(N))</span><br><span class="line">foreach (c; iota(N))</span><br><span class="line">:]</span><br><span class="line">    [= &quot;%-(%s + %)&quot;, vs.map!(v =&gt; text(v, &#x27; &#x27;, ivar(r, c, v))) ] - [= vvar(r,c) ] = 0</span><br><span class="line">[::]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>不等符号相邻的和左下角值为为 4 单元格的约束写起来都很简单。剩下的便是将指示器变量声明为二进制，并为变量组 <code>v</code> 设置边界。加上变量的边界，总共有 150 个变量和 111 个约束 <a target="_blank" rel="noopener" href="https://gitlab.com/sarneaud/djinn/-/tree/v0.1.0/examples/inequality.lp.dj">你可以在仓库中看到完整的代码</a>。</p><p><a target="_blank" rel="noopener" href="https://www.gnu.org/software/glpk/">GNU 线性规划工具集</a> 有一个命令行工具可以解决这个 CPLEX MILP。不幸的是，它的输出是一个包含了所有内容的体积很大的转储，所以我使用 awk 命令来提取需要的内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ time glpsol --lp inequality.lp -o /dev/stdout | awk &#x27;/v[0-9][0-9]/ &#123; print $2, $4 &#125;&#x27; | sort</span><br><span class="line">v00 1</span><br><span class="line">v01 3</span><br><span class="line">v02 2</span><br><span class="line">v03 5</span><br><span class="line">v04 4</span><br><span class="line">v10 2</span><br><span class="line">v11 5</span><br><span class="line">v12 4</span><br><span class="line">v13 1</span><br><span class="line">v14 3</span><br><span class="line">v20 3</span><br><span class="line">v21 1</span><br><span class="line">v22 5</span><br><span class="line">v23 4</span><br><span class="line">v24 2</span><br><span class="line">v30 5</span><br><span class="line">v31 4</span><br><span class="line">v32 3</span><br><span class="line">v33 2</span><br><span class="line">v34 1</span><br><span class="line">v40 4</span><br><span class="line">v41 2</span><br><span class="line">v42 1</span><br><span class="line">v43 3</span><br><span class="line">v44 5</span><br><span class="line"></span><br><span class="line">real    0m0.114s</span><br><span class="line">user    0m0.106s</span><br><span class="line">sys     0m0.005s</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这是在原始网格中写出的解决方案：</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/202207/04/101717cjbaza2ds0j2qjj1.svg"></p><p>这些例子只是用来玩的，但我相信你已经明白了。顺便说一下，Djinn 代码仓库的 <code>README.md</code> 文件本身是使用 Djinn 模板生成的。</p><p>正如我所说，Djinn 也可以用作嵌入在 D 语言代码中的编译期模板语言。我最初只是想要一个代码生成器，得益于 D 语言的元编程功能，这算是一个额外获得的功能。</p><hr><p>via: <a target="_blank" rel="noopener" href="https://theartofmachinery.com/2021/01/01/djinn.html">https://theartofmachinery.com/2021/01/01/djinn.html</a></p><p>作者：<a target="_blank" rel="noopener" href="https://theartofmachinery.com/">Simon Arneaud</a> 选题：<a target="_blank" rel="noopener" href="https://github.com/lujun9972">lujun9972</a> 译者：<a target="_blank" rel="noopener" href="https://github.com/hanszhao80">hanszhao80</a> 校对：<a target="_blank" rel="noopener" href="https://github.com/wxy">wxy</a></p><p>本文由 <a target="_blank" rel="noopener" href="https://github.com/LCTT/TranslateProject">LCTT</a> 原创编译，<a target="_blank" rel="noopener" href="https://linux.cn/">Linux中国</a> 荣誉推出</p></div></div></div><div class="footer"><p class="footer-copyright"><span>Powered by <a target="_blank" href="https://hexo.io">Hexo</a></span> <span>Theme <a target="_blank" href="https://github.com/tinkink-co/hexo-theme-terminal">Terminal</a></span><script type="text/javascript" src="https://cdn.staticfile.net/jquery/3.4.1/jquery.min.js"></script><script>getCDNinfo=function(){$.ajax({url:"/cdn-cgi/trace",success:function(a,n){let i="Antananarivo, Madagascar - (TNR);Cape Town, South Africa - (CPT);Casablanca, Morocco - (CMN);Dar Es Salaam, Tanzania - (DAR);Djibouti City, Djibouti - (JIB);Durban, South Africa - (DUR);Johannesburg, South Africa - (JNB);Kigali, Rwanda - (KGL);Lagos, Nigeria - (LOS);Luanda, Angola - (LAD);Maputo, MZ - (MPM);Mombasa, Kenya - (MBA);Port Louis, Mauritius - (MRU);Réunion, France - (RUN);Bangalore, India - (BLR);Bangkok, Thailand - (BKK);Bandar Seri Begawan, Brunei - (BWN);Cebu, Philippines - (CEB);Chengdu, China - (CTU);Chennai, India - (MAA);Chittagong, Bangladesh - (CGP);Chongqing, China - (CKG);Colombo, Sri Lanka - (CMB);Dhaka, Bangladesh - (DAC);Dongguan, China - (SZX);Foshan, China - (FUO);Fuzhou, China - (FOC);Guangzhou, China - (CAN);Hangzhou, China - (HGH);Hanoi, Vietnam - (HAN);Hengyang, China - (HNY);Ho Chi Minh City, Vietnam - (SGN);Hong Kong - (HKG);Hyderabad, India - (HYD);Islamabad, Pakistan - (ISB);Jakarta, Indonesia - (CGK);Jinan, China - (TNA);Karachi, Pakistan - (KHI);Kathmandu, Nepal - (KTM);Kolkata, India - (CCU);Kuala Lumpur, Malaysia - (KUL);Lahore, Pakistan - (LHE);Langfang, China - (NAY);Luoyang, China - (LYA);Macau - (MFM);Malé, Maldives - (MLE);Manila, Philippines - (MNL);Mumbai, India - (BOM);Nagpur, India - (NAG);Nanning, China - (NNG);New Delhi, India - (DEL);Osaka, Japan - (KIX);Phnom Penh, Cambodia - (PNH);Qingdao, China - (TAO);Seoul, South Korea - (ICN);Shanghai, China - (SHA);Shenyang, China - (SHE);Shijiazhuang, China - (SJW);Singapore, Singapore - (SIN);Suzhou, China - (SZV);Taipei - (TPE);Thimphu, Bhutan - (PBH);Tianjin, China - (TSN);Tokyo, Japan - (NRT);Ulaanbaatar, Mongolia - (ULN);Vientiane, Laos - (VTE);Wuhan, China - (WUH);Wuxi, China - (WUX);Xi'an, China - (XIY);Yerevan, Armenia - (EVN);Zhengzhou, China - (CGO);Zuzhou, China - (CSX);Amsterdam, Netherlands - (AMS);Athens, Greece - (ATH);Barcelona, Spain - (BCN);Belgrade, Serbia - (BEG);Berlin, Germany - (TXL);Brussels, Belgium - (BRU);Bucharest, Romania - (OTP);Budapest, Hungary - (BUD);Chișinău, Moldova - (KIV);Copenhagen, Denmark - (CPH);Cork, Ireland -  (ORK);Dublin, Ireland - (DUB);Düsseldorf, Germany - (DUS);Edinburgh, United Kingdom - (EDI);Frankfurt, Germany - (FRA);Geneva, Switzerland - (GVA);Gothenburg, Sweden - (GOT);Hamburg, Germany - (HAM);Helsinki, Finland - (HEL);Istanbul, Turkey - (IST);Kyiv, Ukraine - (KBP);Lisbon, Portugal - (LIS);London, United Kingdom - (LHR);Luxembourg City, Luxembourg - (LUX);Madrid, Spain - (MAD);Manchester, United Kingdom - (MAN);Marseille, France - (MRS);Milan, Italy - (MXP);Moscow, Russia - (DME);Munich, Germany - (MUC);Nicosia, Cyprus - (LCA);Oslo, Norway - (OSL);Paris, France - (CDG);Prague, Czech Republic - (PRG);Reykjavík, Iceland - (KEF);Riga, Latvia - (RIX);Rome, Italy - (FCO);Saint Petersburg, Russia - (LED);Sofia, Bulgaria - (SOF);Stockholm, Sweden - (ARN);Tallinn, Estonia - (TLL);Thessaloniki, Greece - (SKG);Vienna, Austria - (VIE);Vilnius, Lithuania - (VNO);Warsaw, Poland - (WAW);Zagreb, Croatia - (ZAG);Zürich, Switzerland - (ZRH);Arica, Chile - (ARI);Asunción, Paraguay - (ASU);Bogotá, Colombia - (BOG);Buenos Aires, Argentina - (EZE);Curitiba, Brazil - (CWB);Fortaleza, Brazil - (FOR);Guatemala City, Guatemala - (GUA);Lima, Peru - (LIM);Medellín, Colombia - (MDE);Panama City, Panama - (PTY);Porto Alegre, Brazil - (POA);Quito, Ecuador - (UIO);Rio de Janeiro, Brazil - (GIG);São Paulo, Brazil - (GRU);Santiago, Chile - (SCL);Willemstad, Curaçao - (CUR);St. George's, Grenada - (GND);Amman, Jordan - (AMM);Baghdad, Iraq - (BGW);Baku, Azerbaijan - (GYD);Beirut, Lebanon - (BEY);Doha, Qatar - (DOH);Dubai, United Arab Emirates - (DXB);Kuwait City, Kuwait - (KWI);Manama, Bahrain - (BAH);Muscat, Oman - (MCT);Ramallah - (ZDM);Riyadh, Saudi Arabia - (RUH);Tel Aviv, Israel - (TLV);Ashburn, VA, United States - (IAD);Atlanta, GA, United States - (ATL);Boston, MA, United States - (BOS);Buffalo, NY, United States - (BUF);Calgary, AB, Canada - (YYC);Charlotte, NC, United States - (CLT);Chicago, IL, United States - (ORD);Columbus, OH, United States - (CMH);Dallas, TX, United States - (DFW);Denver, CO, United States - (DEN);Detroit, MI, United States - (DTW);Honolulu, HI, United States - (HNL);Houston, TX, United States - (IAH);Indianapolis, IN, United States - (IND);Jacksonville, FL, United States - (JAX);Kansas City, MO, United States - (MCI);Las Vegas, NV, United States - (LAS);Los Angeles, CA, United States - (LAX);McAllen, TX, United States - (MFE);Memphis, TN, United States - (MEM);Mexico City, Mexico - (MEX);Miami, FL, United States - (MIA);Minneapolis, MN, United States - (MSP);Montgomery, AL, United States - (MGM);Montréal, QC, Canada - (YUL);Nashville, TN, United States - (BNA);Newark, NJ, United States - (EWR);Norfolk, VA, United States - (ORF);Omaha, NE, United States - (OMA);Philadelphia, United States - (PHL);Phoenix, AZ, United States - (PHX);Pittsburgh, PA, United States - (PIT);Port-Au-Prince, Haiti - (PAP);Portland, OR, United States - (PDX);Queretaro, MX, Mexico - (QRO);Richmond, Virginia - (RIC);Sacramento, CA, United States - (SMF);Salt Lake City, UT, United States - (SLC);San Diego, CA, United States - (SAN);San Jose, CA, United States - (SJC);Saskatoon, SK, Canada - (YXE);Seattle, WA, United States - (SEA);St. Louis, MO, United States - (STL);Tampa, FL, United States - (TPA);Toronto, ON, Canada - (YYZ);Vancouver, BC, Canada - (YVR);Tallahassee, FL, United States - (TLH);Winnipeg, MB, Canada - (YWG);Adelaide, SA, Australia - (ADL);Auckland, New Zealand - (AKL);Brisbane, QLD, Australia - (BNE);Melbourne, VIC, Australia - (MEL);Noumea, New caledonia - (NOU);Perth, WA, Australia - (PER);Sydney, NSW, Australia - (SYD)".split(";"),e=a.split("colo=")[1].split("\n")[0],t=(a.split("colo=")[1].split("\n")[0],a.split("tls=")[1].split("\n")[0]),o=a.split("http=")[1].split("\n")[0],s=a.split("sni=")[1].split("\n")[0],r=a.split("ip=")[1].split("\n")[0],l=a.split("uag=")[1].split("\n")[0];for(var d=0;d<i.length;d++)if(-1!=i[d].indexOf(e)){document.getElementById("cdn").innerHTML=i[d];break}document.getElementById("tls").innerHTML=t,document.getElementById("http").innerHTML=o,document.getElementById("sni").innerHTML=s,document.getElementById("ip").innerHTML=r,document.getElementById("useragent").innerHTML=l}})},$(document).ready((function(){getCDNinfo()}))</script></p><p style="text-align:center">感谢陪伴与布道，开源之火不灭。​</p><p style="text-align:center"><script>document.write("本次加载耗时: "+(performance.getEntriesByType("navigation").reduce((e,r)=>e+r.responseEnd-r.startTime,0)+performance.getEntriesByType("resource").reduce((e,r)=>e+r.responseEnd-r.startTime,0)).toFixed(0)+"ms")</script></p><p style="text-align:center">当前 SNI 状态： <span id="sni">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前 TLS 版本： <span id="tls">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前 HTTP 版本： <span id="http">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前您的客户端 IP 是： <span id="ip">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前分配的 CDN 节点是: <span id="cdn">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">您的 UserAgent 信息是: <span id="useragent">正在统计！或可能被浏览器防追踪拦截！</span></p><p></p></div></div></body></html>