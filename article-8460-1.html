<!doctype html><html lang="en"><head><meta name="msvalidate.01" content="D404690CEFCB54C7762AC84935B99171"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6618da70c90c8744eead2e9371fb5077";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript">!function(t,e,n,c,s,a,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(a=e.createElement(c)).async=1,a.src="https://www.clarity.ms/tag/s5f3f0tojf",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(a,r)}(window,document,"clarity","script")</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="stylesheet" href="/styles/base.css"><link rel="stylesheet" href="/styles/theme.css"><link rel="shortcut icon" href="/favicon.png"><title>如何在 CentOS 7 上安装 Elastic Stack - 归墟星火集</title><meta name="generator" content="Hexo 7.3.0"></head><body><div class="header-title"><span class="header-light"></span> <span class="header-light"></span> <span class="header-light"></span> <span>归墟星火集 linuxcn.undefined.today<span></span></span></div><div class="container"><ul class="nav"><li><a href="/">首页</a></li><li><a href="/about/">关于</a></li><li><a target="_blank" rel="noopener" href="https://undefined.today/">Blog</a></li></ul><div class="content"><div class="post-container"><div class="post-header"><span class="ui-tips">标题：</span><h1 class="ui-keyword post-title">如何在 CentOS 7 上安装 Elastic Stack</h1><span class="post-date">2017-04-29</span></div><div class="post-header"><span class="ui-tips">分类：</span> <a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></div><div class="post-header"><span class="ui-tips">标签：</span> <a href="/tags/%E6%97%A5%E5%BF%97/">日志</a> <a href="/tags/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/">搜索引擎</a> <a href="/tags/Lucene/">Lucene</a></div><div class="post-content"><p><strong>Elasticsearch</strong> 是基于 Lucene 由 Java 开发的开源搜索引擎。它提供了一个分布式、多租户的全文搜索引擎（LCTT 译注：多租户是指多租户技术，是一种软件架构技术，用来探讨与实现如何在多用户的环境下共用相同的系统或程序组件，并且仍可确保各用户间数据的隔离性。），并带有 HTTP 仪表盘的 Web 界面（Kibana）。数据会被 Elasticsearch 查询、检索，并且使用 JSON 文档方案存储。Elasticsearch 是一个可扩展的搜索引擎，可用于搜索所有类型的文本文档，包括日志文件。Elasticsearch 是 Elastic Stack 的核心，Elastic Stack 也被称为 ELK Stack。</p><p><strong>Logstash</strong> 是用于管理事件和日志的开源工具。它为数据收集提供实时传递途径。 Logstash 将收集您的日志数据，将数据转换为 JSON 文档，并将其存储在 Elasticsearch 中。</p><p><strong>Kibana</strong> 是 Elasticsearch 的开源数据可视化工具。Kibana 提供了一个漂亮的仪表盘 Web 界面。 你可以用它来管理和可视化来自 Elasticsearch 的数据。 它不仅美丽，而且强大。</p><p>在本教程中，我将向您展示如何在 CentOS 7 服务器上安装和配置 Elastic Stack 以监视服务器日志。 然后，我将向您展示如何在操作系统为 CentOS 7 和 Ubuntu 16 的客户端上安装 “Elastic beats”。</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201704/29/004453qr9m7m8322rs2ere.jpg"></p><p><strong>前提条件</strong></p><ul><li>64 位的 CentOS 7，4 GB 内存 - elk 主控机</li><li>64 位的 CentOS 7 ，1 GB 内存 - 客户端 1</li><li>64 位的 Ubuntu 16 ，1 GB 内存 - 客户端 2</li></ul><h3 id="步骤-1-准备操作系统"><a href="#步骤-1-准备操作系统" class="headerlink" title="步骤 1 - 准备操作系统"></a>步骤 1 - 准备操作系统</h3><p>在本教程中，我们将禁用 CentOS 7 服务器上的 SELinux。 编辑 SELinux 配置文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/selinux</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>将 <code>SELINUX</code> 的值从 <code>enforcing</code> 改成 <code>disabled</code> 。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELINUX=disabled</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后重启服务器：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>再次登录服务器并检查 SELinux 状态。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getenforce</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>确保结果是 <code>disabled</code>。</p><h3 id="步骤-2-安装-Java"><a href="#步骤-2-安装-Java" class="headerlink" title="步骤 2 - 安装 Java"></a>步骤 2 - 安装 Java</h3><p>部署 Elastic stack 依赖于Java，Elasticsearch 需要 Java 8 版本，推荐使用 Oracle JDK 1.8 。我将从官方的 Oracle rpm 包安装 Java 8。</p><p>使用 <code>wget</code> 命令下载 Java 8 的 JDK。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget --no-cookies --no-check-certificate --header &quot;Cookie: gpw_e24=http:%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie&quot; &quot;http://download.oracle.com/otn-pub/java/jdk/8u77-b02/jdk-8u77-linux-x64.rpm&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后使用 <code>rpm</code> 命令安装：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh jdk-8u77-linux-x64.rpm</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后，检查 java JDK 版本，确保它正常工作。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>您将看到服务器的 Java 版本。</p><h3 id="步骤-3-安装和配置-Elasticsearch"><a href="#步骤-3-安装和配置-Elasticsearch" class="headerlink" title="步骤 3 - 安装和配置 Elasticsearch"></a>步骤 3 - 安装和配置 Elasticsearch</h3><p>在此步骤中，我们将安装和配置 Elasticsearch。 从 elastic.co 网站提供的 rpm 包安装 Elasticsearch，并将其配置运行在 localhost 上（以确保该程序安全，而且不能从外部访问）。</p><p>在安装 Elasticsearch 之前，将 elastic.co 的密钥添加到服务器。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>接下来，使用 <code>wget</code> 下载 Elasticsearch 5.1，然后安装它。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.1.1.rpm</span><br><span class="line">rpm -ivh elasticsearch-5.1.1.rpm</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Elasticsearch 已经安装好了。 现在进入配置目录编辑 <code>elasticsaerch.yml</code> 配置文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/elasticsearch/</span><br><span class="line">vim elasticsearch.yml</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>去掉第 40 行的注释，启用 Elasticsearch 的内存锁。这将禁用 Elasticsearch 的内存交换。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bootstrap.memory_lock: true</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在 <code>Network</code> 块中，取消注释 <code>network.host</code> 和 <code>http.port</code> 行。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">network.host: localhost</span><br><span class="line">http.port: 9200</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存文件并退出编辑器。</p><p>现在编辑 <code>elasticsearch.service</code> 文件的内存锁配置。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/elasticsearch.service</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>去掉第 60 行的注释，确保该值为 <code>unlimited</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MAX_LOCKED_MEMORY=unlimited</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存并退出。</p><p>Elasticsearch 配置到此结束。Elasticsearch 将在本机的 9200 端口运行，我们通过在 CentOS 服务器上启用 <code>mlockall</code> 来禁用内存交换。重新加载 systemd，将 Elasticsearch 置为开机启动，然后启动服务。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl enable elasticsearch</span><br><span class="line">sudo systemctl start elasticsearch</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>等待 Eelasticsearch 启动成功，然后检查服务器上打开的端口，确保 9200 端口的状态是 <code>LISTEN</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -plntu</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201704/29/004509cumkpy8plxqqbxxz.png" alt="Check elasticsearch running on port 9200"></p><p>然后检查内存锁以确保启用 <code>mlockall</code>，并使用以下命令检查 Elasticsearch 是否正在运行。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET &#x27;localhost:9200/_nodes?filter_path=**.mlockall&amp;pretty&#x27;</span><br><span class="line">curl -XGET &#x27;localhost:9200/?pretty&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>会看到如下结果。</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201704/29/004512mt7f2mtur3t0fm7m.png" alt="Check memory lock elasticsearch and check status"></p><h3 id="步骤-4-安装和配置-Kibana-和-Nginx"><a href="#步骤-4-安装和配置-Kibana-和-Nginx" class="headerlink" title="步骤 4 - 安装和配置 Kibana 和 Nginx"></a>步骤 4 - 安装和配置 Kibana 和 Nginx</h3><p>在这一步，我们将在 Nginx Web 服务器上安装并配置 Kibana。 Kibana 监听在 localhost 上，而 Nginx 作为 Kibana 的反向代理。</p><p>用 <code>wget</code> 下载 Kibana 5.1，然后使用 <code>rpm</code> 命令安装：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/kibana/kibana-5.1.1-x86_64.rpm</span><br><span class="line">rpm -ivh kibana-5.1.1-x86_64.rpm</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>编辑 Kibana 配置文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/kibana/kibana.yml</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>去掉配置文件中 <code>server.port</code>、<code>server.host</code> 和 <code>elasticsearch.url</code> 这三行的注释。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server.port: 5601</span><br><span class="line">server.host: &quot;localhost&quot;</span><br><span class="line">elasticsearch.url: &quot;http://localhost:9200&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存并退出。</p><p>将 Kibana 设为开机启动，并且启动 Kibana 。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable kibana</span><br><span class="line">sudo systemctl start kibana</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Kibana 将作为 node 应用程序运行在端口 5601 上。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -plntu</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201704/29/004515rfpdup3bi2f2zuw2.png" alt="Kibana running as node application on port 5601"></p><p>Kibana 安装到此结束。 现在我们需要安装 Nginx 并将其配置为反向代理，以便能够从公共 IP 地址访问 Kibana。</p><p>Nginx 在 Epel 资源库中可以找到，用 <code>yum</code> 安装 epel-release。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后安装 Nginx 和 httpd-tools 这两个包。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nginx httpd-tools</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>httpd-tools 软件包包含 Web 服务器的工具，可以为 Kibana 添加 htpasswd 基础认证。</p><p>编辑 Nginx 配置文件并删除 <code>server &#123;&#125;</code> 块，这样我们可以添加一个新的虚拟主机配置。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/nginx/</span><br><span class="line">vim nginx.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>删除 <code>server &#123; &#125;</code> 块。</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201704/29/004517s2ihfkof5fj5zag1.png" alt="Remove Server Block on Nginx configuration"></p><p>保存并退出。</p><p>现在我们需要在 <code>conf.d</code> 目录中创建一个新的虚拟主机配置文件。 用 <code>vim</code> 创建新文件 <code>kibana.conf</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/conf.d/kibana.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>复制下面的配置。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line"></span><br><span class="line">    server_name elk-stack.co;</span><br><span class="line"></span><br><span class="line">    auth_basic &quot;Restricted Access&quot;;</span><br><span class="line">    auth_basic_user_file /etc/nginx/.kibana-user;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://localhost:5601;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection &#x27;upgrade&#x27;;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_cache_bypass $http_upgrade;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存并退出。</p><p>然后使用 <code>htpasswd</code> 命令创建一个新的基本认证文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo htpasswd -c /etc/nginx/.kibana-user admin</span><br><span class="line">“输入你的密码”</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>测试 Nginx 配置，确保没有错误。 然后设定 Nginx 开机启动并启动 Nginx。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx -t</span><br><span class="line">systemctl enable nginx</span><br><span class="line">systemctl start nginx</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201704/29/004520arcbpi9v0x119ctc.png" alt="Add nginx virtual host configuration for Kibana Application"></p><h3 id="步骤-5-安装和配置-Logstash"><a href="#步骤-5-安装和配置-Logstash" class="headerlink" title="步骤 5 - 安装和配置 Logstash"></a>步骤 5 - 安装和配置 Logstash</h3><p>在此步骤中，我们将安装 Logstash，并将其配置为：从配置了 filebeat 的 logstash 客户端里集中化服务器的日志，然后过滤和转换 Syslog 数据，并将其移动到存储中心（Elasticsearch）中。</p><p>下载 Logstash 并使用 rpm 进行安装。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/logstash/logstash-5.1.1.rpm</span><br><span class="line">rpm -ivh logstash-5.1.1.rpm</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>生成新的 SSL 证书文件，以便客户端可以识别 elastic 服务端。</p><p>进入 <code>tls</code> 目录并编辑 <code>openssl.cnf</code> 文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/pki/tls</span><br><span class="line">vim openssl.cnf</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在 <code>[v3_ca]</code> 部分添加服务器标识。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ v3_ca ]</span><br><span class="line"></span><br><span class="line"># Server IP Address</span><br><span class="line">subjectAltName = IP: 10.0.15.10</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存并退出。</p><p>使用 <code>openssl</code> 命令生成证书文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl req -config /etc/pki/tls/openssl.cnf -x509 -days 3650 -batch -nodes -newkey rsa:2048 -keyout /etc/pki/tls/private/logstash-forwarder.key -out /etc/pki/tls/certs/logstash-forwarder.crt</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>证书文件可以在 <code>/etc/pki/tls/certs/</code> 和 <code>/etc/pki/tls/private/</code> 目录中找到。</p><p>接下来，我们会为 Logstash 创建新的配置文件。创建一个新的 <code>filebeat-input.conf</code> 文件来为 filebeat 配置日志源，然后创建一个 <code>syslog-filter.conf</code> 配置文件来处理 syslog，再创建一个 <code>output-elasticsearch.conf</code> 文件来定义输出日志数据到 Elasticsearch。</p><p>转到 logstash 配置目录，并在 <code>conf.d</code> 子目录中创建新的配置文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/logstash/</span><br><span class="line">vim conf.d/filebeat-input.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输入配置，粘贴以下配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5443</span><br><span class="line">    ssl =&gt; true</span><br><span class="line">    ssl_certificate =&gt; &quot;/etc/pki/tls/certs/logstash-forwarder.crt&quot;</span><br><span class="line">    ssl_key =&gt; &quot;/etc/pki/tls/private/logstash-forwarder.key&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存并退出。</p><p>创建 <code>syslog-filter.conf</code> 文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim conf.d/syslog-filter.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>粘贴以下配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line">  if [type] == &quot;syslog&quot; &#123;</span><br><span class="line">    grok &#123;</span><br><span class="line">      match =&gt; &#123; &quot;message&quot; =&gt; &quot;%&#123;SYSLOGTIMESTAMP:syslog_timestamp&#125; %&#123;SYSLOGHOST:syslog_hostname&#125; %&#123;DATA:syslog_program&#125;(?:\[%&#123;POSINT:syslog_pid&#125;\])?: %&#123;GREEDYDATA:syslog_message&#125;&quot; &#125;</span><br><span class="line">      add_field =&gt; [ &quot;received_at&quot;, &quot;%&#123;@timestamp&#125;&quot; ]</span><br><span class="line">      add_field =&gt; [ &quot;received_from&quot;, &quot;%&#123;host&#125;&quot; ]</span><br><span class="line">    &#125;</span><br><span class="line">    date &#123;</span><br><span class="line">      match =&gt; [ &quot;syslog_timestamp&quot;, &quot;MMM  d HH:mm:ss&quot;, &quot;MMM dd HH:mm:ss&quot; ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们使用名为 <code>grok</code> 的过滤器插件来解析 syslog 文件。</p><p>保存并退出。</p><p>创建输出配置文件 <code>output-elasticsearch.conf</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim conf.d/output-elasticsearch.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>粘贴以下配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123; hosts =&gt; [&quot;localhost:9200&quot;]</span><br><span class="line">    hosts =&gt; &quot;localhost:9200&quot;</span><br><span class="line">    manage_template =&gt; false</span><br><span class="line">    index =&gt; &quot;%&#123;[@metadata][beat]&#125;-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">    document_type =&gt; &quot;%&#123;[@metadata][type]&#125;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存并退出。</p><p>最后，将 logstash 设定为开机启动并且启动服务。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable logstash</span><br><span class="line">sudo systemctl start logstash</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201704/29/004523i98f4qasoq8qt94t.png" alt="Logstash started on port 5443 with SSL Connection"></p><h3 id="步骤-6-在-CentOS-客户端上安装并配置-Filebeat"><a href="#步骤-6-在-CentOS-客户端上安装并配置-Filebeat" class="headerlink" title="步骤 6 - 在 CentOS 客户端上安装并配置 Filebeat"></a>步骤 6 - 在 CentOS 客户端上安装并配置 Filebeat</h3><p>Beat 作为数据发送人的角色，是一种可以安装在客户端节点上的轻量级代理，将大量数据从客户机发送到 Logstash 或 Elasticsearch 服务器。有 4 种 beat，<code>Filebeat</code> 用于发送“日志文件”，<code>Metricbeat</code> 用于发送“指标”，<code>Packetbeat</code> 用于发送“网络数据”，<code>Winlogbeat</code> 用于发送 Windows 客户端的“事件日志”。</p><p>在本教程中，我将向您展示如何安装和配置 <code>Filebeat</code>，通过 SSL 连接将数据日志文件传输到 Logstash 服务器。</p><p>登录到客户端1的服务器上。 然后将证书文件从 elastic 服务器复制到客户端1的服务器上。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh root@client1IP</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>使用 <code>scp</code> 命令拷贝证书文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp root@elk-serverIP:~/logstash-forwarder.crt .</span><br><span class="line">输入 elk-server 的密码</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>创建一个新的目录，将证书移动到这个目录中。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/pki/tls/certs/</span><br><span class="line">mv ~/logstash-forwarder.crt /etc/pki/tls/certs/</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>接下来，在客户端 1 服务器上导入 elastic 密钥。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>下载 Filebeat 并且用 <code>rpm</code> 命令安装。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-5.1.1-x86_64.rpm</span><br><span class="line">rpm -ivh filebeat-5.1.1-x86_64.rpm</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Filebeat 已经安装好了，请转到配置目录并编辑 <code>filebeat.yml</code> 文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/filebeat/</span><br><span class="line">vim filebeat.yml</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在第 21 行的路径部分，添加新的日志文件。 我们将创建两个文件，记录 ssh 活动的 <code>/var/log/secure</code> 文件 ，以及服务器日志 <code>/var/log/messages</code> 。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">paths:</span><br><span class="line">  - /var/log/secure</span><br><span class="line">  - /var/log/messages</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在第 26 行添加一个新配置来定义 syslog 类型的文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">document-type: syslog</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Filebeat 默认使用 Elasticsearch 作为输出目标。 在本教程中，我们将其更改为 Logshtash。 在 83 行和 85 行添加注释来禁用 Elasticsearch 输出。</p><p>禁用 Elasticsearch 输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#-------------------------- Elasticsearch output ------------------------------</span><br><span class="line">#output.elasticsearch:</span><br><span class="line">  # Array of hosts to connect to.</span><br><span class="line">#  hosts: [&quot;localhost:9200&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>现在添加新的 logstash 输出配置。 去掉 logstash 输出配置的注释，并将所有值更改为下面配置中的值。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">output.logstash:</span><br><span class="line">  # The Logstash hosts</span><br><span class="line">  hosts: [&quot;10.0.15.10:5443&quot;]</span><br><span class="line">  bulk_max_size: 1024</span><br><span class="line">  ssl.certificate_authorities: [&quot;/etc/pki/tls/certs/logstash-forwarder.crt&quot;]</span><br><span class="line">  template.name: &quot;filebeat&quot;</span><br><span class="line">  template.path: &quot;filebeat.template.json&quot;</span><br><span class="line">  template.overwrite: false</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存文件并退出 vim。</p><p>将 Filebeat 设定为开机启动并启动。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable filebeat</span><br><span class="line">sudo systemctl start filebeat</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="步骤-7-在-Ubuntu-客户端上安装并配置-Filebeat"><a href="#步骤-7-在-Ubuntu-客户端上安装并配置-Filebeat" class="headerlink" title="步骤 7 - 在 Ubuntu 客户端上安装并配置 Filebeat"></a>步骤 7 - 在 Ubuntu 客户端上安装并配置 Filebeat</h3><p>使用 <code>ssh</code> 连接到服务器。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh root@ubuntu-clientIP</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>使用 <code>scp</code> 命令拷贝证书文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp root@elk-serverIP:~/logstash-forwarder.crt .</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>创建一个新的目录，将证书移动到这个目录中。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/pki/tls/certs/</span><br><span class="line">mv ~/logstash-forwarder.crt /etc/pki/tls/certs/</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在服务器上导入 elastic 密钥。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>下载 Filebeat .deb 包并且使用 <code>dpkg</code> 命令进行安装。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-5.1.1-amd64.deb</span><br><span class="line">dpkg -i filebeat-5.1.1-amd64.deb</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>转到配置目录并编辑 <code>filebeat.yml</code> 文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/filebeat/</span><br><span class="line">vim filebeat.yml</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在路径配置部分添加新的日志文件路径。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">paths:</span><br><span class="line">  - /var/log/auth.log</span><br><span class="line">  - /var/log/syslog</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>设定文档类型为 <code>syslog</code> 。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">document-type: syslog</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>将下列几行注释掉，禁用输出到 Elasticsearch。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#-------------------------- Elasticsearch output ------------------------------</span><br><span class="line">#output.elasticsearch:</span><br><span class="line">  # Array of hosts to connect to.</span><br><span class="line">#  hosts: [&quot;localhost:9200&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>启用 logstash 输出，去掉以下配置的注释并且按照如下所示更改值。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">output.logstash:</span><br><span class="line">  # The Logstash hosts</span><br><span class="line">  hosts: [&quot;10.0.15.10:5443&quot;]</span><br><span class="line">  bulk_max_size: 1024</span><br><span class="line">  ssl.certificate_authorities: [&quot;/etc/pki/tls/certs/logstash-forwarder.crt&quot;]</span><br><span class="line">  template.name: &quot;filebeat&quot;</span><br><span class="line">  template.path: &quot;filebeat.template.json&quot;</span><br><span class="line">  template.overwrite: false</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存并退出 vim。</p><p>将 Filebeat 设定为开机启动并启动。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable filebeat</span><br><span class="line">sudo systemctl start filebeat</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>检查服务状态：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl status filebeat</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201704/29/004526pa3c2cze7u7yyvkz.png" alt="Filebeat is running on the client Ubuntu"></p><h3 id="步骤-8-测试"><a href="#步骤-8-测试" class="headerlink" title="步骤 8 - 测试"></a>步骤 8 - 测试</h3><p>打开您的网络浏览器，并访问您在 Nginx 中配置的 elastic stack 域名，我的是“elk-stack.co”。 使用管理员密码登录，然后按 Enter 键登录 Kibana 仪表盘。</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201704/29/004530wvvf0ini30k8npni.png" alt="Login to the Kibana Dashboard with Basic Auth"></p><p>创建一个新的默认索引 <code>filebeat-*</code>，然后点击“创建”按钮。</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201704/29/004533ff3rzp89ppf3lm2k.png" alt="Create First index filebeat for Kibana"></p><p>默认索引已创建。 如果 elastic stack 上有多个 beat，您可以在“星形”按钮上点击一下即可配置默认 beat。</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201704/29/004534lchbbto58h7b5cz8.png" alt="Filebeat index as default index on Kibana Dashboard"></p><p>转到 “发现” 菜单，您就可以看到 elk-client1 和 elk-client2 服务器上的所有日志文件。</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201704/29/004536i8mh48fx54kr42hz.png" alt="Discover all Log Files from the Servers"></p><p>来自 elk-client1 服务器日志中的无效 ssh 登录的 JSON 输出示例。</p><p><img src="https://linuxcn.img.undefined.today/data/attachment/album/201704/29/004547r1g0erhfl72vi15v.png" alt="JSON output for Failed SSH Login"></p><p>使用其他的选项，你可以使用 Kibana 仪表盘做更多的事情。</p><p>Elastic Stack 已安装在 CentOS 7 服务器上。 Filebeat 已安装在 CentOS 7 和 Ubuntu 客户端上。</p><hr><p>via: <a target="_blank" rel="noopener" href="https://www.howtoforge.com/tutorial/how-to-install-elastic-stack-on-centos-7/">https://www.howtoforge.com/tutorial/how-to-install-elastic-stack-on-centos-7/</a></p><p>作者：<a target="_blank" rel="noopener" href="https://www.howtoforge.com/tutorial/how-to-install-elastic-stack-on-centos-7/">Muhammad Arul</a> 译者：<a target="_blank" rel="noopener" href="https://github.com/Flowsnow">Flowsnow</a> 校对：<a target="_blank" rel="noopener" href="https://github.com/wxy">wxy</a></p><p>本文由 <a target="_blank" rel="noopener" href="https://github.com/LCTT/TranslateProject">LCTT</a> 原创编译，<a target="_blank" rel="noopener" href="https://linux.cn/">Linux中国</a> 荣誉推出</p></div></div></div><div class="footer"><p class="footer-copyright"><span>Powered by <a target="_blank" href="https://hexo.io">Hexo</a></span> <span>Theme <a target="_blank" href="https://github.com/tinkink-co/hexo-theme-terminal">Terminal</a></span><script type="text/javascript" src="https://cdn.staticfile.net/jquery/3.4.1/jquery.min.js"></script><script>getCDNinfo=function(){$.ajax({url:"/cdn-cgi/trace",success:function(a,n){let i="Antananarivo, Madagascar - (TNR);Cape Town, South Africa - (CPT);Casablanca, Morocco - (CMN);Dar Es Salaam, Tanzania - (DAR);Djibouti City, Djibouti - (JIB);Durban, South Africa - (DUR);Johannesburg, South Africa - (JNB);Kigali, Rwanda - (KGL);Lagos, Nigeria - (LOS);Luanda, Angola - (LAD);Maputo, MZ - (MPM);Mombasa, Kenya - (MBA);Port Louis, Mauritius - (MRU);Réunion, France - (RUN);Bangalore, India - (BLR);Bangkok, Thailand - (BKK);Bandar Seri Begawan, Brunei - (BWN);Cebu, Philippines - (CEB);Chengdu, China - (CTU);Chennai, India - (MAA);Chittagong, Bangladesh - (CGP);Chongqing, China - (CKG);Colombo, Sri Lanka - (CMB);Dhaka, Bangladesh - (DAC);Dongguan, China - (SZX);Foshan, China - (FUO);Fuzhou, China - (FOC);Guangzhou, China - (CAN);Hangzhou, China - (HGH);Hanoi, Vietnam - (HAN);Hengyang, China - (HNY);Ho Chi Minh City, Vietnam - (SGN);Hong Kong - (HKG);Hyderabad, India - (HYD);Islamabad, Pakistan - (ISB);Jakarta, Indonesia - (CGK);Jinan, China - (TNA);Karachi, Pakistan - (KHI);Kathmandu, Nepal - (KTM);Kolkata, India - (CCU);Kuala Lumpur, Malaysia - (KUL);Lahore, Pakistan - (LHE);Langfang, China - (NAY);Luoyang, China - (LYA);Macau - (MFM);Malé, Maldives - (MLE);Manila, Philippines - (MNL);Mumbai, India - (BOM);Nagpur, India - (NAG);Nanning, China - (NNG);New Delhi, India - (DEL);Osaka, Japan - (KIX);Phnom Penh, Cambodia - (PNH);Qingdao, China - (TAO);Seoul, South Korea - (ICN);Shanghai, China - (SHA);Shenyang, China - (SHE);Shijiazhuang, China - (SJW);Singapore, Singapore - (SIN);Suzhou, China - (SZV);Taipei - (TPE);Thimphu, Bhutan - (PBH);Tianjin, China - (TSN);Tokyo, Japan - (NRT);Ulaanbaatar, Mongolia - (ULN);Vientiane, Laos - (VTE);Wuhan, China - (WUH);Wuxi, China - (WUX);Xi'an, China - (XIY);Yerevan, Armenia - (EVN);Zhengzhou, China - (CGO);Zuzhou, China - (CSX);Amsterdam, Netherlands - (AMS);Athens, Greece - (ATH);Barcelona, Spain - (BCN);Belgrade, Serbia - (BEG);Berlin, Germany - (TXL);Brussels, Belgium - (BRU);Bucharest, Romania - (OTP);Budapest, Hungary - (BUD);Chișinău, Moldova - (KIV);Copenhagen, Denmark - (CPH);Cork, Ireland -  (ORK);Dublin, Ireland - (DUB);Düsseldorf, Germany - (DUS);Edinburgh, United Kingdom - (EDI);Frankfurt, Germany - (FRA);Geneva, Switzerland - (GVA);Gothenburg, Sweden - (GOT);Hamburg, Germany - (HAM);Helsinki, Finland - (HEL);Istanbul, Turkey - (IST);Kyiv, Ukraine - (KBP);Lisbon, Portugal - (LIS);London, United Kingdom - (LHR);Luxembourg City, Luxembourg - (LUX);Madrid, Spain - (MAD);Manchester, United Kingdom - (MAN);Marseille, France - (MRS);Milan, Italy - (MXP);Moscow, Russia - (DME);Munich, Germany - (MUC);Nicosia, Cyprus - (LCA);Oslo, Norway - (OSL);Paris, France - (CDG);Prague, Czech Republic - (PRG);Reykjavík, Iceland - (KEF);Riga, Latvia - (RIX);Rome, Italy - (FCO);Saint Petersburg, Russia - (LED);Sofia, Bulgaria - (SOF);Stockholm, Sweden - (ARN);Tallinn, Estonia - (TLL);Thessaloniki, Greece - (SKG);Vienna, Austria - (VIE);Vilnius, Lithuania - (VNO);Warsaw, Poland - (WAW);Zagreb, Croatia - (ZAG);Zürich, Switzerland - (ZRH);Arica, Chile - (ARI);Asunción, Paraguay - (ASU);Bogotá, Colombia - (BOG);Buenos Aires, Argentina - (EZE);Curitiba, Brazil - (CWB);Fortaleza, Brazil - (FOR);Guatemala City, Guatemala - (GUA);Lima, Peru - (LIM);Medellín, Colombia - (MDE);Panama City, Panama - (PTY);Porto Alegre, Brazil - (POA);Quito, Ecuador - (UIO);Rio de Janeiro, Brazil - (GIG);São Paulo, Brazil - (GRU);Santiago, Chile - (SCL);Willemstad, Curaçao - (CUR);St. George's, Grenada - (GND);Amman, Jordan - (AMM);Baghdad, Iraq - (BGW);Baku, Azerbaijan - (GYD);Beirut, Lebanon - (BEY);Doha, Qatar - (DOH);Dubai, United Arab Emirates - (DXB);Kuwait City, Kuwait - (KWI);Manama, Bahrain - (BAH);Muscat, Oman - (MCT);Ramallah - (ZDM);Riyadh, Saudi Arabia - (RUH);Tel Aviv, Israel - (TLV);Ashburn, VA, United States - (IAD);Atlanta, GA, United States - (ATL);Boston, MA, United States - (BOS);Buffalo, NY, United States - (BUF);Calgary, AB, Canada - (YYC);Charlotte, NC, United States - (CLT);Chicago, IL, United States - (ORD);Columbus, OH, United States - (CMH);Dallas, TX, United States - (DFW);Denver, CO, United States - (DEN);Detroit, MI, United States - (DTW);Honolulu, HI, United States - (HNL);Houston, TX, United States - (IAH);Indianapolis, IN, United States - (IND);Jacksonville, FL, United States - (JAX);Kansas City, MO, United States - (MCI);Las Vegas, NV, United States - (LAS);Los Angeles, CA, United States - (LAX);McAllen, TX, United States - (MFE);Memphis, TN, United States - (MEM);Mexico City, Mexico - (MEX);Miami, FL, United States - (MIA);Minneapolis, MN, United States - (MSP);Montgomery, AL, United States - (MGM);Montréal, QC, Canada - (YUL);Nashville, TN, United States - (BNA);Newark, NJ, United States - (EWR);Norfolk, VA, United States - (ORF);Omaha, NE, United States - (OMA);Philadelphia, United States - (PHL);Phoenix, AZ, United States - (PHX);Pittsburgh, PA, United States - (PIT);Port-Au-Prince, Haiti - (PAP);Portland, OR, United States - (PDX);Queretaro, MX, Mexico - (QRO);Richmond, Virginia - (RIC);Sacramento, CA, United States - (SMF);Salt Lake City, UT, United States - (SLC);San Diego, CA, United States - (SAN);San Jose, CA, United States - (SJC);Saskatoon, SK, Canada - (YXE);Seattle, WA, United States - (SEA);St. Louis, MO, United States - (STL);Tampa, FL, United States - (TPA);Toronto, ON, Canada - (YYZ);Vancouver, BC, Canada - (YVR);Tallahassee, FL, United States - (TLH);Winnipeg, MB, Canada - (YWG);Adelaide, SA, Australia - (ADL);Auckland, New Zealand - (AKL);Brisbane, QLD, Australia - (BNE);Melbourne, VIC, Australia - (MEL);Noumea, New caledonia - (NOU);Perth, WA, Australia - (PER);Sydney, NSW, Australia - (SYD)".split(";"),e=a.split("colo=")[1].split("\n")[0],t=(a.split("colo=")[1].split("\n")[0],a.split("tls=")[1].split("\n")[0]),o=a.split("http=")[1].split("\n")[0],s=a.split("sni=")[1].split("\n")[0],r=a.split("ip=")[1].split("\n")[0],l=a.split("uag=")[1].split("\n")[0];for(var d=0;d<i.length;d++)if(-1!=i[d].indexOf(e)){document.getElementById("cdn").innerHTML=i[d];break}document.getElementById("tls").innerHTML=t,document.getElementById("http").innerHTML=o,document.getElementById("sni").innerHTML=s,document.getElementById("ip").innerHTML=r,document.getElementById("useragent").innerHTML=l}})},$(document).ready((function(){getCDNinfo()}))</script></p><p style="text-align:center">感谢陪伴与布道，开源之火不灭。​</p><p style="text-align:center"><script>document.write("本次加载耗时: "+(performance.getEntriesByType("navigation").reduce((e,r)=>e+r.responseEnd-r.startTime,0)+performance.getEntriesByType("resource").reduce((e,r)=>e+r.responseEnd-r.startTime,0)).toFixed(0)+"ms")</script></p><p style="text-align:center">当前 SNI 状态： <span id="sni">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前 TLS 版本： <span id="tls">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前 HTTP 版本： <span id="http">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前您的客户端 IP 是： <span id="ip">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">当前分配的 CDN 节点是: <span id="cdn">正在统计！或可能被浏览器防追踪拦截！</span></p><p style="text-align:center">您的 UserAgent 信息是: <span id="useragent">正在统计！或可能被浏览器防追踪拦截！</span></p><p></p></div></div></body></html>